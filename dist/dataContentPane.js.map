{"version":3,"file":"dataContentPane.js","names":["UI","$rdf","ns","dataContentPane","icon","icons","originalIconBase","name","audience","solid","label","subject","context","session","store","findTypeURIs","n","statementsMatching","undefined","length","statementsAsTables","sts","initialRoots","myDocument","dom","rep","createElement","sz","Serializer","res","rootSubjects","roots","subjects","loopBreakers","x","console","log","doneBnodes","referencedBnodes","propertyTree","lastPred","toStr","appendChild","createTextNode","sort","same","predicateTD","i","st","tr","predicate","uri","setAttribute","anchor","addEventListener","widgets","openHrefInOutlineMode","utils","predicateLabelForXML","objectTD","objectTree","object","obj","termType","datatype","textContent","value","innerHTML","toNT","slice","newTable","ancestor","style","backgroundColor","elements","paneRegistry","byName","statements","Error","concat","filter","sameTerm","subjectTD","TDTree","root","bNT","table","insertBefore","firstChild","render","alternativeRendering","p","s2","div","plist","kb","outliner","appendPropertyTRs","_pred","_inverse","verticalAlign","td","outlineObjectTD","outlineExpand","pane","mainRendering","holds","push","ps","any","foaf","getOutliner"],"sources":["../src/dataContentPane.js"],"sourcesContent":["/*      Data content Pane\n **\n **  This pane shows the content of a particular RDF resource\n ** or at least the RDF semantics we attribute to that resource.\n */\n\n// To do:  - Only take data from one graph\n//         - Only do forwards not backward?\n//         - Expand automatically all the way down\n//         - original source view?  Use ffox view source\n\nimport * as UI from 'solid-ui-jss'\nimport * as $rdf from 'rdflib'\n\nconst ns = UI.ns\n\nexport const dataContentPane = {\n  icon: UI.icons.originalIconBase + 'rdf_flyer.24.gif',\n\n  name: 'dataContents',\n\n  audience: [ns.solid('Developer')],\n\n  label: function (subject, context) {\n    if (\n      'http://www.w3.org/2007/ont/link#ProtocolEvent' in\n      context.session.store.findTypeURIs(subject)\n    ) {\n      return null\n    }\n    const n = context.session.store.statementsMatching(\n      undefined,\n      undefined,\n      undefined,\n      subject\n    ).length\n    if (n === 0) return null\n    return 'Data (' + n + ')'\n  },\n  /*\n  shouldGetFocus: function(subject) {\n      return store.whether(subject, UI.ns.rdf('type'), UI.ns.link('RDFDocument'))\n  },\n*/\n  statementsAsTables: function statementsAsTables (sts, context, initialRoots) {\n    const myDocument = context.dom\n    // const outliner = context.getOutliner(myDocument)\n    const rep = myDocument.createElement('table')\n    const sz = $rdf.Serializer(context.session.store)\n    const res = sz.rootSubjects(sts)\n    let roots = res.roots\n    const subjects = res.subjects\n    const loopBreakers = res.loopBreakers\n    for (const x in loopBreakers) {\n      console.log('\\tdataContentPane: loopbreaker:' + x)\n    }\n    const doneBnodes = {} // For preventing looping\n    const referencedBnodes = {} // Bnodes which need to be named alas\n\n    // The property tree for a single subject or anonymous node\n    function propertyTree (subject) {\n      // print('Proprty tree for '+subject)\n      const rep = myDocument.createElement('table')\n      let lastPred = null\n      const sts = subjects[sz.toStr(subject)] // relevant statements\n      if (!sts) {\n        // No statements in tree\n        rep.appendChild(myDocument.createTextNode('...')) // just empty bnode as object\n        return rep\n      }\n      sts.sort()\n      let same = 0\n      let predicateTD // The cell which holds the predicate\n      for (let i = 0; i < sts.length; i++) {\n        const st = sts[i]\n        const tr = myDocument.createElement('tr')\n        if (st.predicate.uri !== lastPred) {\n          if (lastPred && same > 1) {\n            predicateTD.setAttribute('rowspan', '' + same)\n          }\n          predicateTD = myDocument.createElement('td')\n          predicateTD.setAttribute('class', 'pred')\n          const anchor = myDocument.createElement('a')\n          anchor.setAttribute('href', st.predicate.uri)\n          anchor.addEventListener(\n            'click',\n            UI.widgets.openHrefInOutlineMode,\n            true\n          )\n          anchor.appendChild(\n            myDocument.createTextNode(\n              UI.utils.predicateLabelForXML(st.predicate)\n            )\n          )\n          predicateTD.appendChild(anchor)\n          tr.appendChild(predicateTD)\n          lastPred = st.predicate.uri\n          same = 0\n        }\n        same++\n        const objectTD = myDocument.createElement('td')\n        objectTD.appendChild(objectTree(st.object))\n        tr.appendChild(objectTD)\n        rep.appendChild(tr)\n      }\n      if (lastPred && same > 1) predicateTD.setAttribute('rowspan', '' + same)\n      return rep\n    }\n\n    // Convert a set of statements into a nested tree of tables\n    function objectTree (obj) {\n      let res, anchor\n      switch (obj.termType) {\n        case 'NamedNode':\n          anchor = myDocument.createElement('a')\n          anchor.setAttribute('href', obj.uri)\n          anchor.addEventListener(\n            'click',\n            UI.widgets.openHrefInOutlineMode,\n            true\n          )\n          anchor.appendChild(myDocument.createTextNode(UI.utils.label(obj)))\n          return anchor\n\n        case 'Literal':\n          if (!obj.datatype || !obj.datatype.uri) {\n            res = myDocument.createElement('div')\n            res.setAttribute('style', 'white-space: pre-wrap;')\n            res.textContent = obj.value\n            return res\n          } else if (\n            obj.datatype.uri ===\n            'http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral'\n          ) {\n            res = myDocument.createElement('div')\n            res.setAttribute('class', 'embeddedXHTML')\n            res.innerHTML = obj.value // Try that  @@@ beware embedded dangerous code\n            return res\n          }\n          return myDocument.createTextNode(obj.value) // placeholder - could be smarter,\n\n        case 'BlankNode': {\n          if (obj.toNT() in doneBnodes) {\n            // Break infinite recursion\n            referencedBnodes[obj.toNT()] = true\n            const anchor = myDocument.createElement('a')\n            anchor.setAttribute('href', '#' + obj.toNT().slice(2))\n            anchor.setAttribute('class', 'bnodeRef')\n            anchor.textContent = '*' + obj.toNT().slice(3)\n            return anchor\n          }\n          doneBnodes[obj.toNT()] = true // Flag to prevent infinite recursion in propertyTree\n          const newTable = propertyTree(obj)\n          doneBnodes[obj.toNT()] = newTable // Track where we mentioned it first\n          if (\n            UI.utils.ancestor(newTable, 'TABLE') &&\n            UI.utils.ancestor(newTable, 'TABLE').style.backgroundColor ===\n            'white'\n          ) {\n            newTable.style.backgroundColor = '#eee'\n          } else {\n            newTable.style.backgroundColor = 'white'\n          }\n          return newTable\n        }\n        case 'Collection':\n          res = myDocument.createElement('table')\n          res.setAttribute('class', 'collectionAsTables')\n          for (let i = 0; i < obj.elements.length; i++) {\n            const tr = myDocument.createElement('tr')\n            res.appendChild(tr)\n            tr.appendChild(objectTree(obj.elements[i]))\n          }\n          return res\n        case 'Graph':\n          res = context.session.paneRegistry\n            .byName('dataContents')\n            .statementsAsTables(obj.statements, context)\n          res.setAttribute('class', 'nestedFormula')\n          return res\n        case 'Variable':\n          res = myDocument.createTextNode('?' + obj.uri)\n          return res\n      }\n      throw new Error('Unhandled node type: ' + obj.termType)\n    }\n\n    // roots.sort()\n\n    if (initialRoots) {\n      roots = initialRoots.concat(\n        roots.filter(function (x) {\n          for (let i = 0; i < initialRoots.length; i++) {\n            // Max 2\n            if (x.sameTerm(initialRoots[i])) return false\n          }\n          return true\n        })\n      )\n    }\n    for (let i = 0; i < roots.length; i++) {\n      const tr = myDocument.createElement('tr')\n      tr.setAttribute('style', `background-color: ${i % 2 === 0 ? '#f0f0f0' : 'white'};`)\n      rep.appendChild(tr)\n      const subjectTD = myDocument.createElement('td')\n      tr.appendChild(subjectTD)\n      const TDTree = myDocument.createElement('td')\n      tr.appendChild(TDTree)\n      const root = roots[i]\n      if (root.termType === 'BlankNode') {\n        subjectTD.appendChild(myDocument.createTextNode(UI.utils.label(root))) // Don't recurse!\n      } else {\n        subjectTD.appendChild(objectTree(root)) // won't have tree\n      }\n      TDTree.appendChild(propertyTree(root))\n    }\n    for (const bNT in referencedBnodes) {\n      // Add number to refer to\n      const table = doneBnodes[bNT]\n      // let tr = myDocument.createElement('tr')\n      const anchor = myDocument.createElement('a')\n      anchor.setAttribute('id', bNT.slice(2))\n      anchor.setAttribute('class', 'bnodeDef')\n      anchor.textContent = bNT.slice(3) + ')'\n      table.insertBefore(anchor, table.firstChild)\n    }\n    return rep\n  }, // statementsAsTables\n  // View the data in a file in user-friendly way\n  render: function (subject, context) {\n    const myDocument = context.dom\n\n    function alternativeRendering () {\n      const sz = $rdf.Serializer(context.session.store)\n      const res = sz.rootSubjects(sts)\n      const roots = res.roots\n      const p = {}\n      p.render = function (s2) {\n        const div = myDocument.createElement('div')\n        div.setAttribute('class', 'withinDocumentPane')\n        const plist = kb.statementsMatching(s2, undefined, undefined, subject)\n        outliner.appendPropertyTRs(div, plist, false, function (\n          _pred,\n          _inverse\n        ) {\n          return true\n        })\n        return div\n      }\n      for (let i = 0; i < roots.length; i++) {\n        const tr = myDocument.createElement('TR')\n        const root = roots[i]\n        tr.style.verticalAlign = 'top'\n        const td = outliner.outlineObjectTD(root, undefined, tr)\n        tr.appendChild(td)\n        div.appendChild(tr)\n        outliner.outlineExpand(td, root, { pane: p })\n      }\n    }\n\n    function mainRendering () {\n      const initialRoots = [] // Ordering: start with stuff about this doc\n      if (kb.holds(subject, undefined, undefined, subject)) {\n        initialRoots.push(subject)\n      }\n      // Then about the primary topic of the document if any\n      const ps = kb.any(subject, UI.ns.foaf('primaryTopic'), undefined, subject)\n      if (ps) initialRoots.push(ps)\n      div.appendChild(\n        context.session.paneRegistry\n          .byName('dataContents')\n          .statementsAsTables(sts, context, initialRoots)\n      )\n    }\n\n    const outliner = context.getOutliner(myDocument)\n    const kb = context.session.store\n    const div = myDocument.createElement('div')\n    div.setAttribute('class', 'dataContentPane')\n    // Because of smushing etc, this will not be a copy of the original source\n    // We could instead either fetch and re-parse the source,\n    // or we could keep all the pre-smushed triples.\n    const sts = kb.statementsMatching(undefined, undefined, undefined, subject) // @@ slow with current store!\n\n    // eslint-disable-next-line no-constant-condition\n    if (false) { // keep code\n      alternativeRendering()\n    } else {\n      mainRendering()\n    }\n    return div\n  }\n}\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"pane.js","names":["UI","$rdf","ns","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","t","findTypeURIs","any","qu","render","dom","fetcher","Q","Namespace","TRIP","div","createElement","setAttribute","mention","message","style","undefined","pre","appendChild","createTextNode","complain","plist","statementsMatching","qlist","predicateURIsDone","donePredicate","pred","uri","setPaneStyle","account","mystyle","backgroundColor","ui","value","d2","n","s","indexOf","split","slice","numericCell","amount","suppressZero","td","textContent","headerCell","str","oderByDate","x","y","dx","dy","insertedPane","paneName","p","paneRegistry","byName","d","expandAfterRow","row","solo","siblings","parentNode","children","j","length","expanded","removeChild","tr","cols","nextSibling","insertBefore","expandAfterRowOrCollapse","transactionTable","list","filter","table","transactionRow","setTRStyle","c0","date","c1","payee","a1","c3","addEventListener","e","shiftKey","list2","sort","i","rdf","statement","nav","navLink","obj","a","utils","preds","map","inner","labelForXML","join","innerHTML","complainIfBad","ok","body","nowOrWhenFetched","calendarYear","renderCatgorySelectors","widgets","makeSelectForNestedCategory","rdfs","Classified","load","then","_xhrs","each","catch","console","log","makeDescription","trips","st","object","trips2","concat","sortedBy","reverse","l2","key","pair","cal","makeSelectForOptions","multiple","nullLabel","mint","mintClass","mintStatementsFun","trip","is","push","doc","outliner","getOutliner","attachmentList","wf","appendPropertyTRs","_inverse","calculations","total","yearTotal","yearCategoryTotal","trans","bankStatements","forEach","the","year","ty","tyuri","lit","parseFloat","types","grandTotal","years","Object","prototype","hasOwnProperty","call","ny","cell","header","z","cat","sym","tab"],"sources":["../../src/transaction/pane.js"],"sourcesContent":["/*   Financial Transaction Pane\n **\n **  This outline pane allows a user to interact with a transaction\n **  downloaded from a bank statement, annotting it with classes and comments,\n ** trips, etc\n */\n\nimport * as UI from 'solid-ui-jss'\nimport * as $rdf from 'rdflib'\nconst ns = UI.ns\n\nexport default {\n  // icon:  (module.__dirname || __dirname) + '22-pixel-068010-3d-transparent-glass-icon-alphanumeric-dollar-sign.png',\n  icon: UI.icons.iconBase + 'noun_106746.svg',\n\n  name: 'transaction',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve this pane?\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/2000/10/swap/pim/qif#Transaction']) return '$$'\n    if (kb.any(subject, UI.ns.qu('amount'))) return '$$$' // In case schema not picked up\n\n    // if (t['http://www.w3.org/2000/10/swap/pim/qif#Period']) return \"period $\"\n\n    if (t['http://www.w3.org/ns/pim/trip#Trip']) return 'Trip $'\n\n    return null // No under other circumstances (while testing at least!)\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const fetcher = kb.fetcher\n    const Q = $rdf.Namespace('http://www.w3.org/2000/10/swap/pim/qif#')\n    const TRIP = $rdf.Namespace('http://www.w3.org/ns/pim/trip#')\n\n    const div = dom.createElement('div')\n    div.setAttribute('class', 'transactionPane')\n\n    const mention = function mention (message, style) {\n      if (style === undefined) style = 'color: grey'\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', style)\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n    const complain = function complain (message) {\n      return mention(message, 'color: #100; background-color: #fee')\n    }\n\n    /*\n    var thisPane = this\n    var rerender = function (div) {\n      var parent = div.parentNode\n      var div2 = thisPane.render(subject, dom)\n      parent.replaceChild(div2, div)\n    }\n    */\n    // //////////////////////////////////////////////////////////////////////////////\n\n    const plist = kb.statementsMatching(subject)\n    const qlist = kb.statementsMatching(undefined, undefined, subject)\n\n    const t = kb.findTypeURIs(subject)\n\n    // var me = authn.currentUser()\n    const predicateURIsDone = {}\n    const donePredicate = function (pred) {\n      predicateURIsDone[pred.uri] = true\n    }\n\n    const setPaneStyle = function (account) {\n      let mystyle = 'padding: 0.5em 1.5em 1em 1.5em; '\n      if (account) {\n        const backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n        if (backgroundColor) {\n          mystyle += 'background-color: ' + backgroundColor.value + '; '\n        }\n      }\n      div.setAttribute('style', mystyle)\n    }\n    // setPaneStyle()\n\n    // Functions for displaying lists of transactions\n    // Click on the transaction line to expand it into a pane\n    // Shift-click to expand without collapsing others\n\n    const d2 = function (n) {\n      if (n === undefined) return ''\n      const s = '' + n\n      if (s.indexOf('.') >= 0) {\n        return s.split('.')[0] + '.' + (s.split('.')[1] + '00').slice(0, 2)\n      }\n      return s + '.00'\n    }\n\n    const numericCell = function numericCell (amount, suppressZero) {\n      const td = dom.createElement('td')\n      if (!(0.0 + amount === 0.0 && suppressZero)) {\n        td.textContent = d2(amount)\n      }\n      td.setAttribute('style', 'width: 6em; text-align: right; ')\n      return td\n    }\n\n    const headerCell = function headerCell (str) {\n      const td = dom.createElement('th')\n      td.textContent = str\n      td.setAttribute('style', 'text-align: right; ')\n      return td\n    }\n\n    const oderByDate = function (x, y) {\n      const dx = kb.any(x, ns.qu('date'))\n      const dy = kb.any(y, ns.qu('date'))\n      if (dx !== undefined && dy !== undefined) {\n        if (dx.value < dy.value) return -1\n        if (dx.value > dy.value) return 1\n      }\n      if (x.uri < y.uri) return -1 // Arbitrary but repeatable\n      if (x.uri > y.uri) return 1\n      return 0\n    }\n\n    const insertedPane = function (context, subject, paneName) {\n      const p = context.session.paneRegistry.byName(paneName)\n      const d = p.render(subject, context)\n      d.setAttribute('style', 'border: 0.1em solid green;')\n      return d\n    }\n\n    const expandAfterRow = function (dom, row, subject, paneName, solo) {\n      const siblings = row.parentNode.children\n      if (solo) {\n        for (let j = siblings.length - 1; j >= 0; j--) {\n          if (siblings[j].expanded) {\n            siblings[j].parentNode.removeChild(siblings[j].expanded)\n            siblings[j].expanded = false\n          }\n        }\n      }\n      const tr = dom.createElement('tr')\n      const td = tr.appendChild(dom.createElement('td'))\n      td.setAttribute(\n        'style',\n        'width: 98%; padding: 1em; border: 0.1em solid grey;'\n      )\n      const cols = row.children.length\n      if (row.nextSibling) {\n        row.parentNode.insertBefore(tr, row.nextSibling)\n      } else {\n        row.parentNode.appendChild(tr)\n      }\n      row.expanded = tr\n      td.setAttribute('colspan', '' + cols)\n      td.appendChild(insertedPane(context, subject, paneName))\n    }\n\n    const expandAfterRowOrCollapse = function (\n      dom,\n      row,\n      subject,\n      paneName,\n      solo\n    ) {\n      if (row.expanded) {\n        row.parentNode.removeChild(row.expanded)\n        row.expanded = false\n      } else {\n        expandAfterRow(dom, row, subject, paneName, solo)\n      }\n    }\n\n    const transactionTable = function (dom, list, filter) {\n      const table = dom.createElement('table')\n      table.setAttribute(\n        'style',\n        'padding-left: 0.5em; padding-right: 0.5em; font-size: 9pt; width: 85%;'\n      )\n      const transactionRow = function (dom, x) {\n        const tr = dom.createElement('tr')\n\n        const setTRStyle = function (tr, account) {\n          // var mystyle = \"padding: 0.5em 1.5em 1em 1.5em; \"\n          let mystyle =\n            '\\'padding-left: 0.5em; padding-right: 0.5em; padding-top: 0.1em;'\n          if (account) {\n            const backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n            if (backgroundColor) {\n              mystyle += 'background-color: ' + backgroundColor.value + '; '\n            }\n          }\n          tr.setAttribute('style', mystyle)\n        }\n\n        const account = kb.any(x, ns.qu('toAccount'))\n        setTRStyle(tr, account)\n\n        const c0 = tr.appendChild(dom.createElement('td'))\n        const date = kb.any(x, ns.qu('date'))\n        c0.textContent = date ? date.value.slice(0, 10) : '???'\n        c0.setAttribute('style', 'width: 7em;')\n\n        const c1 = tr.appendChild(dom.createElement('td'))\n        c1.setAttribute('style', 'width: 36em;')\n        const payee = kb.any(x, ns.qu('payee'))\n        c1.textContent = payee ? payee.value : '???'\n        const a1 = c1.appendChild(dom.createElement('a'))\n        a1.textContent = ' âžœ'\n        a1.setAttribute('href', x.uri)\n\n        const c3 = tr.appendChild(dom.createElement('td'))\n        const amount = kb.any(x, ns.qu('in_USD'))\n        c3.textContent = amount ? d2(amount.value) : '???'\n        c3.setAttribute('style', 'width: 6em; text-align: right; ') // @@ decimal alignment?\n        tr.addEventListener(\n          'click',\n          function (e) {\n            // solo unless shift key\n            expandAfterRowOrCollapse(dom, tr, x, 'transaction', !e.shiftKey)\n          },\n          false\n        )\n\n        return tr\n      }\n\n      const list2 = filter ? list.filter(filter) : list.slice() // don't sort a paramater passed in place\n      list2.sort(oderByDate)\n\n      for (let i = 0; i < list2.length; i++) {\n        table.appendChild(transactionRow(dom, list2[i]))\n      }\n      return table\n    }\n\n    //              Render a single transaction\n\n    // This works only if enough metadata about the properties can drive the RDFS\n    // (or actual type statements whichtypically are NOT there on)\n    if (\n      t['http://www.w3.org/2000/10/swap/pim/qif#Transaction'] ||\n      kb.any(subject, ns.qu('toAccount'))\n    ) {\n      // var trip = kb.any(subject, WF('trip'))\n      donePredicate(ns.rdf('type'))\n\n      const account = kb.any(subject, UI.ns.qu('toAccount'))\n      setPaneStyle(account)\n      if (!account) {\n        complain(\n          '(Error: There is no bank account known for this transaction <' +\n            subject.uri +\n            '>,\\n -- every transaction needs one.)'\n        )\n      }\n\n      let store = null\n      const statement = kb.any(subject, UI.ns.qu('accordingTo'))\n      if (statement === undefined) {\n        complain(\n          '(Error: There is no back link to the original data source foir this transaction <' +\n            subject.uri +\n            '>,\\nso I can\\'t tell how to annotate it.)'\n        )\n      } else {\n        store =\n          statement !== undefined\n            ? kb.any(statement, UI.ns.qu('annotationStore'))\n            : null\n        if (store === undefined) {\n          complain(\n            '(There is no annotation document for this statement\\n<' +\n              statement.uri +\n              '>,\\nso you cannot classify this transaction.)'\n          )\n        }\n      }\n\n      const nav = dom.createElement('div')\n      nav.setAttribute('style', 'float:right')\n      div.appendChild(nav)\n\n      const navLink = function (pred, label) {\n        donePredicate(pred)\n        const obj = kb.any(subject, pred)\n        if (!obj) return\n        const a = dom.createElement('a')\n        a.setAttribute('href', obj.uri)\n        a.setAttribute('style', 'float:right')\n        nav.appendChild(a).textContent = label || UI.utils.label(obj)\n        nav.appendChild(dom.createElement('br'))\n      }\n\n      navLink(UI.ns.qu('toAccount'))\n      navLink(UI.ns.qu('accordingTo'), 'Statement')\n      navLink(TRIP('trip'))\n\n      // Basic data:\n      const table = dom.createElement('table')\n      div.appendChild(table)\n      const preds = ['date', 'payee', 'amount', 'in_USD', 'currency'].map(Q)\n      const inner = preds\n        .map(function (p) {\n          donePredicate(p)\n          const value = kb.any(subject, p)\n          const s = value ? UI.utils.labelForXML(value) : ''\n          return (\n            '<tr><td style=\"text-align: right; padding-right: 0.6em\">' +\n            UI.utils.labelForXML(p) +\n            '</td><td style=\"font-weight: bold;\">' +\n            s +\n            '</td></tr>'\n          )\n        })\n        .join('\\n')\n      table.innerHTML = inner\n\n      const complainIfBad = function (ok, body) {\n        if (ok) {\n          // setModifiedDate(store, kb, store)\n          // rerender(div) // deletes the new trip form\n        } else complain('Sorry, failed to save your change:\\n' + body)\n      }\n\n      // What trips do we know about?\n\n      // Classify:\n      if (store) {\n        kb.fetcher.nowOrWhenFetched(store.uri, subject, function (ok, body) {\n          if (!ok) complain('Cannot load store ' + store + ' ' + body)\n\n          const calendarYear = kb.any(store, ns.qu('calendarYear'))\n\n          const renderCatgorySelectors = function () {\n            div.insertBefore(\n              UI.widgets.makeSelectForNestedCategory(\n                dom,\n                kb,\n                subject,\n                UI.ns.qu('Classified'),\n                store,\n                complainIfBad\n              ),\n              table.nextSibling\n            )\n          }\n\n          if (kb.any(undefined, ns.rdfs('subClassOf'), ns.qu.Classified)) {\n            renderCatgorySelectors()\n          } else if (calendarYear) {\n            fetcher\n              .load(calendarYear)\n              .then(function (_xhrs) {\n                fetcher\n                  .load(kb.each(calendarYear, ns.rdfs('seeAlso')))\n                  .then(function () {\n                    renderCatgorySelectors()\n                  })\n                  .catch(function (e) {\n                    console.log('Error loading background data: ' + e)\n                  })\n              })\n              .catch(function (e) {\n                console.log('Error loading calendarYear: ' + e)\n              })\n          } else {\n            console.log('Can\\'t get categories, because no calendarYear')\n          }\n          div.appendChild(\n            UI.widgets.makeDescription(\n              dom,\n              kb,\n              subject,\n              UI.ns.rdfs('comment'),\n              store,\n              complainIfBad\n            )\n          )\n\n          let trips = kb\n            .statementsMatching(undefined, TRIP('trip'), undefined, store)\n            .map(function (st) {\n              return st.object\n            }) // @@ Use rdfs\n          const trips2 = kb.each(undefined, UI.ns.rdf('type'), TRIP('Trip'))\n          trips = trips.concat(trips2).sort() // @@ Unique\n\n          const sortedBy = function (kb, list, pred, reverse) {\n            const l2 = list.map(function (x) {\n              let key = kb.any(x, pred)\n              key = key ? key.value : '9999-12-31'\n              return [key, x]\n            })\n            l2.sort()\n            if (reverse) l2.reverse()\n            return l2.map(function (pair) {\n              return pair[1]\n            })\n          }\n\n          trips = sortedBy(kb, trips, UI.ns.cal('dtstart'), true) // Reverse chron\n\n          if (trips.length > 1) {\n            div.appendChild(\n              UI.widgets.makeSelectForOptions(\n                dom,\n                kb,\n                subject,\n                TRIP('trip'),\n                trips,\n                {\n                  multiple: false,\n                  nullLabel: '-- what trip? --',\n                  mint: 'New Trip *',\n                  mintClass: TRIP('Trip'),\n                  mintStatementsFun: function (trip) {\n                    const is = []\n                    is.push(\n                      $rdf.st(trip, UI.ns.rdf('type'), TRIP('Trip'), trip.doc())\n                    )\n                    return is\n                  }\n                },\n                store,\n                complainIfBad\n              )\n            )\n          }\n\n          div.appendChild(dom.createElement('br'))\n\n          // Add in simple comments about the transaction\n\n          const outliner = context.getOutliner(dom)\n\n          donePredicate(ns.rdfs('comment')) // Done above\n\n          UI.widgets.attachmentList(dom, subject, div)\n          donePredicate(ns.wf('attachment'))\n\n          div\n            .appendChild(dom.createElement('tr'))\n            .setAttribute('style', 'height: 1em') // spacer\n\n          // Remaining properties\n          outliner.appendPropertyTRs(div, plist, false, function (\n            pred,\n            _inverse\n          ) {\n            return !(pred.uri in predicateURIsDone)\n          })\n          outliner.appendPropertyTRs(div, qlist, true, function (\n            pred,\n            _inverse\n          ) {\n            return !(pred.uri in predicateURIsDone)\n          })\n        }) // fetch\n      }\n      // end of render tranasaction instance\n\n      // ////////////////////////////////////////////////////////////////////\n      //\n      //      Render the transactions in a Trip\n      //\n    } else if (t['http://www.w3.org/ns/pim/trip#Trip']) {\n      /*\n          var query = new $rdf.Query(UI.utils.label(subject))\n          var vars =  [ 'date', 'transaction', 'comment', 'type',  'in_USD']\n          var v = {}\n          vars.map(function(x){query.vars.push(v[x]=$rdf.variable(x))}) // Only used by UI\n          query.pat.add(v['transaction'], TRIP('trip'), subject)\n\n          var opt = kb.formula()\n          opt.add(v['transaction'], ns.rdf('type'), v['type']); // Issue: this will get stored supertypes too\n          query.pat.optional.push(opt)\n\n          query.pat.add(v['transaction'], UI.ns.qu('date'), v['date'])\n\n          var opt = kb.formula()\n          opt.add(v['transaction'], ns.rdfs('comment'), v['comment'])\n          query.pat.optional.push(opt)\n\n          //opt = kb.formula()\n          query.pat.add(v['transaction'], UI.ns.qu('in_USD'), v['in_USD'])\n\n          //query.pat.optional.push(opt)\n\n          var tableDiv = UI.widgets.renderTableViewPane(dom, {'query': query, 'onDone': calculations} )\n          div.appendChild(tableDiv)\n\n*/\n      const calculations = function () {\n        const total = {}\n        const yearTotal = {}\n        const yearCategoryTotal = {}\n        const trans = kb.each(undefined, TRIP('trip'), subject)\n        const bankStatements = trans.map(function (t) {\n          return t.doc()\n        })\n        kb.fetcher\n          .load(bankStatements)\n          .then(function () {\n            trans.forEach(function (t) {\n              const date = kb.the(t, ns.qu('date'))\n              const year = date ? ('' + date.value).slice(0, 4) : '????'\n              let ty = kb.the(t, ns.rdf('type')) // @@ find most specific type\n              // complain(\" -- one trans: \"+t.uri + ' -> '+kb.any(t, UI.ns.qu('in_USD')))\n              if (!ty) ty = UI.ns.qu('ErrorNoType')\n              if (ty && ty.uri) {\n                const tyuri = ty.uri\n                if (!yearTotal[year]) yearTotal[year] = 0.0\n                if (!yearCategoryTotal[year]) yearCategoryTotal[year] = {}\n                if (!total[tyuri]) total[tyuri] = 0.0\n                if (!yearCategoryTotal[year][tyuri]) {\n                  yearCategoryTotal[year][tyuri] = 0.0\n                }\n\n                const lit = kb.any(t, UI.ns.qu('in_USD'))\n                if (!lit) {\n                  complain('@@ No amount in USD: ' + lit + ' for ' + t)\n                }\n                if (lit) {\n                  const amount = parseFloat(lit.value)\n                  total[tyuri] += amount\n                  yearCategoryTotal[year][tyuri] += amount\n                  yearTotal[year] += amount\n                }\n              }\n            })\n\n            const types = []\n            let grandTotal = 0.0\n            const years = []\n            let i\n\n            for (const y in yearCategoryTotal) {\n              // @@ TODO: Write away the need for exception on next line\n\n              if (Object.prototype.hasOwnProperty.call(yearCategoryTotal, y)) {\n                years.push(y)\n              }\n            }\n            years.sort()\n            const ny = years.length\n            let cell\n\n            const table = div.appendChild(dom.createElement('table'))\n            table.setAttribute(\n              'style',\n              'font-size: 120%; margin-left:auto; margin-right:1em; margin-top: 1em; border: 0.05em solid gray; padding: 1em;'\n            )\n\n            if (ny > 1) {\n              const header = table.appendChild(dom.createElement('tr'))\n              header.appendChild(headerCell(''))\n              for (i = 0; i < ny; i++) {\n                header.appendChild(headerCell(years[i]))\n              }\n              header.appendChild(headerCell('total'))\n            }\n\n            for (const uri in total) {\n              // @@ TODO: Write away the need for exception on next line\n\n              if (Object.prototype.hasOwnProperty.call(total, uri)) {\n                types.push(uri)\n                grandTotal += total[uri]\n              }\n            }\n            types.sort()\n            let row, label, z\n            for (let j = 0; j < types.length; j++) {\n              const cat = kb.sym(types[j])\n              row = table.appendChild(dom.createElement('tr'))\n              label = row.appendChild(dom.createElement('td'))\n              label.textContent = UI.utils.label(cat)\n              if (ny > 1) {\n                for (i = 0; i < ny; i++) {\n                  z = yearCategoryTotal[years[i]][types[j]]\n                  cell = row.appendChild(numericCell(z, true))\n                }\n              }\n              row.appendChild(numericCell(total[types[j]], true))\n            }\n\n            // Trailing totals\n            if (types.length > 1) {\n              row = table.appendChild(dom.createElement('tr'))\n              row.appendChild(headerCell('total'))\n              if (ny > 1) {\n                for (i = 0; i < ny; i++) {\n                  z = yearTotal[years[i]]\n                  cell = row.appendChild(numericCell(z ? d2(z) : ''))\n                }\n              }\n              cell = row.appendChild(numericCell(grandTotal))\n              cell.setAttribute(\n                'style',\n                'font-weight: bold; text-align: right;'\n              )\n            }\n\n            const tab = transactionTable(dom, trans)\n            tab.setAttribute(\n              'style',\n              'margin-left:auto; margin-right:1em; margin-top: 1em; border: padding: 1em;'\n            )\n            div.appendChild(tab)\n\n            UI.widgets.attachmentList(dom, subject, div)\n          })\n          .catch(function (e) {\n            complain('Error loading transactions: ' + e)\n          })\n      }\n      calculations()\n    } // if\n\n    return div\n  }\n}\n\n// ends\n"],"mappings":"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","ignoreList":[]}
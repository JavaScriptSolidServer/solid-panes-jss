{"version":3,"file":"period.js","names":["UI","_interopRequireWildcard","require","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ns","_default","exports","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","findTypeURIs","render","dom","div","createElement","setAttribute","mention","message","style","pre","appendChild","createTextNode","happy","complain","renderPeriod","dtstart","any","cal","undefined","uri","dtend","predicateURIsDone","donePredicate","pred","rdf","inPeriod","date","d2","s","indexOf","split","slice","transactionInPeriod","x","qu","oderByDate","y","dx","dy","value","h2","textContent","insertedPane","paneName","p","paneRegistry","byName","d","expandAfterRow","row","solo","siblings","parentNode","children","j","length","expanded","removeChild","tr","td","cols","nextSibling","insertBefore","expandAfterRowOrCollapse","transactionTable","list","table","transactionRow","setTRStyle","account","mystyle","backgroundColor","ui","c0","c1","payee","a1","c3","amount","addEventListener","shiftKey","list2","filter","sort","dummies","xURIs","findMemberURIs","unclassifiedIn","unclassifiedOut","usd","z","prototype","sym","tt","each","classified","push","tab","count","catSymbol","catTail","cats","findSubClassesNT","cat","checkCatHasField","guilty","utils","trip","needed","rdfs","console","log","fetcher","load","then"],"sources":["../../src/transaction/period.js"],"sourcesContent":["/*   Financial Period Pane\n **\n **  This outline pane allows a user to interact with a period\n **  downloaded from a bank statement, annotting it with classes and comments,\n ** trips, etc\n */\n\nimport * as UI from 'solid-ui-jss'\nconst ns = UI.ns\n\nexport default {\n  icon: UI.icons.iconBase + 'noun_142708.svg',\n\n  name: 'period',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve this pane?\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/2000/10/swap/pim/qif#Period']) return 'period'\n    return null // No under other circumstances (while testing at least!)\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const ns = UI.ns\n\n    const div = dom.createElement('div')\n    div.setAttribute('class', 'periodPane')\n\n    const mention = function mention (message, style) {\n      if (!style) style = 'color: grey;'\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', style)\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n    const happy = function happy (message) {\n      return mention('✓ ' + message, 'color: #010; background-color: #efe')\n    }\n    const complain = function complain (message) {\n      return mention(message, 'color: #100; background-color: #fee')\n    }\n    /*\n    var rerender = function (div) {\n      var parent = div.parentNode\n      var div2 = thisPane.render(subject, dom)\n      parent.replaceChild(div2, div)\n    }\n*/\n    const renderPeriod = function () {\n      const dtstart = kb.any(subject, ns.cal('dtstart'))\n      if (dtstart === undefined) {\n        complain(\n          '(Error: There is no start date known for this period <' +\n            subject.uri +\n            '>,\\n -- every period needs one.)'\n        )\n      }\n\n      const dtend = kb.any(subject, ns.cal('dtend'))\n      if (dtend === undefined) {\n        complain(\n          '(Error: There is no end date known for this period <' +\n            subject.uri +\n            '>,\\n -- every period needs one.)'\n        )\n      }\n\n      // var store = kb.any(subject, UI.ns.qu('annotationStore')) || null\n\n      const predicateURIsDone = {}\n      const donePredicate = function (pred) {\n        predicateURIsDone[pred.uri] = true\n      }\n      donePredicate(ns.rdf('type'))\n\n      const inPeriod = function (date) {\n        return !!(date && date >= dtstart && date < dtend)\n      }\n\n      const d2 = function (n) {\n        const s = '' + n\n        if (s.indexOf('.') >= 0) {\n          return s.split('.')[0] + '.' + (s.split('.')[1] + '00').slice(0, 2)\n        }\n        return s + '.00'\n      }\n\n      const transactionInPeriod = function (x) {\n        return inPeriod(kb.any(x, ns.qu('date')))\n      }\n\n      const oderByDate = function (x, y) {\n        const dx = kb.any(x, ns.qu('date'))\n        const dy = kb.any(y, ns.qu('date'))\n        if (dx !== undefined && dy !== undefined) {\n          if (dx.value < dy.value) return -1\n          if (dx.value > dy.value) return 1\n        }\n        if (x.uri < y.uri) return -1 // Arbitrary but repeatable\n        if (x.uri > y.uri) return 1\n        return 0\n      }\n      /*\n      var setPaneStyle = function (account) {\n        var mystyle = 'padding: 0.5em 1.5em 1em 1.5em; '\n        if (account) {\n          var backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n          if (backgroundColor) {\n            mystyle += 'background-color: ' + backgroundColor.value + '; '\n          }\n        }\n        div.setAttribute('style', mystyle)\n      }\n      // setPaneStyle();\n*/\n      const h2 = div.appendChild(dom.createElement('h2'))\n      h2.textContent =\n        'Period ' +\n        dtstart.value.slice(0, 10) +\n        ' - ' +\n        dtend.value.slice(0, 10)\n\n      const insertedPane = function (context, subject, paneName) {\n        const p = context.session.paneRegistry.byName(paneName)\n        const d = p.render(subject, context)\n        d.setAttribute('style', 'border: 0.1em solid green;')\n        return d\n      }\n\n      const expandAfterRow = function (dom, row, subject, paneName, solo) {\n        const siblings = row.parentNode.children\n        if (solo) {\n          for (let j = siblings.length - 1; j >= 0; j--) {\n            if (siblings[j].expanded) {\n              siblings[j].parentNode.removeChild(siblings[j].expanded)\n              siblings[j].expanded = false\n            }\n          }\n        }\n        const tr = dom.createElement('tr')\n        const td = tr.appendChild(dom.createElement('td'))\n        td.setAttribute(\n          'style',\n          'width: 98%; padding: 1em; border: 0.1em solid grey;'\n        )\n        const cols = row.children.length\n        if (row.nextSibling) {\n          row.parentNode.insertBefore(tr, row.nextSibling)\n        } else {\n          row.parentNode.appendChild(tr)\n        }\n        row.expanded = tr\n        td.setAttribute('colspan', '' + cols)\n        td.appendChild(insertedPane(context, subject, paneName))\n      }\n\n      const expandAfterRowOrCollapse = function (\n        dom,\n        row,\n        subject,\n        paneName,\n        solo\n      ) {\n        if (row.expanded) {\n          row.parentNode.removeChild(row.expanded)\n          row.expanded = false\n        } else {\n          expandAfterRow(dom, row, subject, paneName, solo)\n        }\n      }\n\n      const transactionTable = function (dom, list) {\n        const table = dom.createElement('table')\n        table.setAttribute(\n          'style',\n          'margin-left: 100; font-size: 9pt; width: 85%;'\n        )\n        const transactionRow = function (dom, x) {\n          const tr = dom.createElement('tr')\n\n          const setTRStyle = function (tr, account) {\n            // var mystyle = \"padding: 0.5em 1.5em 1em 1.5em; \";\n            let mystyle = 'margin-left: 8em; padding-left: 5em;'\n            if (account) {\n              const backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n              if (backgroundColor) {\n                mystyle += 'background-color: ' + backgroundColor.value + '; '\n              }\n            }\n            tr.setAttribute('style', mystyle)\n          }\n\n          const account = kb.any(x, ns.qu('toAccount'))\n          setTRStyle(tr, account)\n\n          const c0 = tr.appendChild(dom.createElement('td'))\n          const date = kb.any(x, ns.qu('date'))\n          c0.textContent = date ? date.value.slice(0, 10) : '???'\n          c0.setAttribute('style', 'width: 7em;')\n\n          const c1 = tr.appendChild(dom.createElement('td'))\n          c1.setAttribute('style', 'width: 36em;')\n          const payee = kb.any(x, ns.qu('payee'))\n          c1.textContent = payee ? payee.value : '???'\n          const a1 = c1.appendChild(dom.createElement('a'))\n          a1.textContent = ' ➜'\n          a1.setAttribute('href', x.uri)\n\n          const c3 = tr.appendChild(dom.createElement('td'))\n          const amount = kb.any(x, ns.qu('in_USD'))\n          c3.textContent = amount ? d2(amount.value) : '???'\n          c3.setAttribute('style', 'width: 6em; text-align: right; ') // @@ decimal alignment?\n          tr.addEventListener(\n            'click',\n            function (e) {\n              // solo unless shift key\n              expandAfterRowOrCollapse(dom, tr, x, 'transaction', !e.shiftKey)\n            },\n            false\n          )\n\n          return tr\n        }\n\n        const list2 = list.filter(transactionInPeriod)\n        list2.sort(oderByDate)\n\n        for (let i = 0; i < list2.length; i++) {\n          table.appendChild(transactionRow(dom, list2[i]))\n        }\n        return table\n      }\n\n      // List unclassified transactions\n\n      const dummies = {\n        'http://www.w3.org/2000/10/swap/pim/qif#Transaction': true, // (we knew)\n        'http://www.w3.org/2000/10/swap/pim/qif#Unclassified': true, // pseudo classifications we may phase out\n        'http://www.w3.org/2000/10/swap/pim/qif#UnclassifiedOutgoing': true,\n        'http://www.w3.org/2000/10/swap/pim/qif#UnclassifiedIncome': true\n      }\n      const xURIs = kb.findMemberURIs(ns.qu('Transaction'))\n      const unclassifiedIn = []\n      const unclassifiedOut = []\n      let usd, z\n      for (const y in xURIs) {\n        // For each thing which can be inferred to be a transaction\n        // @@ TODO: Write away the need for exception on next line\n\n        if (Object.prototype.hasOwnProperty.call(xURIs, y)) {\n          z = kb.sym(y)\n          const tt = kb.each(z, ns.rdf('type')) // What EXPLICIT definitions\n          let classified = false\n          for (let j = 0; j < tt.length; j++) {\n            const t = tt[j]\n            if (dummies[t.uri] === undefined) {\n              classified = true\n            }\n          }\n          if (!classified) {\n            usd = kb.any(z, ns.qu('in_USD'))\n            if (usd === undefined) {\n              usd = kb.any(z, ns.qu('amount'))\n            }\n            if (usd && ('' + usd.value).indexOf('-') >= 0) {\n              unclassifiedOut.push(kb.sym(y))\n            } else {\n              unclassifiedIn.push(kb.sym(y))\n            }\n          }\n        }\n      }\n      let tab, count\n      if (unclassifiedIn.length) {\n        tab = transactionTable(dom, unclassifiedIn)\n        count = tab.children.length\n        div.appendChild(dom.createElement('h3')).textContent =\n          'Unclassified Income' + (count < 4 ? '' : ' (' + count + ')')\n        div.appendChild(tab)\n      } else {\n        happy('No unclassified income')\n      }\n      if (unclassifiedOut.length) {\n        tab = transactionTable(dom, unclassifiedOut)\n        count = tab.children.length\n        div.appendChild(dom.createElement('h3')).textContent =\n          'Unclassified Outgoings' + (count < 4 ? '' : ' (' + count + ')')\n        div.appendChild(tab)\n      } else {\n        happy('No unclassified outgoings ')\n      }\n\n      // ///////////////  Check some categories of transaction for having given fields\n\n      const catSymbol = function (catTail) {\n        const cats = kb.findSubClassesNT(ns.qu('Transaction'))\n        for (const cat in cats) {\n          // @@ TODO: Write away the need for exception on next line\n\n          if (Object.prototype.hasOwnProperty.call(cats, cat)) {\n            if (cat.slice(1, -1).split('#')[1] === catTail) {\n              return kb.sym(cat.slice(1, -1))\n            }\n          }\n        }\n        return null\n      }\n\n      const checkCatHasField = function (catTail, pred) {\n        const cat = catSymbol(catTail)\n        let tab\n        const guilty = []\n        let count = 0\n        if (!cat) {\n          complain('Error: No category correspnding to ' + catTail)\n          return null\n        }\n        const list = kb.each(undefined, ns.rdf('type'), cat)\n        for (let i = 0; i < list.length; i++) {\n          if (!kb.any(list[i], pred)) {\n            guilty.push(list[i])\n          }\n        }\n        if (guilty.length) {\n          tab = transactionTable(dom, guilty)\n          count = tab.children.length\n          div.appendChild(dom.createElement('h3')).textContent =\n            UI.utils.label(cat) +\n            ' with no ' +\n            UI.utils.label(pred) +\n            (count < 4 ? '' : ' (' + count + ')')\n          div.appendChild(tab)\n        }\n        return count\n      }\n\n      // Load dynamically as properties of period\n      if (checkCatHasField('Reimbursables', ns.trip('trip')) === 0) {\n        happy('Reimbursables all have trips')\n      }\n      if (checkCatHasField('Other_Inc_Speaking', ns.trip('trip')) === 0) {\n        happy('Speaking income all has trips')\n      }\n      // end of render period instance\n    } // renderPeriod\n\n    // //////////////////////////////////////////////////////////////////////////////\n\n    // var me = authn.currentUser()\n\n    //              Render a single Period\n\n    // This works only if enough metadata about the properties can drive the RDFS\n    // (or actual type statements whichtypically are NOT there on)\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/2000/10/swap/pim/qif#Period']) {\n      const needed = kb.each(subject, ns.rdfs('seeAlso'))\n      console.log('Loading before render: ' + needed.length)\n      kb.fetcher.load(needed).then(function () {\n        renderPeriod()\n      })\n    }\n\n    // if (!me) complain(\"You do not have your Web Id set. Set your Web ID to make changes.\");\n\n    return div\n  }\n}\n// ends\n"],"mappings":"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","ignoreList":[]}
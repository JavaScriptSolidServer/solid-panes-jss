{"version":3,"file":"period.js","names":["UI","ns","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","t","findTypeURIs","render","dom","div","createElement","setAttribute","mention","message","style","pre","appendChild","createTextNode","happy","complain","renderPeriod","dtstart","any","cal","undefined","uri","dtend","predicateURIsDone","donePredicate","pred","rdf","inPeriod","date","d2","n","s","indexOf","split","slice","transactionInPeriod","x","qu","oderByDate","y","dx","dy","value","h2","textContent","insertedPane","paneName","p","paneRegistry","byName","d","expandAfterRow","row","solo","siblings","parentNode","children","j","length","expanded","removeChild","tr","td","cols","nextSibling","insertBefore","expandAfterRowOrCollapse","transactionTable","list","table","transactionRow","setTRStyle","account","mystyle","backgroundColor","ui","c0","c1","payee","a1","c3","amount","addEventListener","e","shiftKey","list2","filter","sort","i","dummies","xURIs","findMemberURIs","unclassifiedIn","unclassifiedOut","usd","z","Object","prototype","hasOwnProperty","call","sym","tt","each","classified","push","tab","count","catSymbol","catTail","cats","findSubClassesNT","cat","checkCatHasField","guilty","utils","trip","needed","rdfs","console","log","fetcher","load","then"],"sources":["../../src/transaction/period.js"],"sourcesContent":["/*   Financial Period Pane\n **\n **  This outline pane allows a user to interact with a period\n **  downloaded from a bank statement, annotting it with classes and comments,\n ** trips, etc\n */\n\nimport * as UI from 'solid-ui-jss'\nconst ns = UI.ns\n\nexport default {\n  icon: UI.icons.iconBase + 'noun_142708.svg',\n\n  name: 'period',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve this pane?\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/2000/10/swap/pim/qif#Period']) return 'period'\n    return null // No under other circumstances (while testing at least!)\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const ns = UI.ns\n\n    const div = dom.createElement('div')\n    div.setAttribute('class', 'periodPane')\n\n    const mention = function mention (message, style) {\n      if (!style) style = 'color: grey;'\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', style)\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n    const happy = function happy (message) {\n      return mention('✓ ' + message, 'color: #010; background-color: #efe')\n    }\n    const complain = function complain (message) {\n      return mention(message, 'color: #100; background-color: #fee')\n    }\n    /*\n    var rerender = function (div) {\n      var parent = div.parentNode\n      var div2 = thisPane.render(subject, dom)\n      parent.replaceChild(div2, div)\n    }\n*/\n    const renderPeriod = function () {\n      const dtstart = kb.any(subject, ns.cal('dtstart'))\n      if (dtstart === undefined) {\n        complain(\n          '(Error: There is no start date known for this period <' +\n            subject.uri +\n            '>,\\n -- every period needs one.)'\n        )\n      }\n\n      const dtend = kb.any(subject, ns.cal('dtend'))\n      if (dtend === undefined) {\n        complain(\n          '(Error: There is no end date known for this period <' +\n            subject.uri +\n            '>,\\n -- every period needs one.)'\n        )\n      }\n\n      // var store = kb.any(subject, UI.ns.qu('annotationStore')) || null\n\n      const predicateURIsDone = {}\n      const donePredicate = function (pred) {\n        predicateURIsDone[pred.uri] = true\n      }\n      donePredicate(ns.rdf('type'))\n\n      const inPeriod = function (date) {\n        return !!(date && date >= dtstart && date < dtend)\n      }\n\n      const d2 = function (n) {\n        const s = '' + n\n        if (s.indexOf('.') >= 0) {\n          return s.split('.')[0] + '.' + (s.split('.')[1] + '00').slice(0, 2)\n        }\n        return s + '.00'\n      }\n\n      const transactionInPeriod = function (x) {\n        return inPeriod(kb.any(x, ns.qu('date')))\n      }\n\n      const oderByDate = function (x, y) {\n        const dx = kb.any(x, ns.qu('date'))\n        const dy = kb.any(y, ns.qu('date'))\n        if (dx !== undefined && dy !== undefined) {\n          if (dx.value < dy.value) return -1\n          if (dx.value > dy.value) return 1\n        }\n        if (x.uri < y.uri) return -1 // Arbitrary but repeatable\n        if (x.uri > y.uri) return 1\n        return 0\n      }\n      /*\n      var setPaneStyle = function (account) {\n        var mystyle = 'padding: 0.5em 1.5em 1em 1.5em; '\n        if (account) {\n          var backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n          if (backgroundColor) {\n            mystyle += 'background-color: ' + backgroundColor.value + '; '\n          }\n        }\n        div.setAttribute('style', mystyle)\n      }\n      // setPaneStyle();\n*/\n      const h2 = div.appendChild(dom.createElement('h2'))\n      h2.textContent =\n        'Period ' +\n        dtstart.value.slice(0, 10) +\n        ' - ' +\n        dtend.value.slice(0, 10)\n\n      const insertedPane = function (context, subject, paneName) {\n        const p = context.session.paneRegistry.byName(paneName)\n        const d = p.render(subject, context)\n        d.setAttribute('style', 'border: 0.1em solid green;')\n        return d\n      }\n\n      const expandAfterRow = function (dom, row, subject, paneName, solo) {\n        const siblings = row.parentNode.children\n        if (solo) {\n          for (let j = siblings.length - 1; j >= 0; j--) {\n            if (siblings[j].expanded) {\n              siblings[j].parentNode.removeChild(siblings[j].expanded)\n              siblings[j].expanded = false\n            }\n          }\n        }\n        const tr = dom.createElement('tr')\n        const td = tr.appendChild(dom.createElement('td'))\n        td.setAttribute(\n          'style',\n          'width: 98%; padding: 1em; border: 0.1em solid grey;'\n        )\n        const cols = row.children.length\n        if (row.nextSibling) {\n          row.parentNode.insertBefore(tr, row.nextSibling)\n        } else {\n          row.parentNode.appendChild(tr)\n        }\n        row.expanded = tr\n        td.setAttribute('colspan', '' + cols)\n        td.appendChild(insertedPane(context, subject, paneName))\n      }\n\n      const expandAfterRowOrCollapse = function (\n        dom,\n        row,\n        subject,\n        paneName,\n        solo\n      ) {\n        if (row.expanded) {\n          row.parentNode.removeChild(row.expanded)\n          row.expanded = false\n        } else {\n          expandAfterRow(dom, row, subject, paneName, solo)\n        }\n      }\n\n      const transactionTable = function (dom, list) {\n        const table = dom.createElement('table')\n        table.setAttribute(\n          'style',\n          'margin-left: 100; font-size: 9pt; width: 85%;'\n        )\n        const transactionRow = function (dom, x) {\n          const tr = dom.createElement('tr')\n\n          const setTRStyle = function (tr, account) {\n            // var mystyle = \"padding: 0.5em 1.5em 1em 1.5em; \";\n            let mystyle = 'margin-left: 8em; padding-left: 5em;'\n            if (account) {\n              const backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n              if (backgroundColor) {\n                mystyle += 'background-color: ' + backgroundColor.value + '; '\n              }\n            }\n            tr.setAttribute('style', mystyle)\n          }\n\n          const account = kb.any(x, ns.qu('toAccount'))\n          setTRStyle(tr, account)\n\n          const c0 = tr.appendChild(dom.createElement('td'))\n          const date = kb.any(x, ns.qu('date'))\n          c0.textContent = date ? date.value.slice(0, 10) : '???'\n          c0.setAttribute('style', 'width: 7em;')\n\n          const c1 = tr.appendChild(dom.createElement('td'))\n          c1.setAttribute('style', 'width: 36em;')\n          const payee = kb.any(x, ns.qu('payee'))\n          c1.textContent = payee ? payee.value : '???'\n          const a1 = c1.appendChild(dom.createElement('a'))\n          a1.textContent = ' ➜'\n          a1.setAttribute('href', x.uri)\n\n          const c3 = tr.appendChild(dom.createElement('td'))\n          const amount = kb.any(x, ns.qu('in_USD'))\n          c3.textContent = amount ? d2(amount.value) : '???'\n          c3.setAttribute('style', 'width: 6em; text-align: right; ') // @@ decimal alignment?\n          tr.addEventListener(\n            'click',\n            function (e) {\n              // solo unless shift key\n              expandAfterRowOrCollapse(dom, tr, x, 'transaction', !e.shiftKey)\n            },\n            false\n          )\n\n          return tr\n        }\n\n        const list2 = list.filter(transactionInPeriod)\n        list2.sort(oderByDate)\n\n        for (let i = 0; i < list2.length; i++) {\n          table.appendChild(transactionRow(dom, list2[i]))\n        }\n        return table\n      }\n\n      // List unclassified transactions\n\n      const dummies = {\n        'http://www.w3.org/2000/10/swap/pim/qif#Transaction': true, // (we knew)\n        'http://www.w3.org/2000/10/swap/pim/qif#Unclassified': true, // pseudo classifications we may phase out\n        'http://www.w3.org/2000/10/swap/pim/qif#UnclassifiedOutgoing': true,\n        'http://www.w3.org/2000/10/swap/pim/qif#UnclassifiedIncome': true\n      }\n      const xURIs = kb.findMemberURIs(ns.qu('Transaction'))\n      const unclassifiedIn = []\n      const unclassifiedOut = []\n      let usd, z\n      for (const y in xURIs) {\n        // For each thing which can be inferred to be a transaction\n        // @@ TODO: Write away the need for exception on next line\n\n        if (Object.prototype.hasOwnProperty.call(xURIs, y)) {\n          z = kb.sym(y)\n          const tt = kb.each(z, ns.rdf('type')) // What EXPLICIT definitions\n          let classified = false\n          for (let j = 0; j < tt.length; j++) {\n            const t = tt[j]\n            if (dummies[t.uri] === undefined) {\n              classified = true\n            }\n          }\n          if (!classified) {\n            usd = kb.any(z, ns.qu('in_USD'))\n            if (usd === undefined) {\n              usd = kb.any(z, ns.qu('amount'))\n            }\n            if (usd && ('' + usd.value).indexOf('-') >= 0) {\n              unclassifiedOut.push(kb.sym(y))\n            } else {\n              unclassifiedIn.push(kb.sym(y))\n            }\n          }\n        }\n      }\n      let tab, count\n      if (unclassifiedIn.length) {\n        tab = transactionTable(dom, unclassifiedIn)\n        count = tab.children.length\n        div.appendChild(dom.createElement('h3')).textContent =\n          'Unclassified Income' + (count < 4 ? '' : ' (' + count + ')')\n        div.appendChild(tab)\n      } else {\n        happy('No unclassified income')\n      }\n      if (unclassifiedOut.length) {\n        tab = transactionTable(dom, unclassifiedOut)\n        count = tab.children.length\n        div.appendChild(dom.createElement('h3')).textContent =\n          'Unclassified Outgoings' + (count < 4 ? '' : ' (' + count + ')')\n        div.appendChild(tab)\n      } else {\n        happy('No unclassified outgoings ')\n      }\n\n      // ///////////////  Check some categories of transaction for having given fields\n\n      const catSymbol = function (catTail) {\n        const cats = kb.findSubClassesNT(ns.qu('Transaction'))\n        for (const cat in cats) {\n          // @@ TODO: Write away the need for exception on next line\n\n          if (Object.prototype.hasOwnProperty.call(cats, cat)) {\n            if (cat.slice(1, -1).split('#')[1] === catTail) {\n              return kb.sym(cat.slice(1, -1))\n            }\n          }\n        }\n        return null\n      }\n\n      const checkCatHasField = function (catTail, pred) {\n        const cat = catSymbol(catTail)\n        let tab\n        const guilty = []\n        let count = 0\n        if (!cat) {\n          complain('Error: No category correspnding to ' + catTail)\n          return null\n        }\n        const list = kb.each(undefined, ns.rdf('type'), cat)\n        for (let i = 0; i < list.length; i++) {\n          if (!kb.any(list[i], pred)) {\n            guilty.push(list[i])\n          }\n        }\n        if (guilty.length) {\n          tab = transactionTable(dom, guilty)\n          count = tab.children.length\n          div.appendChild(dom.createElement('h3')).textContent =\n            UI.utils.label(cat) +\n            ' with no ' +\n            UI.utils.label(pred) +\n            (count < 4 ? '' : ' (' + count + ')')\n          div.appendChild(tab)\n        }\n        return count\n      }\n\n      // Load dynamically as properties of period\n      if (checkCatHasField('Reimbursables', ns.trip('trip')) === 0) {\n        happy('Reimbursables all have trips')\n      }\n      if (checkCatHasField('Other_Inc_Speaking', ns.trip('trip')) === 0) {\n        happy('Speaking income all has trips')\n      }\n      // end of render period instance\n    } // renderPeriod\n\n    // //////////////////////////////////////////////////////////////////////////////\n\n    // var me = authn.currentUser()\n\n    //              Render a single Period\n\n    // This works only if enough metadata about the properties can drive the RDFS\n    // (or actual type statements whichtypically are NOT there on)\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/2000/10/swap/pim/qif#Period']) {\n      const needed = kb.each(subject, ns.rdfs('seeAlso'))\n      console.log('Loading before render: ' + needed.length)\n      kb.fetcher.load(needed).then(function () {\n        renderPeriod()\n      })\n    }\n\n    // if (!me) complain(\"You do not have your Web Id set. Set your Web ID to make changes.\");\n\n    return div\n  }\n}\n// ends\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"pane.js","names":["UI","_interopRequireWildcard","require","_solidLogicJss","$rdf","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ns","formPane","exports","icon","icons","iconBase","name","audience","solid","label","subject","widgets","formsFor","length","log","debug","render","context","kb","session","store","dom","mention","complain","message","style","pre","createElement","setAttribute","box","appendChild","textContent","complainIfBad","ok","body","me","authn","currentUser","ws","each","ui","renderFormsFor","fetcher","nowOrWhenFetched","uri","forms","form","heading","formStore","Util","document","editFormButton","anchor","utils","appendForm","docuri","docpart","updater","editable","doc","any","sym","link","docs","docList","statementsMatching","forEach","st","why","undefined","d","push","sort","_followeach","path","oo","res","concat","slice","date","foobarbaz","login","selectWorkspace","activities","space","j","act","subjectDoc2","start","cal","value","end"],"sources":["../../src/form/pane.js"],"sourcesContent":["/*\n **             Pane for running existing forms for any object\n **\n */\n\nimport * as UI from 'solid-ui-jss'\nimport { authn } from 'solid-logic-jss'\nimport * as $rdf from 'rdflib'\nconst ns = UI.ns\n\nexport const formPane = {\n  icon: UI.icons.iconBase + 'noun_122196.svg',\n\n  name: 'form',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve this pane?\n  label: function (subject) {\n    const n = UI.widgets.formsFor(subject).length\n    UI.log.debug('Form pane: forms for ' + subject + ': ' + n)\n    if (!n) return null\n    return '' + n + ' forms'\n  },\n\n  render: function (subject, context) {\n    const kb = context.session.store\n    const dom = context.dom\n\n    const mention = function complain (message, style) {\n      const pre = dom.createElement('p')\n      pre.setAttribute('style', style || 'color: grey; background-color: white')\n      box.appendChild(pre).textContent = message\n      return pre\n    }\n\n    const complain = function complain (message, style) {\n      mention(message, 'style', style || 'color: grey; background-color: #fdd;')\n    }\n\n    const complainIfBad = function (ok, body) {\n      if (ok) {\n        // setModifiedDate(store, kb, store);\n        // rerender(box);   // Deleted forms at the moment\n      } else complain('Sorry, failed to save your change:\\n' + body)\n    }\n\n    // The question of where to store this data about subject\n    // This in general needs a whole lot more thought\n    // and it connects to the discoverbility through links\n\n    // const t = kb.findTypeURIs(subject)\n\n    const me = authn.currentUser()\n\n    const box = dom.createElement('div')\n    box.setAttribute('class', 'formPane')\n\n    if (!me) {\n      mention(\n        'You are not logged in. If you log in and have ' +\n          'workspaces then you would be able to select workspace in which ' +\n          'to put this new information'\n      )\n    } else {\n      const ws = kb.each(me, ns.ui('workspace'))\n      if (ws.length === 0) {\n        mention(\n          'You don\\'t seem to have any workspaces defined.  ' +\n            'A workspace is a place on the web (http://..) or in ' +\n            'the file system (file:///) to store application data.\\n'\n        )\n      } else {\n        // @@\n      }\n    }\n\n    // Render forms using a given store\n\n    const renderFormsFor = function (store, subject) {\n      kb.fetcher.nowOrWhenFetched(store.uri, subject, function (ok, body) {\n        if (!ok) return complain('Cannot load store ' + store.uri + ': ' + body)\n\n        //              Render the forms\n\n        const forms = UI.widgets.formsFor(subject)\n\n        // complain('Form for editing this form:');\n        for (let i = 0; i < forms.length; i++) {\n          const form = forms[i]\n          const heading = dom.createElement('h4')\n          box.appendChild(heading)\n          if (form.uri) {\n            const formStore = $rdf.Util.uri.document(form.uri)\n            if (formStore.uri !== form.uri) {\n              // The form is a hash-type URI\n              const e = box.appendChild(\n                UI.widgets.editFormButton(\n                  dom,\n                  box,\n                  form,\n                  formStore,\n                  complainIfBad\n                )\n              )\n              e.setAttribute('style', 'float: right;')\n            }\n          }\n          const anchor = dom.createElement('a')\n          anchor.setAttribute('href', form.uri)\n          heading.appendChild(anchor)\n          anchor.textContent = UI.utils.label(form, true)\n\n          /*  Keep tis as a reminder to let a New one have its URI given by user\n          mention(\"Where will this information be stored?\")\n          const ele = dom.createElement('input');\n          box.appendChild(ele);\n          ele.setAttribute('type', 'text');\n          ele.setAttribute('size', '72');\n          ele.setAttribute('maxlength', '1024');\n          ele.setAttribute('style', 'font-size: 80%; color:#222;');\n          ele.value = store.uri\n          */\n\n          UI.widgets.appendForm(\n            dom,\n            box,\n            {},\n            subject,\n            form,\n            store,\n            complainIfBad\n          )\n        }\n      }) // end: when store loded\n    } // renderFormsFor\n\n    // Figure out what store\n\n    // Which places are editable and have stuff about the subject?\n\n    let store = null\n\n    // 1. The document URI of the subject itself\n    const docuri = $rdf.Util.uri.docpart(subject.uri)\n    if (subject.uri !== docuri && kb.updater.editable(docuri, kb)) {\n      store = subject.doc()\n    } // an editable data file with hash\n\n    store = store || kb.any(kb.sym(docuri), ns.link('annotationStore'))\n\n    // 2. where stuff is already stored\n    if (!store) {\n      const docs = {}\n      const docList = []\n      store.statementsMatching(subject).forEach(function (st) {\n        docs[st.why.uri] = 1\n      })\n      store\n        .statementsMatching(undefined, undefined, subject)\n        .forEach(function (st) {\n          docs[st.why.uri] = 2\n        })\n      for (const d in docs) docList.push(docs[d], d)\n      docList.sort()\n      for (let i = 0; i < docList.length; i++) {\n        const uri = docList[i][1]\n        if (uri && store.updater.editable(uri)) {\n          store = store.sym(uri)\n          break\n        }\n      }\n    }\n\n    // 3. In a workspace store\n    // @@ TODO: Can probably remove _followeach (not done this time because the commit is a very safe refactor)\n    const _followeach = function (kb, subject, path) {\n      if (path.length === 0) return [subject]\n      const oo = kb.each(subject, path[0])\n      let res = []\n      for (let i = 0; i < oo.length; i++) {\n        res = res.concat(_followeach(kb, oo[i], path.slice(1)))\n      }\n      return res\n    }\n\n    const date = '2014' // @@@@@@@@@@@@ pass as parameter\n\n    if (store) {\n      // mention(\"@@ Ok, we have a store <\" + store.uri + \">.\");\n      renderFormsFor(store, subject)\n    } else {\n      complain('No suitable store is known, to edit <' + subject.uri + '>.')\n      const foobarbaz = UI.login.selectWorkspace(dom, function (ws) {\n        mention('Workspace selected OK: ' + ws)\n\n        const activities = store.each(undefined, ns.space('workspace'), ws)\n        for (let j = 0; j < activities.length; j++) {\n          const act = activities[j]\n\n          const subjectDoc2 = store.any(ws, ns.space('store'))\n          const start = store.any(ws, ns.cal('dtstart')).value()\n          const end = store.any(ws, ns.cal('dtend')).value()\n          if (subjectDoc2 && start && end && start <= date && end > date) {\n            renderFormsFor(subjectDoc2, subject)\n            break\n          } else {\n            complain('Note no suitable annotation store in activity: ' + act)\n          }\n        }\n      })\n      box.appendChild(foobarbaz)\n    }\n\n    return box\n  }\n}\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"attachPane.js","names":["UI","$rdf","icon","icons","iconBase","name","label","subject","context","kb","session","store","t","findTypeURIs","QU","Namespace","WF","uri","findSuperClassesNT","holds","render","dom","complain","message","pre","createElement","setAttribute","div","appendChild","createTextNode","findStore","updater","editable","doc","any","esc","utils","escapeForXML","innerHTML","predicate","range","subjects","multi","options","currentMode","currentSubject","currentObject","objectType","getSortKeySimple","_c","uriMap","sym","ns","ui","getSortKey","c","k","sup","cl","fromNT","undefined","getMembersAndSort","sortBy","u","x","key","uriHash","findMemberURIs","pairs","Object","prototype","hasOwnProperty","call","value","push","sort","reverse","i","length","objects","deselectObject","preview","showFiltered","mode","filtered","getFiltered","widgets","selectorPanelRefresh","objectList","showObject","linkClicked","filter","y","each","setAttachment","refresh","verb","linkDone3","ok","body","sts","st","update","event","inverse","s","o","showSubject","selected","subjectList","selectorPanel","fetcher","load","then","outliner","getOutliner","display","propertyTable","catch","err","textContent","e","headerButtons","labels","intial","callback","head","current","tr","style0","style1","setStyles","buttons","b","listen","addEventListener","_e","setMode","wrapper","stores","storeURI","mintBox","storeLab","_event","thisForm","promptForNew","_body","insertBefore","nextSibling"],"sources":["../../src/attach/attachPane.js"],"sourcesContent":["/*   Attachment Pane\n **\n ** - Attach a document to a thing\n **  - View attachments\n ** - Look at all unattached Supporting Documents.\n ** - Drag a document onto the pane to attach it @@\n **\n **\n */\n\nimport * as UI from 'solid-ui-jss'\nimport * as $rdf from 'rdflib'\n\nexport default {\n  icon: UI.icons.iconBase + 'noun_25830.svg', // noun_25830\n\n  name: 'attachments',\n\n  // Does the subject deserve an attachments pane?\n  //\n  //  In this case we will render any thing which is in any subclass of\n  //  certain classes, or also the certain classes themselves, as a\n  //  triage tool for correlating many attachees with attachments.\n  // We also offer the pane for anything of any class which just has an attachment already.\n  //\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    const QU = $rdf.Namespace('http://www.w3.org/2000/10/swap/pim/qif#')\n    const WF = $rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n    if (\n      t['http://www.w3.org/ns/pim/trip#Trip'] || // If in any subclass\n      subject.uri === 'http://www.w3.org/ns/pim/trip#Trip' ||\n      t['http://www.w3.org/2005/01/wf/flow#Task'] ||\n      t['http://www.w3.org/2000/10/swap/pim/qif#Transaction'] ||\n      // subject.uri == 'http://www.w3.org/2000/10/swap/pim/qif#Transaction' ||\n      QU('Transaction') in kb.findSuperClassesNT(subject) ||\n      kb.holds(subject, WF('attachment'))\n    ) {\n      return 'attachments'\n    }\n    return null\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const WF = $rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n    const QU = $rdf.Namespace('http://www.w3.org/2000/10/swap/pim/qif#')\n\n    // ////////////////////////////////////////////////////////////////////////////\n\n    const complain = function complain (message) {\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', 'background-color: pink')\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n\n    // Where can we write about this thing?\n    //\n    // Returns term for document or null\n    const findStore = function (kb, subject) {\n      if (kb.updater.editable(subject.doc(), kb)) return subject.doc()\n      const store = kb.any(subject.doc(), QU('annotationStore'))\n      return store\n    }\n\n    const div = dom.createElement('div')\n    const esc = UI.utils.escapeForXML\n    div.setAttribute('class', 'attachPane')\n    div.innerHTML =\n      '<h1>' + esc(UI.utils.label(subject, true)) + ' attachments</h1>' //\n\n    const predicate = WF('attachment')\n    const range = QU('SupportingDocument')\n\n    let subjects, multi\n    const options = {}\n    let currentMode = 0 // 0 -> Show all;  1 -> Attached;    2 -> unattached\n    let currentSubject = null\n    let currentObject = null\n    const objectType = QU('SupportingDocument')\n\n    // Find all members of the class which we know about\n    // and sort them by an appropriate property.   @@ Move to library\n    //\n\n    const getSortKeySimple = function (_c) {\n      const uriMap = {\n        'http://www.w3.org/2005/01/wf/flow#Task': 'http://purl.org/dc/elements/1.1/created',\n        'http://www.w3.org/ns/pim/trip#Trip': 'http://www.w3.org/2002/12/cal/ical#dtstart',\n        'http://www.w3.org/2000/10/swap/pim/qif#Transaction': 'http://www.w3.org/2000/10/swap/pim/qif#date',\n        'http://www.w3.org/2000/10/swap/pim/qif#SupportingDocument': 'http://purl.org/dc/elements/1.1/date'\n      }\n      const uri = uriMap[subject.uri]\n      return uri ? kb.sym(uri) : kb.any(subject, UI.ns.ui('sortBy'))\n    }\n\n    const getSortKey = function (c) {\n      let k = getSortKeySimple(c.uri)\n      if (k) return k\n      const sup = kb.findSuperClassesNT(c)\n      for (const cl in sup) {\n        // note unordered -- could be closest first\n        k = getSortKeySimple(kb.fromNT(cl).uri)\n        if (k) return k\n      }\n      return undefined // failure\n    }\n\n    const getMembersAndSort = function (subject) {\n      const sortBy = getSortKey(subject)\n      let u, x, key\n      const uriHash = kb.findMemberURIs(subject)\n      const pairs = []\n      const subjects = []\n      for (u in uriHash) {\n        // @@ TODO: Write away the need for exception on next line\n\n        if (Object.prototype.hasOwnProperty.call(uriHash, u)) {\n          x = kb.sym(u)\n          if (sortBy) {\n            key = kb.any(x, sortBy)\n            if (!key) {\n              // complain(\"No key \"+key+\" sortby \"+sortBy+\" for \"+x)\n              key = '8888-12-31'\n            } else {\n              key = key.value\n            }\n          } else {\n            complain('No sortby ' + sortBy + ' for ' + x)\n            key = '9999-12-31'\n          }\n          // key = (sortBy && kb.any(x, sortBy)) || kb.literal(\"9999-12-31\") // Undated appear future\n          // if (!key) complain(\"Sort: '\"+key+\"' No \"+sortBy+\" for \"+x) // Assume just not in this year\n          pairs.push([key, x])\n        }\n      }\n      pairs.sort()\n      pairs.reverse() // @@ Descending order .. made a toggle?\n      for (let i = 0; i < pairs.length; i++) {\n        subjects.push(pairs[i][1])\n      }\n      return subjects\n    }\n\n    // Set up a triage of many class members against documents or just one\n    if (\n      subject.uri === 'http://www.w3.org/ns/pim/trip#Trip' ||\n      QU('Transaction') in kb.findSuperClassesNT(subject)\n      // subject.uri == 'http://www.w3.org/2000/10/swap/pim/qif#Transaction'\n    ) {\n      multi = true\n      subjects = getMembersAndSort(subject)\n    } else {\n      currentSubject = subject\n      currentMode = 1 // Show attached only.\n      subjects = [subject]\n      multi = false\n    }\n\n    // var store = findStore(kb, subject)\n    // if (!store) complain(\"There is no annotation store for: \"+subject.uri)\n\n    // var objects = kb.each(undefined, ns.rdf('type'), range)\n    const objects = getMembersAndSort(range)\n    if (!objects) complain('objects:' + objects.length)\n\n    const deselectObject = function () {\n      currentObject = null\n      preview.innerHTML = ''\n    }\n\n    const showFiltered = function (mode) {\n      const filtered = mode === 0 ? objects : getFiltered()\n      // eslint-enable\n      UI.widgets.selectorPanelRefresh(\n        objectList,\n        dom,\n        kb,\n        objectType,\n        predicate,\n        true,\n        filtered,\n        options,\n        showObject,\n        linkClicked\n      )\n      if (filtered.length === 1) {\n        currentObject = filtered[0]\n        showObject(currentObject, null, true) // @@ (Sure?) if only one select it.\n      } else {\n        deselectObject()\n      }\n\n      function getFiltered () {\n        return mode === 1\n          ? currentSubject === null\n            ? objects.filter(y => !!kb.holds(undefined, predicate, y))\n            : objects.filter(y => !!kb.holds(currentSubject, predicate, y))\n          : objects.filter(y => kb.each(undefined, predicate, y).length === 0)\n      }\n    }\n\n    const setAttachment = function (x, y, value, refresh) {\n      if (kb.holds(x, predicate, y) === value) return\n      const verb = value ? 'attach' : 'detach'\n      // complain(\"Info: starting to \"+verb+\" \" + y.uri + \" to \"+x.uri+ \":\\n\")\n      const linkDone3 = function (uri, ok, body) {\n        if (ok) {\n          // complain(\"Success \"+verb+\" \"+y.uri+\" to \"+x.uri+ \":\\n\"+ body)\n          refresh()\n        } else {\n          complain(\n            'Error: Unable to ' +\n              verb +\n              ' ' +\n              y.uri +\n              ' to ' +\n              x.uri +\n              ':\\n' +\n              body\n          )\n        }\n      }\n\n      const store = findStore(kb, x)\n      if (!store) {\n        complain('There is no annotation store for: ' + x.uri)\n      } else {\n        const sts = [$rdf.st(x, predicate, y, store)]\n        if (value) {\n          kb.updater.update([], sts, linkDone3)\n        } else {\n          kb.updater.update(sts, [], linkDone3)\n        }\n      }\n    }\n\n    const linkClicked = function (x, event, inverse, refresh) {\n      let s, o\n      if (inverse) {\n        // Objectlist\n        if (!currentSubject) {\n          complain('No subject for the link has been selected')\n          return\n        } else {\n          s = currentSubject\n          o = x\n        }\n      } else {\n        // Subjectlist\n        if (!currentObject) {\n          complain('No object for the link has been selected')\n          return\n        } else {\n          s = x\n          o = currentObject\n        }\n      }\n      setAttachment(s, o, !kb.holds(s, predicate, o), refresh) // @@ toggle\n    }\n\n    // When you click on a subject, filter the objects connected to the subject in Mode 1\n    const showSubject = function (x, event, selected) {\n      if (selected) {\n        currentSubject = x\n      } else {\n        currentSubject = null\n        if (currentMode === 1) deselectObject()\n      } // If all are displayed, refresh would just annoy:\n      if (currentMode !== 0) showFiltered(currentMode) // Refresh the objects\n    }\n\n    if (multi) {\n      const subjectList = UI.widgets.selectorPanel(\n        dom,\n        kb,\n        subject,\n        predicate,\n        false,\n        subjects,\n        options,\n        showSubject,\n        linkClicked\n      )\n      subjectList.setAttribute(\n        'style',\n        'background-color: white;  width: 25em; height: 100%; padding: 0 em; overflow:scroll; float:left'\n      )\n      div.appendChild(subjectList)\n    }\n\n    const showObject = function (x, event, selected) {\n      if (!selected) {\n        deselectObject()\n        preview.innerHTML = '' // Clean out what is there\n        // complain(\"Show object \"+x.uri)\n        return\n      }\n      currentObject = x\n      try {\n        /*\n        var dispalyable = function (kb, x) {\n          var cts = kb.fetcher.getHeader(x, 'content-type')\n          if (cts) {\n            var displayables = ['text/html', 'image/png', 'application/pdf']\n            for (var j = 0; j < cts.length; j++) {\n              for (var k = 0; k < displayables.length; k++) {\n                if (cts[j].indexOf(displayables[k]) >= 0) {\n                  return true\n                }\n              }\n            }\n          }\n          return false\n        }\n        */\n        preview.innerHTML = 'Loading ....'\n        if (x.uri) {\n          kb.fetcher\n            .load(x.uri)\n            .then(() => {\n              const outliner = context.getOutliner(dom)\n              const display = outliner.propertyTable(x) //  ,table, pane\n              preview.innerHTML = ''\n              preview.appendChild(display)\n            })\n            .catch(err => {\n              preview.textContent = 'Error loading ' + x.uri + ': ' + err\n            })\n        }\n        /*\n              if (dispalyable(kb, x) || x.uri.slice(-4) == \".pdf\" || x.uri.slice(-4) == \".png\" || x.uri.slice(-5) == \".html\" ||\n                      x.uri.slice(-5) == \".jpeg\") { // @@@@@@ MAJOR KLUDGE! use metadata after HEAD\n                  preview.innerHTML = '<iframe height=\"100%\" width=\"100%\"src=\"'\n                      + x.uri + '\">' + x.uri + '</iframe>'\n              } else {\n              }\n          */\n      } catch (e) {\n        preview.innerHTML =\n          '<span style=\"background-color: pink;\">' + 'Error:' + e + '</span>' // @@ enc\n      }\n    }\n\n    div.setAttribute(\n      'style',\n      'background-color: white; width:40cm; height:20cm;'\n    )\n\n    const headerButtons = function (dom, labels, intial, callback) {\n      const head = dom.createElement('table')\n      let current = intial\n      head.setAttribute(\n        'style',\n        'float: left; width: 30em; padding: 0.5em; height: 1.5em; background-color: #ddd; color: #444; font-weight: bold'\n      )\n      const tr = dom.createElement('tr')\n      const style0 = 'border-radius: 0.6em; text-align: center;'\n      const style1 = style0 + 'background-color: #ccc; color: black;'\n      head.appendChild(tr)\n      const setStyles = function () {\n        for (i = 0; i < labels.length; i++) {\n          buttons[i].setAttribute('style', i === current ? style1 : style0)\n        }\n      }\n      let i, b\n      const buttons = []\n      for (i = 0; i < labels.length; i++) {\n        b = buttons[i] = dom.createElement('td')\n        b.textContent = labels[i]\n        tr.appendChild(buttons[i])\n        const listen = function (b, i) {\n          b.addEventListener('click', function (_e) {\n            current = i\n            setStyles()\n            callback(i)\n          })\n        }\n        listen(b, i)\n      }\n      setStyles()\n      return head\n    }\n\n    const setMode = function (mode) {\n      if (mode !== currentMode) {\n        currentMode = mode\n        deselectObject()\n        showFiltered(mode)\n      }\n    }\n\n    const wrapper = dom.createElement('div')\n    wrapper.setAttribute(\n      'style',\n      ' width: 30em; height: 100%;  padding: 0em; float:left;'\n    )\n    // wrapper.appendChild(head)\n    div.appendChild(wrapper)\n    wrapper.appendChild(\n      headerButtons(\n        dom,\n        ['all', 'attached', 'not attached'],\n        currentMode,\n        setMode\n      )\n    )\n\n    const objectList = UI.widgets.selectorPanel(\n      dom,\n      kb,\n      objectType,\n      predicate,\n      true,\n      objects,\n      options,\n      showObject,\n      linkClicked\n    )\n    objectList.setAttribute(\n      'style',\n      'background-color: #ffe;  width: 30em; height: 100%; padding: 0em; overflow:scroll;'\n    ) // float:left\n    wrapper.appendChild(objectList)\n\n    // objectList.insertBefore(head, objectList.firstChild)\n\n    const preview = dom.createElement('div')\n    preview.setAttribute(\n      'style',\n      /* background-color: black; */ 'padding: 0em; margin: 0;  height: 100%; overflow:scroll;'\n    )\n    div.appendChild(preview)\n    showFiltered(currentMode)\n\n    if (subjects.length > 0 && multi) {\n      const stores = {}\n      for (let k = 0; k < subjects.length; k++) {\n        const store = findStore(kb, subjects[k])\n        if (store) stores[store.uri] = subjects[k]\n        // if (!store) complain(\"No store for \"+subjects[k].uri)\n      }\n      for (const storeURI in stores) {\n        // var store = findStore(kb,subjects[subjectList.length-1])\n        const store = kb.sym(storeURI)\n        const mintBox = dom.createElement('div')\n        mintBox.setAttribute(\n          'style',\n          'clear: left; width: 20em; margin-top:2em; background-color:#ccc; border-radius: 1em; padding: 1em; font-weight: bold;'\n        )\n        mintBox.textContent = '+ New ' + UI.utils.label(subject)\n\n        mintBox.textContent += ' in ' + UI.utils.label(store)\n        const storeLab = dom.createElement('span')\n        storeLab.setAttribute(\n          'style',\n          'font-weight: normal; font-size: 80%; color: #777;'\n        )\n        storeLab.textContent = storeURI\n        mintBox.appendChild(dom.createElement('br'))\n        mintBox.appendChild(storeLab)\n        /*\n        var mintButton = dom.createElement('img')\n        mintBox.appendChild(mintButton)\n        mintButton.setAttribute('src', ...); @@ Invokes master handler\n        */\n        mintBox.addEventListener(\n          'click',\n          function (_event) {\n            const thisForm = UI.widgets.promptForNew(\n              dom,\n              kb,\n              subject,\n              predicate,\n              subject,\n              null,\n              store,\n              function (ok, _body) {\n                if (!ok) {\n                  // callback(ok, body); // @@ if ok, need some form of refresh of the select for the new thing\n                } else {\n                  // Refresh @@\n                }\n              }\n            )\n            try {\n              div.insertBefore(thisForm, mintBox.nextSibling) // Sigh no insertAfter\n            } catch (e) {\n              div.appendChild(thisForm)\n            }\n            // var newObject = thisForm.AJAR_subject\n          },\n          false\n        )\n        div.appendChild(mintBox)\n      }\n    }\n\n    // if (!me) complain(\"(You do not have your Web Id set. Set your Web ID to make changes.)\")\n\n    return div\n  }\n} // pane object\n\n// ends\n"],"mappings":"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","ignoreList":[]}
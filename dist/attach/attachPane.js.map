{"version":3,"file":"attachPane.js","names":["UI","_interopRequireWildcard","require","$rdf","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_default","exports","icon","icons","iconBase","name","label","subject","context","kb","session","store","findTypeURIs","QU","Namespace","WF","uri","findSuperClassesNT","holds","render","dom","complain","message","pre","createElement","setAttribute","div","appendChild","createTextNode","findStore","updater","editable","doc","any","esc","utils","escapeForXML","innerHTML","predicate","range","subjects","multi","options","currentMode","currentSubject","currentObject","objectType","getSortKeySimple","_c","uriMap","sym","ns","ui","getSortKey","c","k","sup","cl","fromNT","undefined","getMembersAndSort","sortBy","u","x","key","uriHash","findMemberURIs","pairs","prototype","value","push","sort","reverse","length","objects","deselectObject","preview","showFiltered","mode","filtered","getFiltered","widgets","selectorPanelRefresh","objectList","showObject","linkClicked","filter","y","each","setAttachment","refresh","verb","linkDone3","ok","body","sts","st","update","event","inverse","s","showSubject","selected","subjectList","selectorPanel","fetcher","load","then","outliner","getOutliner","display","propertyTable","catch","err","textContent","headerButtons","labels","intial","callback","head","current","tr","style0","style1","setStyles","buttons","b","listen","addEventListener","_e","setMode","wrapper","stores","storeURI","mintBox","storeLab","_event","thisForm","promptForNew","_body","insertBefore","nextSibling"],"sources":["../../src/attach/attachPane.js"],"sourcesContent":["/*   Attachment Pane\n **\n ** - Attach a document to a thing\n **  - View attachments\n ** - Look at all unattached Supporting Documents.\n ** - Drag a document onto the pane to attach it @@\n **\n **\n */\n\nimport * as UI from 'solid-ui-jss'\nimport * as $rdf from 'rdflib'\n\nexport default {\n  icon: UI.icons.iconBase + 'noun_25830.svg', // noun_25830\n\n  name: 'attachments',\n\n  // Does the subject deserve an attachments pane?\n  //\n  //  In this case we will render any thing which is in any subclass of\n  //  certain classes, or also the certain classes themselves, as a\n  //  triage tool for correlating many attachees with attachments.\n  // We also offer the pane for anything of any class which just has an attachment already.\n  //\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    const QU = $rdf.Namespace('http://www.w3.org/2000/10/swap/pim/qif#')\n    const WF = $rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n    if (\n      t['http://www.w3.org/ns/pim/trip#Trip'] || // If in any subclass\n      subject.uri === 'http://www.w3.org/ns/pim/trip#Trip' ||\n      t['http://www.w3.org/2005/01/wf/flow#Task'] ||\n      t['http://www.w3.org/2000/10/swap/pim/qif#Transaction'] ||\n      // subject.uri == 'http://www.w3.org/2000/10/swap/pim/qif#Transaction' ||\n      QU('Transaction') in kb.findSuperClassesNT(subject) ||\n      kb.holds(subject, WF('attachment'))\n    ) {\n      return 'attachments'\n    }\n    return null\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const WF = $rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n    const QU = $rdf.Namespace('http://www.w3.org/2000/10/swap/pim/qif#')\n\n    // ////////////////////////////////////////////////////////////////////////////\n\n    const complain = function complain (message) {\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', 'background-color: pink')\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n\n    // Where can we write about this thing?\n    //\n    // Returns term for document or null\n    const findStore = function (kb, subject) {\n      if (kb.updater.editable(subject.doc(), kb)) return subject.doc()\n      const store = kb.any(subject.doc(), QU('annotationStore'))\n      return store\n    }\n\n    const div = dom.createElement('div')\n    const esc = UI.utils.escapeForXML\n    div.setAttribute('class', 'attachPane')\n    div.innerHTML =\n      '<h1>' + esc(UI.utils.label(subject, true)) + ' attachments</h1>' //\n\n    const predicate = WF('attachment')\n    const range = QU('SupportingDocument')\n\n    let subjects, multi\n    const options = {}\n    let currentMode = 0 // 0 -> Show all;  1 -> Attached;    2 -> unattached\n    let currentSubject = null\n    let currentObject = null\n    const objectType = QU('SupportingDocument')\n\n    // Find all members of the class which we know about\n    // and sort them by an appropriate property.   @@ Move to library\n    //\n\n    const getSortKeySimple = function (_c) {\n      const uriMap = {\n        'http://www.w3.org/2005/01/wf/flow#Task': 'http://purl.org/dc/elements/1.1/created',\n        'http://www.w3.org/ns/pim/trip#Trip': 'http://www.w3.org/2002/12/cal/ical#dtstart',\n        'http://www.w3.org/2000/10/swap/pim/qif#Transaction': 'http://www.w3.org/2000/10/swap/pim/qif#date',\n        'http://www.w3.org/2000/10/swap/pim/qif#SupportingDocument': 'http://purl.org/dc/elements/1.1/date'\n      }\n      const uri = uriMap[subject.uri]\n      return uri ? kb.sym(uri) : kb.any(subject, UI.ns.ui('sortBy'))\n    }\n\n    const getSortKey = function (c) {\n      let k = getSortKeySimple(c.uri)\n      if (k) return k\n      const sup = kb.findSuperClassesNT(c)\n      for (const cl in sup) {\n        // note unordered -- could be closest first\n        k = getSortKeySimple(kb.fromNT(cl).uri)\n        if (k) return k\n      }\n      return undefined // failure\n    }\n\n    const getMembersAndSort = function (subject) {\n      const sortBy = getSortKey(subject)\n      let u, x, key\n      const uriHash = kb.findMemberURIs(subject)\n      const pairs = []\n      const subjects = []\n      for (u in uriHash) {\n        // @@ TODO: Write away the need for exception on next line\n\n        if (Object.prototype.hasOwnProperty.call(uriHash, u)) {\n          x = kb.sym(u)\n          if (sortBy) {\n            key = kb.any(x, sortBy)\n            if (!key) {\n              // complain(\"No key \"+key+\" sortby \"+sortBy+\" for \"+x)\n              key = '8888-12-31'\n            } else {\n              key = key.value\n            }\n          } else {\n            complain('No sortby ' + sortBy + ' for ' + x)\n            key = '9999-12-31'\n          }\n          // key = (sortBy && kb.any(x, sortBy)) || kb.literal(\"9999-12-31\") // Undated appear future\n          // if (!key) complain(\"Sort: '\"+key+\"' No \"+sortBy+\" for \"+x) // Assume just not in this year\n          pairs.push([key, x])\n        }\n      }\n      pairs.sort()\n      pairs.reverse() // @@ Descending order .. made a toggle?\n      for (let i = 0; i < pairs.length; i++) {\n        subjects.push(pairs[i][1])\n      }\n      return subjects\n    }\n\n    // Set up a triage of many class members against documents or just one\n    if (\n      subject.uri === 'http://www.w3.org/ns/pim/trip#Trip' ||\n      QU('Transaction') in kb.findSuperClassesNT(subject)\n      // subject.uri == 'http://www.w3.org/2000/10/swap/pim/qif#Transaction'\n    ) {\n      multi = true\n      subjects = getMembersAndSort(subject)\n    } else {\n      currentSubject = subject\n      currentMode = 1 // Show attached only.\n      subjects = [subject]\n      multi = false\n    }\n\n    // var store = findStore(kb, subject)\n    // if (!store) complain(\"There is no annotation store for: \"+subject.uri)\n\n    // var objects = kb.each(undefined, ns.rdf('type'), range)\n    const objects = getMembersAndSort(range)\n    if (!objects) complain('objects:' + objects.length)\n\n    const deselectObject = function () {\n      currentObject = null\n      preview.innerHTML = ''\n    }\n\n    const showFiltered = function (mode) {\n      const filtered = mode === 0 ? objects : getFiltered()\n      // eslint-enable\n      UI.widgets.selectorPanelRefresh(\n        objectList,\n        dom,\n        kb,\n        objectType,\n        predicate,\n        true,\n        filtered,\n        options,\n        showObject,\n        linkClicked\n      )\n      if (filtered.length === 1) {\n        currentObject = filtered[0]\n        showObject(currentObject, null, true) // @@ (Sure?) if only one select it.\n      } else {\n        deselectObject()\n      }\n\n      function getFiltered () {\n        return mode === 1\n          ? currentSubject === null\n            ? objects.filter(y => !!kb.holds(undefined, predicate, y))\n            : objects.filter(y => !!kb.holds(currentSubject, predicate, y))\n          : objects.filter(y => kb.each(undefined, predicate, y).length === 0)\n      }\n    }\n\n    const setAttachment = function (x, y, value, refresh) {\n      if (kb.holds(x, predicate, y) === value) return\n      const verb = value ? 'attach' : 'detach'\n      // complain(\"Info: starting to \"+verb+\" \" + y.uri + \" to \"+x.uri+ \":\\n\")\n      const linkDone3 = function (uri, ok, body) {\n        if (ok) {\n          // complain(\"Success \"+verb+\" \"+y.uri+\" to \"+x.uri+ \":\\n\"+ body)\n          refresh()\n        } else {\n          complain(\n            'Error: Unable to ' +\n              verb +\n              ' ' +\n              y.uri +\n              ' to ' +\n              x.uri +\n              ':\\n' +\n              body\n          )\n        }\n      }\n\n      const store = findStore(kb, x)\n      if (!store) {\n        complain('There is no annotation store for: ' + x.uri)\n      } else {\n        const sts = [$rdf.st(x, predicate, y, store)]\n        if (value) {\n          kb.updater.update([], sts, linkDone3)\n        } else {\n          kb.updater.update(sts, [], linkDone3)\n        }\n      }\n    }\n\n    const linkClicked = function (x, event, inverse, refresh) {\n      let s, o\n      if (inverse) {\n        // Objectlist\n        if (!currentSubject) {\n          complain('No subject for the link has been selected')\n          return\n        } else {\n          s = currentSubject\n          o = x\n        }\n      } else {\n        // Subjectlist\n        if (!currentObject) {\n          complain('No object for the link has been selected')\n          return\n        } else {\n          s = x\n          o = currentObject\n        }\n      }\n      setAttachment(s, o, !kb.holds(s, predicate, o), refresh) // @@ toggle\n    }\n\n    // When you click on a subject, filter the objects connected to the subject in Mode 1\n    const showSubject = function (x, event, selected) {\n      if (selected) {\n        currentSubject = x\n      } else {\n        currentSubject = null\n        if (currentMode === 1) deselectObject()\n      } // If all are displayed, refresh would just annoy:\n      if (currentMode !== 0) showFiltered(currentMode) // Refresh the objects\n    }\n\n    if (multi) {\n      const subjectList = UI.widgets.selectorPanel(\n        dom,\n        kb,\n        subject,\n        predicate,\n        false,\n        subjects,\n        options,\n        showSubject,\n        linkClicked\n      )\n      subjectList.setAttribute(\n        'style',\n        'background-color: white;  width: 25em; height: 100%; padding: 0 em; overflow:scroll; float:left'\n      )\n      div.appendChild(subjectList)\n    }\n\n    const showObject = function (x, event, selected) {\n      if (!selected) {\n        deselectObject()\n        preview.innerHTML = '' // Clean out what is there\n        // complain(\"Show object \"+x.uri)\n        return\n      }\n      currentObject = x\n      try {\n        /*\n        var dispalyable = function (kb, x) {\n          var cts = kb.fetcher.getHeader(x, 'content-type')\n          if (cts) {\n            var displayables = ['text/html', 'image/png', 'application/pdf']\n            for (var j = 0; j < cts.length; j++) {\n              for (var k = 0; k < displayables.length; k++) {\n                if (cts[j].indexOf(displayables[k]) >= 0) {\n                  return true\n                }\n              }\n            }\n          }\n          return false\n        }\n        */\n        preview.innerHTML = 'Loading ....'\n        if (x.uri) {\n          kb.fetcher\n            .load(x.uri)\n            .then(() => {\n              const outliner = context.getOutliner(dom)\n              const display = outliner.propertyTable(x) //  ,table, pane\n              preview.innerHTML = ''\n              preview.appendChild(display)\n            })\n            .catch(err => {\n              preview.textContent = 'Error loading ' + x.uri + ': ' + err\n            })\n        }\n        /*\n              if (dispalyable(kb, x) || x.uri.slice(-4) == \".pdf\" || x.uri.slice(-4) == \".png\" || x.uri.slice(-5) == \".html\" ||\n                      x.uri.slice(-5) == \".jpeg\") { // @@@@@@ MAJOR KLUDGE! use metadata after HEAD\n                  preview.innerHTML = '<iframe height=\"100%\" width=\"100%\"src=\"'\n                      + x.uri + '\">' + x.uri + '</iframe>'\n              } else {\n              }\n          */\n      } catch (e) {\n        preview.innerHTML =\n          '<span style=\"background-color: pink;\">' + 'Error:' + e + '</span>' // @@ enc\n      }\n    }\n\n    div.setAttribute(\n      'style',\n      'background-color: white; width:40cm; height:20cm;'\n    )\n\n    const headerButtons = function (dom, labels, intial, callback) {\n      const head = dom.createElement('table')\n      let current = intial\n      head.setAttribute(\n        'style',\n        'float: left; width: 30em; padding: 0.5em; height: 1.5em; background-color: #ddd; color: #444; font-weight: bold'\n      )\n      const tr = dom.createElement('tr')\n      const style0 = 'border-radius: 0.6em; text-align: center;'\n      const style1 = style0 + 'background-color: #ccc; color: black;'\n      head.appendChild(tr)\n      const setStyles = function () {\n        for (i = 0; i < labels.length; i++) {\n          buttons[i].setAttribute('style', i === current ? style1 : style0)\n        }\n      }\n      let i, b\n      const buttons = []\n      for (i = 0; i < labels.length; i++) {\n        b = buttons[i] = dom.createElement('td')\n        b.textContent = labels[i]\n        tr.appendChild(buttons[i])\n        const listen = function (b, i) {\n          b.addEventListener('click', function (_e) {\n            current = i\n            setStyles()\n            callback(i)\n          })\n        }\n        listen(b, i)\n      }\n      setStyles()\n      return head\n    }\n\n    const setMode = function (mode) {\n      if (mode !== currentMode) {\n        currentMode = mode\n        deselectObject()\n        showFiltered(mode)\n      }\n    }\n\n    const wrapper = dom.createElement('div')\n    wrapper.setAttribute(\n      'style',\n      ' width: 30em; height: 100%;  padding: 0em; float:left;'\n    )\n    // wrapper.appendChild(head)\n    div.appendChild(wrapper)\n    wrapper.appendChild(\n      headerButtons(\n        dom,\n        ['all', 'attached', 'not attached'],\n        currentMode,\n        setMode\n      )\n    )\n\n    const objectList = UI.widgets.selectorPanel(\n      dom,\n      kb,\n      objectType,\n      predicate,\n      true,\n      objects,\n      options,\n      showObject,\n      linkClicked\n    )\n    objectList.setAttribute(\n      'style',\n      'background-color: #ffe;  width: 30em; height: 100%; padding: 0em; overflow:scroll;'\n    ) // float:left\n    wrapper.appendChild(objectList)\n\n    // objectList.insertBefore(head, objectList.firstChild)\n\n    const preview = dom.createElement('div')\n    preview.setAttribute(\n      'style',\n      /* background-color: black; */ 'padding: 0em; margin: 0;  height: 100%; overflow:scroll;'\n    )\n    div.appendChild(preview)\n    showFiltered(currentMode)\n\n    if (subjects.length > 0 && multi) {\n      const stores = {}\n      for (let k = 0; k < subjects.length; k++) {\n        const store = findStore(kb, subjects[k])\n        if (store) stores[store.uri] = subjects[k]\n        // if (!store) complain(\"No store for \"+subjects[k].uri)\n      }\n      for (const storeURI in stores) {\n        // var store = findStore(kb,subjects[subjectList.length-1])\n        const store = kb.sym(storeURI)\n        const mintBox = dom.createElement('div')\n        mintBox.setAttribute(\n          'style',\n          'clear: left; width: 20em; margin-top:2em; background-color:#ccc; border-radius: 1em; padding: 1em; font-weight: bold;'\n        )\n        mintBox.textContent = '+ New ' + UI.utils.label(subject)\n\n        mintBox.textContent += ' in ' + UI.utils.label(store)\n        const storeLab = dom.createElement('span')\n        storeLab.setAttribute(\n          'style',\n          'font-weight: normal; font-size: 80%; color: #777;'\n        )\n        storeLab.textContent = storeURI\n        mintBox.appendChild(dom.createElement('br'))\n        mintBox.appendChild(storeLab)\n        /*\n        var mintButton = dom.createElement('img')\n        mintBox.appendChild(mintButton)\n        mintButton.setAttribute('src', ...); @@ Invokes master handler\n        */\n        mintBox.addEventListener(\n          'click',\n          function (_event) {\n            const thisForm = UI.widgets.promptForNew(\n              dom,\n              kb,\n              subject,\n              predicate,\n              subject,\n              null,\n              store,\n              function (ok, _body) {\n                if (!ok) {\n                  // callback(ok, body); // @@ if ok, need some form of refresh of the select for the new thing\n                } else {\n                  // Refresh @@\n                }\n              }\n            )\n            try {\n              div.insertBefore(thisForm, mintBox.nextSibling) // Sigh no insertAfter\n            } catch (e) {\n              div.appendChild(thisForm)\n            }\n            // var newObject = thisForm.AJAR_subject\n          },\n          false\n        )\n        div.appendChild(mintBox)\n      }\n    }\n\n    // if (!me) complain(\"(You do not have your Web Id set. Set your Web ID to make changes.)\")\n\n    return div\n  }\n} // pane object\n\n// ends\n"],"mappings":"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","ignoreList":[]}
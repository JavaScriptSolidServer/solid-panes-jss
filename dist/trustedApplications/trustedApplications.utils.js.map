{"version":3,"file":"trustedApplications.utils.js","names":["_rdflib","require","getStatementsToDelete","origin","person","kb","ns","applicationStatements","statementsMatching","acl","statementsToDelete","reduce","memo","st","concat","subject","getStatementsToAdd","nodeName","modes","application","BlankNode","doc","map","mode","sym","generateRandomString","Math","random","toString","substr"],"sources":["../../src/trustedApplications/trustedApplications.utils.ts"],"sourcesContent":["import { BlankNode, IndexedFormula, NamedNode, st, Literal, sym, Statement } from 'rdflib'\nimport { Namespaces } from 'solid-namespace'\n\nexport function getStatementsToDelete (\n  origin: NamedNode | Literal,\n  person: NamedNode,\n  kb: IndexedFormula,\n  ns: Namespaces\n): any {\n  const applicationStatements = kb.statementsMatching(\n    null,\n    ns.acl('origin'),\n    origin\n  )\n  const statementsToDelete = applicationStatements.reduce(\n    (memo, st) => {\n      return memo\n        .concat(\n          kb.statementsMatching(\n            person,\n            ns.acl('trustedApp'),\n            st.subject as NamedNode\n          )\n        )\n        .concat(kb.statementsMatching(st.subject))\n    },\n    [] as Array<Statement>\n  )\n  return statementsToDelete\n}\n\nexport function getStatementsToAdd (\n  origin: NamedNode,\n  nodeName: string,\n  modes: string[],\n  person: NamedNode,\n  ns: Namespaces\n): any {\n  const application = new BlankNode(`bn_${nodeName}`) // NamedNode(`${person.doc().uri}#${nodeName}`)\n  return [\n    st(person, ns.acl('trustedApp'), application, person.doc()),\n    st(application, ns.acl('origin'), origin, person.doc()),\n    ...modes\n      .map(mode => sym(mode))\n      .map(mode => st(application, ns.acl('mode'), mode, person.doc()))\n  ]\n}\n\nexport function generateRandomString () {\n  return Math.random().toString(36).substr(2, 5)\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AAGO,SAASC,qBAAqBA,CACnCC,MAA2B,EAC3BC,MAAiB,EACjBC,EAAkB,EAClBC,EAAc,EACT;EACL,MAAMC,qBAAqB,GAAGF,EAAE,CAACG,kBAAkB,CACjD,IAAI,EACJF,EAAE,CAACG,GAAG,CAAC,QAAQ,CAAC,EAChBN,MACF,CAAC;EACD,MAAMO,kBAAkB,GAAGH,qBAAqB,CAACI,MAAM,CACrD,CAACC,IAAI,EAAEC,EAAE,KAAK;IACZ,OAAOD,IAAI,CACRE,MAAM,CACLT,EAAE,CAACG,kBAAkB,CACnBJ,MAAM,EACNE,EAAE,CAACG,GAAG,CAAC,YAAY,CAAC,EACpBI,EAAE,CAACE,OACL,CACF,CAAC,CACAD,MAAM,CAACT,EAAE,CAACG,kBAAkB,CAACK,EAAE,CAACE,OAAO,CAAC,CAAC;EAC9C,CAAC,EACD,EACF,CAAC;EACD,OAAOL,kBAAkB;AAC3B;AAEO,SAASM,kBAAkBA,CAChCb,MAAiB,EACjBc,QAAgB,EAChBC,KAAe,EACfd,MAAiB,EACjBE,EAAc,EACT;EACL,MAAMa,WAAW,GAAG,IAAIC,iBAAS,CAAC,MAAMH,QAAQ,EAAE,CAAC,EAAC;EACpD,OAAO,CACL,IAAAJ,UAAE,EAACT,MAAM,EAAEE,EAAE,CAACG,GAAG,CAAC,YAAY,CAAC,EAAEU,WAAW,EAAEf,MAAM,CAACiB,GAAG,CAAC,CAAC,CAAC,EAC3D,IAAAR,UAAE,EAACM,WAAW,EAAEb,EAAE,CAACG,GAAG,CAAC,QAAQ,CAAC,EAAEN,MAAM,EAAEC,MAAM,CAACiB,GAAG,CAAC,CAAC,CAAC,EACvD,GAAGH,KAAK,CACLI,GAAG,CAACC,IAAI,IAAI,IAAAC,WAAG,EAACD,IAAI,CAAC,CAAC,CACtBD,GAAG,CAACC,IAAI,IAAI,IAAAV,UAAE,EAACM,WAAW,EAAEb,EAAE,CAACG,GAAG,CAAC,MAAM,CAAC,EAAEc,IAAI,EAAEnB,MAAM,CAACiB,GAAG,CAAC,CAAC,CAAC,CAAC,CACpE;AACH;AAEO,SAASI,oBAAoBA,CAAA,EAAI;EACtC,OAAOC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC;AAChD","ignoreList":[]}
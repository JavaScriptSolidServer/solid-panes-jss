{"version":3,"file":"trustedApplications.dom.js","names":["_rdflib","require","_solidUiJss","_solidLogicJss","_trustedApplications","createApplicationTable","subject","applicationsTable","createElement","class","header","createContainer","createText","appendChild","store","each","ns","acl","undefined","flatMap","app","map","origin","appModes","sort","a","b","value","forEach","createApplicationEntry","updateTable","parentElement","replaceChild","trustedApplicationState","formElements","modes","placeholder","element","submit","addOrEditApplication","createModesInput","style","click","removeApplication","event","preventDefault","sym","err","alert","filter","checkbox","checked","deletions","getStatementsToDelete","additions","getStatementsToAdd","generateRandomString","updater","Error","update","handleUpdateResponse","uri","success","errorBody","elementName","attributes","eventListeners","onCreated","document","Object","keys","attName","setAttribute","eventName","addEventListener","children","child","textContent","mode","isChecked","some","appMode","type","push"],"sources":["../../src/trustedApplications/trustedApplications.dom.ts"],"sourcesContent":["import { NamedNode, Statement, sym } from 'rdflib'\nimport { ns } from 'solid-ui-jss'\nimport { store } from 'solid-logic-jss'\nimport { generateRandomString, getStatementsToAdd, getStatementsToDelete } from './trustedApplications.utils'\n\ninterface FormElements {\n  modes: HTMLInputElement[]\n  // This appears to be used to store either a node from the store,\n  // or a reference to the input (checkbox) element for a particular mode.\n  // These typings were created post-hoc, so I'm not sure if that was intentional.\n  // Thus, this union type should be considered as descriptive rather than prescriptive.\n  origin: undefined | NamedNode | HTMLInputElement\n}\n\nexport function createApplicationTable (subject: NamedNode) {\n  const applicationsTable = createElement('table', {\n    class: 'results'\n  })\n\n  // creating headers\n  const header = createContainer('tr', [\n    createText('th', 'Application URL'),\n    createText('th', 'Access modes'),\n    createText('th', 'Actions')\n  ])\n  applicationsTable.appendChild(header);\n\n  // creating rows\n  (store.each(subject, ns.acl('trustedApp'), undefined, undefined) as unknown as Statement[])\n    .flatMap(app => store\n      .each(app as any, ns.acl('origin'), undefined, undefined)\n      .map(origin => ({\n        appModes: store.each(app as any, ns.acl('mode'), undefined, undefined) as NamedNode[],\n        origin: origin as NamedNode\n      })))\n    .sort((a: any, b: any) => (a.origin.value < b.origin.value ? -1 : 1))\n    .forEach(\n      ({ appModes, origin }: { appModes: NamedNode[]; origin: NamedNode }) =>\n        applicationsTable.appendChild(\n          createApplicationEntry(subject, origin, appModes, updateTable)\n        )\n    )\n\n  // adding a row for new applications\n  applicationsTable.appendChild(\n    createApplicationEntry(subject, null, [ns.acl('Read')], updateTable)\n  )\n\n  return applicationsTable\n\n  function updateTable () {\n    applicationsTable.parentElement!.replaceChild(\n      createApplicationTable(subject),\n      applicationsTable\n    )\n  }\n}\n\nfunction createApplicationEntry (\n  subject: NamedNode,\n  origin: NamedNode | null,\n  appModes: NamedNode[],\n  updateTable: () => void\n): HTMLTableRowElement {\n  const trustedApplicationState = {\n    origin,\n    appModes,\n    formElements: {\n      modes: [],\n      origin: undefined\n    } as FormElements\n  }\n  return createContainer('tr', [\n    createContainer('td', [\n      createContainer(\n        'form',\n        [\n          createElement(\n            'input',\n            {\n              class: 'textinput',\n              placeholder: 'Write new URL here',\n              value: origin ? origin.value : ''\n            },\n            {},\n            element => {\n              trustedApplicationState.formElements.origin = element\n            }\n          )\n        ],\n        {},\n        {\n          submit: addOrEditApplication\n        }\n      )\n    ]),\n    createContainer('td', [\n      createContainer(\n        'form',\n        createModesInput(trustedApplicationState),\n        {},\n        {\n          submit: addOrEditApplication\n        }\n      )\n    ]),\n    createContainer('td', [\n      createContainer(\n        'form',\n        origin\n          ? [\n              createText('button', 'Update', {\n                class: 'controlButton',\n                style: 'background: LightGreen;'\n              }),\n              createText(\n                'button',\n                'Delete',\n                {\n                  class: 'controlButton',\n                  style: 'background: LightCoral;'\n                },\n                {\n                  click: removeApplication\n                }\n              )\n            ]\n          : [\n              createText('button', 'Add', {\n                class: 'controlButton',\n                style: 'background: LightGreen;'\n              })\n            ],\n        {},\n        {\n          submit: addOrEditApplication\n        }\n      )\n    ])\n  ])\n\n  function addOrEditApplication (event: Event) {\n    event.preventDefault()\n    let origin\n    try {\n      origin = sym(trustedApplicationState.formElements.origin!.value)\n    } catch (err) {\n      return alert('Please provide an application URL you want to trust')\n    }\n\n    const modes = trustedApplicationState.formElements.modes\n      .filter(checkbox => checkbox.checked)\n      .map(checkbox => checkbox.value)\n\n    const deletions = getStatementsToDelete(\n      trustedApplicationState.origin || origin,\n      subject,\n      store,\n      ns\n    )\n    const additions = getStatementsToAdd(\n      origin,\n      generateRandomString(),\n      modes,\n      subject,\n      ns\n    )\n    if (!store.updater) {\n      throw new Error('Store has no updater')\n    }\n    store.updater.update(deletions, additions, handleUpdateResponse)\n  }\n\n  function removeApplication (event: Event) {\n    event.preventDefault()\n    let origin\n    try {\n      origin = sym(trustedApplicationState.formElements.origin!.value)\n    } catch (err) {\n      return alert(\n        'Please provide an application URL you want to remove trust from'\n      )\n    }\n\n    const deletions = getStatementsToDelete(origin, subject, store, ns)\n    if (!store.updater) {\n      throw new Error('Store has no updater')\n    }\n    store.updater.update(deletions, [], handleUpdateResponse)\n  }\n\n  function handleUpdateResponse (uri: any, success: boolean, errorBody: any) {\n    if (success) {\n      return updateTable()\n    }\n    // console.error(uri, errorBody)\n  }\n}\n\nfunction createElement<K extends keyof globalThis.HTMLElementTagNameMap> (\n  elementName: K,\n  attributes: { [name: string]: string } = {},\n  eventListeners: { [eventName: string]: globalThis.EventListener } = {},\n\n  onCreated: null | ((createdElement: globalThis.HTMLElementTagNameMap[K]) => void) = null\n) {\n  const element = document.createElement(elementName)\n  if (onCreated) {\n    onCreated(element)\n  }\n  Object.keys(attributes).forEach(attName => {\n    element.setAttribute(attName, attributes[attName])\n  })\n  Object.keys(eventListeners).forEach(eventName => {\n    element.addEventListener(eventName, eventListeners[eventName])\n  })\n  return element\n}\n\nexport function createContainer<K extends keyof globalThis.HTMLElementTagNameMap> (\n  elementName: K,\n  children: HTMLElement[],\n  attributes = {},\n  eventListeners = {},\n  onCreated = null\n) {\n  const element = createElement(\n    elementName,\n    attributes,\n    eventListeners,\n    onCreated\n  )\n  children.forEach(child => element.appendChild(child))\n  return element\n}\n\nexport function createText<K extends keyof globalThis.HTMLElementTagNameMap> (\n  elementName: K,\n  textContent: string | null,\n  attributes = {},\n  eventListeners = {},\n  onCreated = null\n) {\n  const element = createElement(\n    elementName,\n    attributes,\n    eventListeners,\n    onCreated\n  )\n  element.textContent = textContent\n  return element\n}\n\nfunction createModesInput ({ appModes, formElements }: {\n  appModes: NamedNode[]\n  formElements: FormElements\n}) {\n  return ['Read', 'Write', 'Append', 'Control'].map(mode => {\n    const isChecked = appModes.some(\n      appMode => appMode.value === ns.acl(mode).value\n    )\n    return createContainer('label', [\n      createElement(\n        'input',\n        {\n          type: 'checkbox',\n          ...(isChecked ? { checked: '' } : {}),\n          value: ns.acl(mode).uri\n        },\n        {},\n        element => formElements.modes.push(element)\n      ),\n      createText('span', mode)\n    ])\n  })\n}\n"],"mappings":"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","ignoreList":[]}
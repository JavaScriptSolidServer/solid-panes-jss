{"version":3,"file":"playlistPane.js","names":["UI","$rdf","ns","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","anyStatementMatching","rdf","sym","render","myDocument","dom","isVideo","src","_index","html5","youtube","match","vimeo","dailymotion","vk","link","contents","uri","a","createElement","setAttribute","appendChild","addEventListener","widgets","openHrefInOutlineMode","text","str","createTextNode","obj","any","index","video","div","img","replace","value","descDiv","sl","statementsMatching","slots","i","length","push","parseInt","object","pIndex","indexOf","nIndex","prev","split","indexDiv","innerHTML","next","tr"],"sources":["../../src/playlist/playlistPane.js"],"sourcesContent":["/*   Playlist Pane\n **\n **  This pane allows playlists and playlists slots to be viewed\n **  seeAlso: http://smiy.sourceforge.net/pbo/spec/playbackontology.html\n */\nimport * as UI from 'solid-ui-jss'\nimport * as $rdf from 'rdflib'\nconst ns = UI.ns\n\nexport default {\n  icon: UI.icons.iconBase + 'noun_1619.svg',\n\n  name: 'playlistSlot',\n\n  audience: [ns.solid('PowerUser')],\n\n  label: function (subject, context) {\n    const kb = context.session.store\n\n    if (\n      !kb.anyStatementMatching(\n        subject,\n        UI.ns.rdf('type'),\n        kb.sym('http://purl.org/ontology/pbo/core#PlaylistSlot')\n      )\n    ) {\n      return null\n    }\n\n    return 'playlist slot'\n  },\n\n  render: function (subject, context) {\n    const myDocument = context.dom\n    function isVideo (src, _index) {\n      if (!src) {\n        return {\n          html5: true\n        }\n      }\n\n      const youtube = src.match(\n        /\\/\\/(?:www\\.)?youtu(?:\\.be|be\\.com)\\/(?:watch\\?v=|embed\\/)?([a-z0-9\\-_%]+)/i\n      )\n      const vimeo = src.match(/\\/\\/(?:www\\.)?vimeo.com\\/([0-9a-z\\-_]+)/i)\n      const dailymotion = src.match(/\\/\\/(?:www\\.)?dai.ly\\/([0-9a-z\\-_]+)/i)\n      const vk = src.match(\n        /\\/\\/(?:www\\.)?(?:vk\\.com|vkontakte\\.ru)\\/(?:video_ext\\.php\\?)(.*)/i\n      )\n\n      if (youtube) {\n        return {\n          youtube\n        }\n      } else if (vimeo) {\n        return {\n          vimeo\n        }\n      } else if (dailymotion) {\n        return {\n          dailymotion\n        }\n      } else if (vk) {\n        return {\n          vk\n        }\n      }\n    }\n\n    const link = function (contents, uri) {\n      if (!uri) return contents\n      const a = myDocument.createElement('a')\n      a.setAttribute('href', uri)\n      a.appendChild(contents)\n      a.addEventListener('click', UI.widgets.openHrefInOutlineMode, true)\n      return a\n    }\n\n    const text = function (str) {\n      return myDocument.createTextNode(str)\n    }\n\n    const kb = context.session.store\n    const obj = kb.any(\n      subject,\n      $rdf.sym('http://purl.org/ontology/pbo/core#playlist_item')\n    )\n    let index = kb.any(\n      subject,\n      $rdf.sym('http://purl.org/ontology/olo/core#index')\n    )\n\n    let uri = obj.uri\n    const video = isVideo(uri)\n\n    const div = myDocument.createElement('div')\n    let img\n    if (video && video.youtube) {\n      uri = uri.replace('watch?v=', 'embed/')\n      div.setAttribute('class', 'imageView')\n      img = myDocument.createElement('IFRAME')\n      img.setAttribute('src', uri)\n      img.setAttribute('width', 560)\n      img.setAttribute('height', 315)\n      img.setAttribute('frameborder', 0)\n      img.setAttribute('style', 'max-width: 850px; max-height: 100%;')\n      img.setAttribute('allowfullscreen', 'true')\n    } else {\n      div.setAttribute('class', 'imageView')\n      img = myDocument.createElement('IMG')\n      img.setAttribute('src', obj.value)\n      img.setAttribute('width', 560)\n      img.setAttribute('height', 315)\n      img.setAttribute('style', 'max-width: 560; max-height: 315;')\n    }\n\n    let descDiv\n    if (index) {\n      const sl = kb.statementsMatching(\n        null,\n        $rdf.sym('http://purl.org/ontology/olo/core#index')\n      )\n      const slots = []\n      for (let i = 0; i < sl.length; i++) {\n        if (sl[i]) {\n          slots.push(parseInt(sl[i].object.value, 10))\n        }\n      }\n\n      index = parseInt(index.value, 10)\n      descDiv = myDocument.createElement('div')\n\n      const pIndex =\n        slots[(slots.indexOf(index) - 1 + slots.length) % slots.length]\n      const nIndex =\n        slots[(slots.indexOf(index) + 1 + slots.length) % slots.length]\n\n      const prev = link(text('<<'), subject.uri.split('#')[0] + '#' + pIndex)\n\n      descDiv.appendChild(prev)\n\n      const indexDiv = myDocument.createElement('span')\n      indexDiv.innerHTML = ' Playlist slot : ' + index + ' '\n\n      descDiv.appendChild(indexDiv)\n\n      const next = link(text('>>'), subject.uri.split('#')[0] + '#' + nIndex)\n      descDiv.appendChild(next)\n    }\n\n    const tr = myDocument.createElement('TR') // why need tr?\n    tr.appendChild(img)\n    if (descDiv) {\n      tr.appendChild(descDiv)\n    }\n    div.appendChild(tr)\n    return div\n  }\n}\n\n// ends\n"],"mappings":"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","ignoreList":[]}
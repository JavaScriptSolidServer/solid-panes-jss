{"version":3,"file":"imagePane.js","names":["UI","imagePane","icon","icons","originalIconBase","name","label","subject","context","store","session","anyStatementMatching","ns","rdf","sym","contentTypeMatch","x","contentTypes","cts","fetcher","getHeader","j","length","k","indexOf","suppressed","render","myDocument","dom","div","createElement","setAttribute","img","_fetch","uri","then","response","blob","myBlob","objectURL","URL","createObjectURL","tr","appendChild"],"sources":["../src/imagePane.js"],"sourcesContent":["/*   Image Pane\n **\n **  This outline pane contains the document contents for an Image document\n */\nimport * as UI from 'solid-ui-jss'\n\nexport const imagePane = {\n  icon: UI.icons.originalIconBase + 'tango/22-image-x-generic.png',\n\n  name: 'image',\n\n  label: function (subject, context) {\n    const store = context.session.store\n    if (\n      !store.anyStatementMatching(\n        subject,\n        UI.ns.rdf('type'),\n        store.sym('http://purl.org/dc/terms/Image')\n      )\n    ) {\n      // NB: Not dc: namespace!\n      return null\n    }\n\n    //   See also the source pane, which has lower precedence.\n\n    const contentTypeMatch = function (store, x, contentTypes) {\n      const cts = store.fetcher.getHeader(x, 'content-type')\n      if (cts) {\n        for (let j = 0; j < cts.length; j++) {\n          for (let k = 0; k < contentTypes.length; k++) {\n            if (cts[j].indexOf(contentTypes[k]) >= 0) {\n              return true\n            }\n          }\n        }\n      }\n      return false\n    }\n\n    const suppressed = ['application/pdf']\n    if (contentTypeMatch(store, subject, suppressed)) {\n      return null\n    }\n    return 'view'\n  },\n\n  render: function (subject, context) {\n    const myDocument = context.dom\n    const store = context.session.store\n    const div = myDocument.createElement('div')\n    div.setAttribute('class', 'imageView')\n    const img = myDocument.createElement('IMG')\n\n    // get image with authenticated fetch\n    store.fetcher._fetch(subject.uri)\n      .then(function (response) {\n        return response.blob()\n      })\n      .then(function (myBlob) {\n        const objectURL = URL.createObjectURL(myBlob)\n        img.setAttribute('src', objectURL) // w640 h480 //\n      })\n\n    img.setAttribute('style', 'max-width: 100%; max-height: 100%;')\n    //        div.style['max-width'] = '640'\n    //        div.style['max-height'] = '480'\n    const tr = myDocument.createElement('TR') // why need tr?\n    tr.appendChild(img)\n    div.appendChild(tr)\n    return div\n  }\n}\n\n// ends\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAO,KAAKA,EAAE,MAAM,cAAc;AAElC,OAAO,MAAMC,SAAS,GAAG;EACvBC,IAAI,EAAEF,EAAE,CAACG,KAAK,CAACC,gBAAgB,GAAG,8BAA8B;EAEhEC,IAAI,EAAE,OAAO;EAEbC,KAAK,EAAE,SAAAA,CAAUC,OAAO,EAAEC,OAAO,EAAE;IACjC,MAAMC,KAAK,GAAGD,OAAO,CAACE,OAAO,CAACD,KAAK;IACnC,IACE,CAACA,KAAK,CAACE,oBAAoB,CACzBJ,OAAO,EACPP,EAAE,CAACY,EAAE,CAACC,GAAG,CAAC,MAAM,CAAC,EACjBJ,KAAK,CAACK,GAAG,CAAC,gCAAgC,CAC5C,CAAC,EACD;MACA;MACA,OAAO,IAAI;IACb;;IAEA;;IAEA,MAAMC,gBAAgB,GAAG,SAAAA,CAAUN,KAAK,EAAEO,CAAC,EAAEC,YAAY,EAAE;MACzD,MAAMC,GAAG,GAAGT,KAAK,CAACU,OAAO,CAACC,SAAS,CAACJ,CAAC,EAAE,cAAc,CAAC;MACtD,IAAIE,GAAG,EAAE;QACP,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,GAAG,CAACI,MAAM,EAAED,CAAC,EAAE,EAAE;UACnC,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGN,YAAY,CAACK,MAAM,EAAEC,CAAC,EAAE,EAAE;YAC5C,IAAIL,GAAG,CAACG,CAAC,CAAC,CAACG,OAAO,CAACP,YAAY,CAACM,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE;cACxC,OAAO,IAAI;YACb;UACF;QACF;MACF;MACA,OAAO,KAAK;IACd,CAAC;IAED,MAAME,UAAU,GAAG,CAAC,iBAAiB,CAAC;IACtC,IAAIV,gBAAgB,CAACN,KAAK,EAAEF,OAAO,EAAEkB,UAAU,CAAC,EAAE;MAChD,OAAO,IAAI;IACb;IACA,OAAO,MAAM;EACf,CAAC;EAEDC,MAAM,EAAE,SAAAA,CAAUnB,OAAO,EAAEC,OAAO,EAAE;IAClC,MAAMmB,UAAU,GAAGnB,OAAO,CAACoB,GAAG;IAC9B,MAAMnB,KAAK,GAAGD,OAAO,CAACE,OAAO,CAACD,KAAK;IACnC,MAAMoB,GAAG,GAAGF,UAAU,CAACG,aAAa,CAAC,KAAK,CAAC;IAC3CD,GAAG,CAACE,YAAY,CAAC,OAAO,EAAE,WAAW,CAAC;IACtC,MAAMC,GAAG,GAAGL,UAAU,CAACG,aAAa,CAAC,KAAK,CAAC;;IAE3C;IACArB,KAAK,CAACU,OAAO,CAACc,MAAM,CAAC1B,OAAO,CAAC2B,GAAG,CAAC,CAC9BC,IAAI,CAAC,UAAUC,QAAQ,EAAE;MACxB,OAAOA,QAAQ,CAACC,IAAI,CAAC,CAAC;IACxB,CAAC,CAAC,CACDF,IAAI,CAAC,UAAUG,MAAM,EAAE;MACtB,MAAMC,SAAS,GAAGC,GAAG,CAACC,eAAe,CAACH,MAAM,CAAC;MAC7CN,GAAG,CAACD,YAAY,CAAC,KAAK,EAAEQ,SAAS,CAAC,EAAC;IACrC,CAAC,CAAC;IAEJP,GAAG,CAACD,YAAY,CAAC,OAAO,EAAE,oCAAoC,CAAC;IAC/D;IACA;IACA,MAAMW,EAAE,GAAGf,UAAU,CAACG,aAAa,CAAC,IAAI,CAAC,EAAC;IAC1CY,EAAE,CAACC,WAAW,CAACX,GAAG,CAAC;IACnBH,GAAG,CAACc,WAAW,CAACD,EAAE,CAAC;IACnB,OAAOb,GAAG;EACZ;AACF,CAAC;;AAED","ignoreList":[]}
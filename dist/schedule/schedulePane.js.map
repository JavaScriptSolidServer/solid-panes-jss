{"version":3,"file":"schedulePane.js","names":["UI","_interopRequireWildcard","require","_solidLogicJss","$rdf","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","formText","ns","possibleAvailabilities","sched","schedulePane","exports","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","findTypeURIs","mintClass","mintNew","options","Promise","resolve","reject","newBase","thisInstance","useExisting","sym","complainIfBad","ok","body","console","log","Error","genACLtext","docURI","aclURI","allWrite","g","graph","auth","Namespace","a","acl","doc","add","rdf","me","foaf","serialize","setACL2","callbackFunction","aclDoc","any","aclText","uri","fetcher","webOperation","data","contentType","then","_result","catch","err","message","load","updater","authn","currentUser","alert","base","dir","newDetailsDoc","newInstance","newResultsDoc","toBeCopied","noIndexHTML","local","agenda","length","item","fun","copyItem","push","newURI","setThatACL","shift","webCopy","checkUser","webId","createDetailsFile","dc","Date","put","statementsMatching","undefined","uri2","render","dom","invitation","appPathSegment","waitingForLogin","detailsDoc","baseDir","resultsDoc","formsURI","form1","form2","form3","parse","inputStyle","buttonIconStyle","div","appendChild","widgets","errorMessageBlock","clearElement","ele","firstChild","removeChild","refreshCellColor","cell","value","bg","ui","setAttribute","logInOutButton","refresh","showAppropriateDisplay","newInstanceButton","b","login","newAppInstance","noun","initializeNewInstanceInWorkspace","ws","space","split","slice","error","now","getTime","initializeNewInstanceAtBase","p","createElement","innerHTML","getForms","getDetails","nowOrWhenFetched","showSignon","editable","holds","wf","showBootstrap","ready","showForms","getResults","naviMain","signonContext","ensureLoggedIn","textContent","baseField","size","autocomplete","button","addEventListener","_e","doneButton","naviCenter","wizard","currentSlide","gotDoneButton","forms","slides","slide","appendForm","document","b1","removeAttribute","b2","emailButton","naviLeft","naviRight","table","insertables","st","update","success","errorBody","emailIcon","title","anyValue","cal","mailto","each","map","who","mbox","replace","join","encodeURIComponent","window","location","href","response","status","showResults","comment","author","authorName","query","Query","v","vs","forEach","x","vars","variable","pat","resp","time","set_x","opt","set_y","possibleTimes","displayTheMatrix","matrix","matrixForQuery","refreshButton","refreshIcon","disabled","dataPointForNT","loginContext","filter","z","sameTerm","cellFunction","y","_error","selectOptions","predicate","cellSubject","toNT","selector","makeSelectForOptions","utils","responses","myResponse","id","newThing","dps","dataPoint","j","instanceCreator","editButton","editIcon","structure","naviLoginoutTR","naviTop","naviMenu"],"sources":["../../src/schedule/schedulePane.js"],"sourcesContent":["/*   Scheduler Pane\n **\n **\n */\n/* global alert */\n\nimport * as UI from 'solid-ui-jss'\nimport { authn } from 'solid-logic-jss'\nimport * as $rdf from 'rdflib'\nimport formText from './formsForSchedule.ttl'\n\nconst ns = UI.ns\n\n// @@ Give other combos too-- see schedule ontology\nconst possibleAvailabilities = [\n  ns.sched('No'),\n  ns.sched('Maybe'),\n  ns.sched('Yes')\n]\n\nexport const schedulePane = {\n  icon: UI.icons.iconBase + 'noun_346777.svg', // @@ better?\n\n  name: 'schedule',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve an Scheduler pane?\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/ns/pim/schedule#SchedulableEvent']) {\n      return 'Scheduling poll'\n    }\n    return null // No under other circumstances\n  },\n\n  //  Mint a new Schedule poll\n  mintClass: ns.sched('SchedulableEvent'),\n\n  mintNew: function (context, options) {\n    return new Promise(function (resolve, reject) {\n      const ns = UI.ns\n      const kb = context.session.store\n      let newBase = options.newBase\n      const thisInstance =\n        options.useExisting || $rdf.sym(options.newBase + 'index.ttl#this')\n\n      const complainIfBad = function (ok, body) {\n        if (ok) return\n        console.log(\n          'Error in Schedule Pane: Error constructing new scheduler: ' + body\n        )\n        reject(new Error(body))\n      }\n\n      // ////////////////////// Accesss control\n\n      // Two constiations of ACL for this app, public read and public read/write\n      // In all cases owner has read write control\n\n      const genACLtext = function (docURI, aclURI, allWrite) {\n        const g = $rdf.graph()\n        const auth = $rdf.Namespace('http://www.w3.org/ns/auth/acl#')\n        let a = g.sym(aclURI + '#a1')\n        const acl = g.sym(aclURI)\n        const doc = g.sym(docURI)\n        g.add(a, UI.ns.rdf('type'), auth('Authorization'), acl)\n        g.add(a, auth('accessTo'), doc, acl)\n        g.add(a, auth('agent'), me, acl)\n        g.add(a, auth('mode'), auth('Read'), acl)\n        g.add(a, auth('mode'), auth('Write'), acl)\n        g.add(a, auth('mode'), auth('Control'), acl)\n\n        a = g.sym(aclURI + '#a2')\n        g.add(a, UI.ns.rdf('type'), auth('Authorization'), acl)\n        g.add(a, auth('accessTo'), doc, acl)\n        g.add(a, auth('agentClass'), ns.foaf('Agent'), acl)\n        g.add(a, auth('mode'), auth('Read'), acl)\n        if (allWrite) {\n          g.add(a, auth('mode'), auth('Write'), acl)\n        }\n        return $rdf.serialize(acl, g, aclURI, 'text/turtle')\n      }\n\n      /*\n          const setACL3 = function (docURI, allWrite, callbackFunction) {\n            const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n            return UI.acl.setACL(docURI, aclText, callbackFunction)\n          }\n          */\n\n      const setACL2 = function setACL2 (docURI, allWrite, callbackFunction) {\n        const aclDoc = kb.any(\n          kb.sym(docURI),\n          kb.sym('http://www.iana.org/assignments/link-relations/acl')\n        ) // @@ check that this get set by web.js\n\n        if (aclDoc) {\n          // Great we already know where it is\n          const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n\n          return fetcher\n            .webOperation('PUT', aclDoc.uri, {\n              data: aclText,\n              contentType: 'text/turtle'\n            })\n            .then(_result => callbackFunction(true))\n            .catch(err => {\n              callbackFunction(false, err.message)\n            })\n        } else {\n          return fetcher\n            .load(docURI)\n            .catch(err => {\n              callbackFunction(false, 'Getting headers for ACL: ' + err)\n            })\n            .then(() => {\n              const aclDoc = kb.any(\n                kb.sym(docURI),\n                kb.sym('http://www.iana.org/assignments/link-relations/acl')\n              )\n\n              if (!aclDoc) {\n                // complainIfBad(false, \"No Link rel=ACL header for \" + docURI)\n                throw new Error('No Link rel=ACL header for ' + docURI)\n              }\n\n              const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n\n              return fetcher.webOperation('PUT', aclDoc.uri, {\n                data: aclText,\n                contentType: 'text/turtle'\n              })\n            })\n            .then(_result => callbackFunction(true))\n            .catch(err => {\n              callbackFunction(false, err.message)\n            })\n        }\n      }\n\n      // Body of mintNew\n      const fetcher = kb.fetcher\n      const updater = kb.updater\n\n      let me = options.me || authn.currentUser()\n      if (!me) {\n        console.log('MUST BE LOGGED IN')\n        alert('NOT LOGGED IN')\n        return\n      }\n\n      const base = thisInstance.dir().uri\n      let newDetailsDoc, newInstance // , newIndexDoc\n\n      if (options.useExisting) {\n        newInstance = options.useExisting\n        newBase = thisInstance.dir().uri\n        newDetailsDoc = newInstance.doc()\n        // newIndexDoc = null\n        if (options.newBase) {\n          throw new Error(\n            'mint new scheduler: Illegal - have both new base and existing event'\n          )\n        }\n      } else {\n        newDetailsDoc = kb.sym(newBase + 'details.ttl')\n        // newIndexDoc = kb.sym(newBase + 'index.html')\n        newInstance = kb.sym(newDetailsDoc.uri + '#event')\n      }\n\n      const newResultsDoc = kb.sym(newBase + 'results.ttl')\n\n      const toBeCopied = options.noIndexHTML\n        ? {}\n        : [{ local: 'index.html', contentType: 'text/html' }]\n\n      const agenda = []\n\n      //   @@ This needs some form of visible progress bar\n      for (let f = 0; f < toBeCopied.length; f++) {\n        const item = toBeCopied[f]\n        const fun = function copyItem (item) {\n          agenda.push(function () {\n            const newURI = newBase + item.local\n            console.log('Copying ' + base + item.local + ' to ' + newURI)\n\n            const setThatACL = function () {\n              setACL2(newURI, false, function (ok, message) {\n                if (!ok) {\n                  complainIfBad(\n                    ok,\n                    'FAILED to set ACL ' + newURI + ' : ' + message\n                  )\n                  console.log('FAILED to set ACL ' + newURI + ' : ' + message)\n                } else {\n                  agenda.shift()() // beware too much nesting\n                }\n              })\n            }\n\n            kb.fetcher\n              .webCopy(\n                base + item.local,\n                newBase + item.local,\n                item.contentType\n              )\n              .then(() => authn.checkUser())\n              .then(webId => {\n                me = webId\n\n                setThatACL()\n              })\n              .catch(err => {\n                console.log(\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n                complainIfBad(\n                  false,\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n              })\n          })\n        }\n        fun(item)\n      }\n\n      agenda.push(function createDetailsFile () {\n        kb.add(\n          newInstance,\n          ns.rdf('type'),\n          ns.sched('SchedulableEvent'),\n          newDetailsDoc\n        )\n        if (me) {\n          kb.add(newInstance, ns.dc('author'), me, newDetailsDoc) // Who is sending the invitation?\n          kb.add(newInstance, ns.foaf('maker'), me, newDetailsDoc) // Uneditable - wh is allowed to edit this?\n        }\n\n        kb.add(newInstance, ns.dc('created'), new Date(), newDetailsDoc)\n        kb.add(newInstance, ns.sched('resultsDocument'), newDetailsDoc)\n\n        updater.put(\n          newDetailsDoc,\n          kb.statementsMatching(undefined, undefined, undefined, newDetailsDoc),\n          'text/turtle',\n          function (uri2, ok, message) {\n            if (ok) {\n              agenda.shift()()\n            } else {\n              complainIfBad(\n                ok,\n                'FAILED to save new scheduler at: ' +\n                  newDetailsDoc +\n                  ' : ' +\n                  message\n              )\n              console.log(\n                'FAILED to save new scheduler at: ' +\n                  newDetailsDoc +\n                  ' : ' +\n                  message\n              )\n            }\n          }\n        )\n      })\n\n      agenda.push(function () {\n        kb.fetcher\n          .webOperation('PUT', newResultsDoc.uri, {\n            data: '',\n            contentType: 'text/turtle'\n          })\n          .then(() => {\n            agenda.shift()()\n          })\n          .catch(err => {\n            complainIfBad(\n              false,\n              'Failed to initialize empty results file: ' + err.message\n            )\n          })\n      })\n\n      agenda.push(function () {\n        setACL2(newResultsDoc.uri, true, function (ok, body) {\n          complainIfBad(\n            ok,\n            'Failed to set Read-Write ACL on results file: ' + body\n          )\n          if (ok) agenda.shift()()\n        })\n      })\n\n      agenda.push(function () {\n        setACL2(newDetailsDoc.uri, false, function (ok, body) {\n          complainIfBad(\n            ok,\n            'Failed to set read ACL on configuration file: ' + body\n          )\n          if (ok) agenda.shift()()\n        })\n      })\n\n      agenda.push(function () {\n        // give the user links to the new app\n        console.log('Finished minting new scheduler')\n        options.newInstance = newInstance\n        resolve(options)\n      })\n\n      agenda.shift()()\n      // Created new data files.\n    }) // promise\n  }, // mintNew\n\n  //  Render one meeting schedule poll\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const ns = UI.ns\n    const invitation = subject\n    const appPathSegment = 'app-when-can-we.w3.org' // how to allocate this string and connect to\n\n    // ////////////////////////////////////////////\n\n    const fetcher = kb.fetcher\n    const updater = kb.updater\n    let waitingForLogin = false\n\n    const thisInstance = subject\n    const detailsDoc = subject.doc()\n    const baseDir = detailsDoc.dir()\n    const base = baseDir.uri\n\n    const resultsDoc = $rdf.sym(base + 'results.ttl')\n    // const formsURI = base + 'forms.ttl'\n    // We can't in fact host stuff from there because of CORS\n    const formsURI =\n      'https://solidos.github.io/solid-panes/schedule/formsForSchedule.ttl'\n\n    const form1 = kb.sym(formsURI + '#form1')\n    const form2 = kb.sym(formsURI + '#form2')\n    const form3 = kb.sym(formsURI + '#form3')\n\n    $rdf.parse(formText, kb, formsURI, 'text/turtle') // Load forms directly\n\n    const inputStyle =\n      'background-color: #eef; padding: 0.5em;  border: .5em solid white; font-size: 100%' //  font-size: 120%\n    const buttonIconStyle = 'width: 1.8em; height: 1.8em;'\n\n    // Utility functions\n\n    const complainIfBad = function (ok, message) {\n      if (!ok) {\n        div.appendChild(UI.widgets.errorMessageBlock(dom, message, 'pink'))\n      }\n    }\n\n    const clearElement = function (ele) {\n      while (ele.firstChild) {\n        ele.removeChild(ele.firstChild)\n      }\n      return ele\n    }\n\n    const refreshCellColor = function (cell, value) {\n      const bg = kb.any(value, UI.ns.ui('backgroundColor'))\n      if (bg) {\n        cell.setAttribute(\n          'style',\n          'padding: 0.3em; text-align: center; background-color: ' + bg + ';'\n        )\n      }\n    }\n\n    let me\n\n    authn.checkUser().then(webId => {\n      me = webId\n\n      if (logInOutButton) {\n        logInOutButton.refresh()\n      }\n      if (webId && waitingForLogin) {\n        waitingForLogin = false\n        showAppropriateDisplay()\n      }\n    })\n    console.log('me: ' + me) // @@ curently not actually used elsewhere\n\n    // //////////////////////////////  Reproduction: spawn a new instance\n    //\n    // Viral growth path: user of app decides to make another instance\n    //\n\n    const newInstanceButton = function () {\n      const b = UI.login.newAppInstance(\n        dom,\n        { noun: 'scheduler' },\n        initializeNewInstanceInWorkspace\n      )\n      b.firstChild.setAttribute('style', inputStyle)\n      return b\n    } // newInstanceButton\n\n    // ///////////////////////  Create new document files for new instance of app\n\n    const initializeNewInstanceInWorkspace = function (ws) {\n      let newBase = kb.any(ws, ns.space('uriPrefix'))\n      if (!newBase) {\n        newBase = ws.uri.split('#')[0]\n      } else {\n        newBase = newBase.value\n      }\n      if (newBase.slice(-1) !== '/') {\n        $rdf.log.error(appPathSegment + ': No / at end of uriPrefix ' + newBase) // @@ paramater?\n        newBase = newBase + '/'\n      }\n      const now = new Date()\n      newBase += appPathSegment + '/id' + now.getTime() + '/' // unique id\n\n      initializeNewInstanceAtBase(thisInstance, newBase)\n    }\n\n    const initializeNewInstanceAtBase = function (thisInstance, newBase) {\n      const options = { thisInstance, newBase }\n      this.mintNew(context, options)\n        .then(function (options) {\n          const p = div.appendChild(dom.createElement('p'))\n          p.setAttribute('style', 'font-size: 140%;')\n          p.innerHTML =\n            'Your <a href=\\'' +\n            options.newInstance.uri +\n            '\\'><b>new scheduler</b></a> is ready to be set up. ' +\n            '<br/><br/><a href=\\'' +\n            options.newInstance.uri +\n            '\\'>Say when you what days work for you.</a>'\n        })\n        .catch(function (error) {\n          complainIfBad(\n            false,\n            'Error createing new scheduler at ' +\n              options.newInstance +\n              ': ' +\n              error\n          )\n        })\n    }\n\n    // ///////////////////////\n\n    const getForms = function () {\n      console.log('getforms()')\n      getDetails()\n      /*\n      fetcher.nowOrWhenFetched(formsURI, undefined, function (ok, body) {\n        console.log('getforms() ok? ' + ok)\n        if (!ok) return complainIfBad(ok, body)\n        getDetails()\n      })\n      */\n    }\n\n    const getDetails = function () {\n      console.log('getDetails()') // Looking for blank screen hang-up\n      fetcher.nowOrWhenFetched(detailsDoc.uri, undefined, function (ok, body) {\n        console.log('getDetails() ok? ' + ok)\n        if (!ok) return complainIfBad(ok, body)\n        showAppropriateDisplay()\n      })\n    }\n\n    const showAppropriateDisplay = function showAppropriateDisplay () {\n      console.log('showAppropriateDisplay()')\n\n      authn.checkUser().then(webId => {\n        if (!webId) {\n          return showSignon()\n        }\n\n        // On gh-pages, the turtle will not load properly (bad mime type)\n        // but we can trap it as being a non-editable server.\n\n        if (\n          !kb.updater.editable(detailsDoc.uri, kb) ||\n          kb.holds(subject, ns.rdf('type'), ns.wf('TemplateInstance'))\n        ) {\n          // This is read-only example e.g. on github pages, etc\n          showBootstrap(div)\n          return\n        }\n\n        const ready = kb.any(subject, ns.sched('ready'))\n\n        if (!ready) {\n          showForms()\n        } else {\n          // no editing not author\n          getResults()\n        }\n      })\n    }\n\n    const showSignon = function showSignon () {\n      clearElement(naviMain)\n      const signonContext = { div, dom }\n      UI.login.ensureLoggedIn(signonContext).then(context => {\n        me = context.me\n        waitingForLogin = false // untested\n        showAppropriateDisplay()\n      })\n    }\n\n    const showBootstrap = function showBootstrap () {\n      const div = clearElement(naviMain)\n      div.appendChild(\n        UI.login.newAppInstance(\n          dom,\n          { noun: 'poll' },\n          initializeNewInstanceInWorkspace\n        )\n      )\n\n      div.appendChild(dom.createElement('hr')) // @@\n\n      const p = div.appendChild(dom.createElement('p'))\n      p.textContent =\n        'Where would you like to store the data for the poll?  ' +\n        'Give the URL of the directory where you would like the data stored.'\n      const baseField = div.appendChild(dom.createElement('input'))\n      baseField.setAttribute('type', 'text')\n      baseField.size = 80 // really a string\n      baseField.label = 'base URL'\n      baseField.autocomplete = 'on'\n\n      div.appendChild(dom.createElement('br')) // @@\n\n      const button = div.appendChild(dom.createElement('button'))\n      button.setAttribute('style', inputStyle)\n      button.textContent = 'Start new poll at this URI'\n      button.addEventListener('click', function (_e) {\n        let newBase = baseField.value\n        if (newBase.slice(-1) !== '/') {\n          newBase += '/'\n        }\n        initializeNewInstanceAtBase(thisInstance, newBase)\n      })\n    }\n\n    // ///////////// The forms to configure the poll\n\n    const doneButton = dom.createElement('button')\n\n    const showForms = function () {\n      clearElement(naviCenter) // Remove refresh button if nec\n      const div = naviMain\n      const wizard = true\n      let currentSlide = 0\n      let gotDoneButton = false\n      if (wizard) {\n        const forms = [form1, form2, form3]\n        const slides = []\n        currentSlide = 0\n        for (let f = 0; f < forms.length; f++) {\n          const slide = dom.createElement('div')\n          UI.widgets.appendForm(\n            document,\n            slide,\n            {},\n            subject,\n            forms[f],\n            detailsDoc,\n            complainIfBad\n          )\n          slides.push(slide)\n        }\n\n        const refresh = function () {\n          clearElement(naviMain).appendChild(slides[currentSlide])\n\n          if (currentSlide === 0) {\n            b1.setAttribute('disabled', '')\n          } else {\n            b1.removeAttribute('disabled')\n          }\n          if (currentSlide === slides.length - 1) {\n            b2.setAttribute('disabled', '')\n            if (!gotDoneButton) {\n              // Only expose at last slide seen\n              naviCenter.appendChild(emailButton) // could also check data shape\n              naviCenter.appendChild(doneButton) // could also check data shape\n              gotDoneButton = true\n            }\n          } else {\n            b2.removeAttribute('disabled')\n          }\n        }\n        const b1 = clearElement(naviLeft).appendChild(dom.createElement('button'))\n        b1.setAttribute('style', inputStyle)\n        b1.textContent = '<- go back'\n        b1.addEventListener(\n          'click',\n          function (_e) {\n            if (currentSlide > 0) {\n              currentSlide -= 1\n              refresh()\n            }\n          },\n          false\n        )\n\n        const b2 = clearElement(naviRight).appendChild(\n          dom.createElement('button')\n        )\n        b2.setAttribute('style', inputStyle)\n        b2.textContent = 'continue ->'\n        b2.addEventListener(\n          'click',\n          function (_e) {\n            if (currentSlide < slides.length - 1) {\n              currentSlide += 1\n              refresh()\n            }\n          },\n          false\n        )\n\n        refresh()\n      } else {\n        // not wizard one big form\n        // @@@ create the initial config doc if not exist\n        const table = div.appendChild(dom.createElement('table'))\n        UI.widgets.appendForm(\n          document,\n          table,\n          {},\n          subject,\n          form1,\n          detailsDoc,\n          complainIfBad\n        )\n        UI.widgets.appendForm(\n          document,\n          table,\n          {},\n          subject,\n          form2,\n          detailsDoc,\n          complainIfBad\n        )\n        UI.widgets.appendForm(\n          document,\n          table,\n          {},\n          subject,\n          form3,\n          detailsDoc,\n          complainIfBad\n        )\n        naviCenter.appendChild(doneButton) // could also check data shape\n      }\n      // @@@  link config to results\n\n      const insertables = []\n      insertables.push(\n        $rdf.st(\n          subject,\n          ns.sched('availabilityOptions'),\n          ns.sched('YesNoMaybe'),\n          detailsDoc\n        )\n      )\n      insertables.push(\n        $rdf.st(subject, ns.sched('ready'), new Date(), detailsDoc)\n      )\n      insertables.push(\n        $rdf.st(subject, ns.sched('results'), resultsDoc, detailsDoc)\n      ) // @@ also link in results\n\n      doneButton.setAttribute('style', inputStyle)\n      doneButton.textContent = 'Go to poll'\n      doneButton.addEventListener(\n        'click',\n        function (_e) {\n          if (kb.any(subject, ns.sched('ready'))) {\n            // already done\n            getResults()\n            naviRight.appendChild(emailButton)\n          } else {\n            naviRight.appendChild(emailButton)\n            kb.updater.update([], insertables, function (\n              uri,\n              success,\n              errorBody\n            ) {\n              if (!success) {\n                complainIfBad(success, errorBody)\n              } else {\n                // naviRight.appendChild(emailButton)\n                getResults()\n              }\n            })\n          }\n        },\n        false\n      )\n\n      const emailButton = dom.createElement('button')\n      emailButton.setAttribute('style', inputStyle)\n      const emailIcon = emailButton.appendChild(dom.createElement('img'))\n      emailIcon.setAttribute('src', UI.icons.iconBase + 'noun_480183.svg') // noun_480183.svg\n      emailIcon.setAttribute('style', buttonIconStyle)\n      // emailButton.textContent = 'email invitations'\n      emailButton.addEventListener(\n        'click',\n        function (_e) {\n          const title =\n            kb.anyValue(subject, ns.cal('summary')) ||\n            kb.anyValue(subject, ns.dc('title')) ||\n            ''\n          const mailto =\n            'mailto:' +\n            kb\n              .each(subject, ns.sched('invitee'))\n              .map(function (who) {\n                const mbox = kb.any(who, ns.foaf('mbox'))\n                return mbox ? mbox.uri.replace('mailto:', '') : ''\n              })\n              .join(',') +\n            '?subject=' +\n            encodeURIComponent(title + '-- When can we meet?') +\n            '&body=' +\n            encodeURIComponent(\n              title + '\\n\\nWhen can you?\\n\\nSee ' + subject + '\\n'\n            )\n          // @@ assumed there is a data browser\n\n          console.log('Mail: ' + mailto)\n          window.location.href = mailto\n        },\n        false\n      )\n    } // showForms\n\n    // Ask for each day, what times .. @@ to be added some time\n    /*\n    const setTimesOfDay = function () {\n      const i, j, x, y, slot, cell, day\n      const insertables = []\n      const possibleDays = kb.each(invitation, ns.sched('option'))\n        .map(function (opt) {return kb.any(opt, ns.cal('dtstart'))})\n      const cellLookup = []\n      const slots = kb.each(invitation, ns.sched('slot'))\n      if (slots.length === 0) {\n        for (i = 0; i < 2; i++) {\n          slot = UI.widgets.newThing(detailsDoc)\n          insertables.push($rdf.st(invitation, ns.sched('slot'), slot))\n          insertables.push($rdf.st(slot, ns.rdfs('label'), 'slot ' + (i + 1)))\n          for (j = 0; j < possibleDays.length; j++) {\n            day - possibleDays[j]\n            x = kb.any(slot, ns.rdfs('label'))\n            y = kb.any(day, ns.cal('dtstart'))\n            cell = UI.widgets.newThing(detailsDoc)\n            cellLookup[x.toNT() + y.toNT()] = cell\n            insertables.push($rdf.st(slot, ns.sched('cell'), cell))\n            insertables.push($rdf.st(cell, ns.sched('day'), possibleDays[j]))\n          }\n        }\n      }\n\n      const query = new $rdf.Query('TimesOfDay')\n      const v = {}['day', 'label', 'value', 'slot', 'cell'].map(function (x) {\n        query.consts.push(v[x] = $rdf.constiable(x)) })\n      query.pat.add(invitation, ns.sched('slot'), v.slot)\n      query.pat.add(v.slot, ns.rdfs('label'), v.label)\n      query.pat.add(v.slot, ns.sched('cell'), v.cell)\n      query.pat.add(v.cell, ns.sched('timeOfDay'), v.value)\n      query.pat.add(v.cell, ns.sched('day'), v.day)\n\n      const options = {}\n      options.set_x = kb.each(subject, ns.sched('slot')) // @@@@@ option -> dtstart in future\n      options.set_x = options.set_x.map(function (opt) { return kb.any(opt, ns.rdfs('label')) })\n\n      options.set_y = kb.each(subject, ns.sched('option')); // @@@@@ option -> dtstart in future\n      options.set_y = options.set_y.map(function (opt) { return kb.any(opt, ns.cal('dtstart')) })\n\n      const possibleTimes = kb.each(invitation, ns.sched('option'))\n        .map(function (opt) { return kb.any(opt, ns.cal('dtstart')) })\n\n      const displayTheMatrix = function () {\n        const matrix = div.appendChild(UI.matrix.matrixForQuery(\n          dom, query, v.time, v.author, v.value, options, function () {}))\n\n        matrix.setAttribute('class', 'matrix')\n\n        const refreshButton = dom.createElement('button')\n        refreshButton.setAttribute('style', inputStyle)\n        refreshButton.textContent = 'refresh'\n        refreshButton.addEventListener('click', function (e) {\n          refreshButton.disabled = true\n          store.fetcher.nowOrWhenFetched(subject.doc(), undefined, function (ok, body) {\n            if (!ok) {\n              console.log('Cant refresh matrix' + body)\n            } else {\n              matrix.refresh()\n              refreshButton.disabled = false\n            }\n          })\n        }, false)\n\n        clearElement(naviCenter)\n        naviCenter.appendChild(refreshButton)\n      }\n\n      const dataPointForNT = []\n\n      const doc = resultsDoc\n      options.set_y = options.set_y.filter(function (z) { return (! z.sameTerm(me)) })\n      options.set_y.push(me) // Put me on the end\n\n      options.cellFunction = function (cell, x, y, value) {\n        // const point = cellLookup[x.toNT() + y.toNT()]\n\n        if (y.sameTerm(me)) {\n          const callbackFunction = function () { refreshCellColor(cell, value); }; //  @@ may need that\n          const selectOptions = {}\n          const predicate = ns.sched('timeOfDay')\n          const cellSubject = dataPointForNT[x.toNT()]\n          const selector = UI.widgets.makeSelectForOptions(dom, kb, cellSubject, predicate,\n            possibleAvailabilities, selectOptions, resultsDoc, callbackFunction)\n          cell.appendChild(selector)\n        } else if (value !== null) {\n          cell.textContent = UI.utils.label(value)\n        }\n\n      }\n\n      const responses = kb.each(invitation, ns.sched('response'))\n      const myResponse = null\n      responses.map(function (r) {\n        if (kb.holds(r, ns.dc('author'), me)) {\n          myResponse = r\n        }\n      })\n\n      const id = UI.widgets.newThing(doc).uri\n      if (myResponse === null) {\n        myResponse = $rdf.sym(id + '_response')\n        insertables.push($rdf.st(invitation, ns.sched('response'), myResponse, doc))\n        insertables.push($rdf.st(myResponse, ns.dc('author'), me, doc))\n      } else {\n        const dps = kb.each(myResponse, ns.sched('cell'))\n        dps.map(function (dataPoint) {\n          const time = kb.any(dataPoint, ns.cal('dtstart'))\n          dataPointForNT[time.toNT()] = dataPoint\n        })\n      }\n      for (let j = 0; j < possibleTimes.length; j++) {\n        if (dataPointForNT[possibleTimes[j].toNT()]) continue\n        const dataPoint = $rdf.sym(id + '_' + j)\n        insertables.push($rdf.st(myResponse, ns.sched('cell'), dataPoint, doc))\n        insertables.push($rdf.st(dataPoint, ns.cal('dtstart'), possibleTimes[j], doc)) // @@\n        dataPointForNT[possibleTimes[j].toNT()] = dataPoint\n      }\n      if (insertables.length) {\n        store.updater.update([], insertables, function (uri, success, errorBody) {\n          if (!success) {\n            complainIfBad(success, errorBody)\n          } else {\n            displayTheMatrix()\n          }\n        })\n      } else { // no insertables\n        displayTheMatrix()\n      }\n    }\n    */\n    // end setTimesOfDay\n\n    // Read or create empty results file\n    function getResults () {\n      fetcher.nowOrWhenFetched(resultsDoc.uri, (ok, body, response) => {\n        if (!ok) {\n          if (response.status === 404) {\n            // /  Check explicitly for 404 error\n            console.log('Initializing details file ' + resultsDoc)\n            updater.put(resultsDoc, [], 'text/turtle', function (\n              uri2,\n              ok,\n              message\n            ) {\n              if (ok) {\n                clearElement(naviMain)\n                showResults()\n              } else {\n                complainIfBad(\n                  ok,\n                  'FAILED to create results file at: ' +\n                    resultsDoc.uri +\n                    ' : ' +\n                    message\n                )\n                console.log(\n                  'FAILED to craete results file at: ' +\n                    resultsDoc.uri +\n                    ' : ' +\n                    message\n                )\n              }\n            })\n          } else {\n            // Other error, not 404 -- do not try to overwite the file\n            complainIfBad(ok, 'FAILED to read results file: ' + body)\n          }\n        } else {\n          // Happy read\n          clearElement(naviMain)\n          showResults()\n        }\n      })\n    }\n\n    function showResults () {\n      //       Now the form for responsing to the poll\n      //\n\n      // div.appendChild(dom.createElement('hr'))\n\n      // const invitation = subject\n      const title = kb.any(invitation, ns.cal('summary'))\n      const comment = kb.any(invitation, ns.cal('comment'))\n      const location = kb.any(invitation, ns.cal('location'))\n      const div = naviMain\n      if (title) div.appendChild(dom.createElement('h3')).textContent = title\n      if (location) {\n        div.appendChild(dom.createElement('address')).textContent =\n          location.value\n      }\n      if (comment) {\n        div.appendChild(dom.createElement('p')).textContent = comment.value\n      }\n      const author = kb.any(invitation, ns.dc('author'))\n      if (author) {\n        const authorName = kb.any(author, ns.foaf('name'))\n        if (authorName) {\n          div.appendChild(dom.createElement('p')).textContent = authorName\n        }\n      }\n\n      const query = new $rdf.Query('Responses')\n      const v = {}\n      const vs = ['time', 'author', 'value', 'resp', 'cell']\n      vs.forEach(function (x) {\n        query.vars.push((v[x] = $rdf.variable(x)))\n      })\n      query.pat.add(invitation, ns.sched('response'), v.resp)\n      query.pat.add(v.resp, ns.dc('author'), v.author)\n      query.pat.add(v.resp, ns.sched('cell'), v.cell)\n      query.pat.add(v.cell, ns.sched('availabilty'), v.value)\n      query.pat.add(v.cell, ns.cal('dtstart'), v.time)\n\n      // Sort by by person @@@\n\n      const options = {}\n      options.set_x = kb.each(subject, ns.sched('option')) // @@@@@ option -> dtstart in future\n      options.set_x = options.set_x.map(function (opt) {\n        return kb.any(opt, ns.cal('dtstart'))\n      })\n\n      options.set_y = kb.each(subject, ns.sched('response'))\n      options.set_y = options.set_y.map(function (resp) {\n        return kb.any(resp, ns.dc('author'))\n      })\n\n      const possibleTimes = kb\n        .each(invitation, ns.sched('option'))\n        .map(function (opt) {\n          return kb.any(opt, ns.cal('dtstart'))\n        })\n\n      const displayTheMatrix = function () {\n        const matrix = div.appendChild(\n          UI.matrix.matrixForQuery(\n            dom,\n            query,\n            v.time,\n            v.author,\n            v.value,\n            options,\n            function () {}\n          )\n        )\n\n        matrix.setAttribute('class', 'matrix')\n\n        const refreshButton = dom.createElement('button')\n        refreshButton.setAttribute('style', inputStyle)\n        // refreshButton.textContent = 'refresh' // noun_479395.svg\n        const refreshIcon = dom.createElement('img')\n        refreshIcon.setAttribute('src', UI.icons.iconBase + 'noun_479395.svg')\n        refreshIcon.setAttribute('style', buttonIconStyle)\n        refreshButton.appendChild(refreshIcon)\n        refreshButton.addEventListener(\n          'click',\n          function (_e) {\n            refreshButton.disabled = true\n            kb.fetcher.refresh(resultsDoc, function (ok, body) {\n              if (!ok) {\n                console.log('Cant refresh matrix' + body)\n              } else {\n                matrix.refresh()\n                refreshButton.disabled = false\n              }\n            })\n          },\n          false\n        )\n\n        clearElement(naviCenter)\n        naviCenter.appendChild(refreshButton)\n      }\n\n      // @@ Give other combos too-- see schedule ontology\n      // const possibleAvailabilities = [ SCHED('No'), SCHED('Maybe'), SCHED('Yes') ]\n\n      // const me = authn.currentUser()\n\n      const dataPointForNT = []\n\n      const loginContext = { div: naviCenter, dom }\n      UI.login.ensureLoggedIn(loginContext).then(context => {\n        const me = context.me\n        const doc = resultsDoc\n        options.set_y = options.set_y.filter(function (z) {\n          return !z.sameTerm(me)\n        })\n        options.set_y.push(me) // Put me on the end\n\n        options.cellFunction = function (cell, x, y, value) {\n          if (value !== null) {\n            kb.fetcher.nowOrWhenFetched(\n              value.uri.split('#')[0],\n              undefined,\n              function (ok, _error) {\n                if (ok) refreshCellColor(cell, value)\n              }\n            )\n          }\n          if (y.sameTerm(me)) {\n            const callbackFunction = function () {\n              refreshCellColor(cell, value)\n            } //  @@ may need that\n            const selectOptions = {}\n            const predicate = ns.sched('availabilty')\n            const cellSubject = dataPointForNT[x.toNT()]\n            const selector = UI.widgets.makeSelectForOptions(\n              dom,\n              kb,\n              cellSubject,\n              predicate,\n              possibleAvailabilities,\n              selectOptions,\n              resultsDoc,\n              callbackFunction\n            )\n            cell.appendChild(selector)\n          } else if (value !== null) {\n            cell.textContent = UI.utils.label(value)\n          }\n        }\n\n        const responses = kb.each(invitation, ns.sched('response'))\n        let myResponse = null\n        responses.forEach(function (r) {\n          if (kb.holds(r, ns.dc('author'), me)) {\n            myResponse = r\n          }\n        })\n\n        const insertables = [] // list of statements to be stored\n\n        const id = UI.widgets.newThing(doc).uri\n        if (myResponse === null) {\n          myResponse = $rdf.sym(id + '_response')\n          insertables.push(\n            $rdf.st(invitation, ns.sched('response'), myResponse, doc)\n          )\n          insertables.push($rdf.st(myResponse, ns.dc('author'), me, doc))\n        } else {\n          const dps = kb.each(myResponse, ns.sched('cell'))\n          dps.forEach(function (dataPoint) {\n            const time = kb.any(dataPoint, ns.cal('dtstart'))\n            dataPointForNT[time.toNT()] = dataPoint\n          })\n        }\n        for (let j = 0; j < possibleTimes.length; j++) {\n          if (dataPointForNT[possibleTimes[j].toNT()]) continue\n          const dataPoint = $rdf.sym(id + '_' + j)\n          insertables.push(\n            $rdf.st(myResponse, ns.sched('cell'), dataPoint, doc)\n          )\n          insertables.push(\n            $rdf.st(dataPoint, ns.cal('dtstart'), possibleTimes[j], doc)\n          ) // @@\n          dataPointForNT[possibleTimes[j].toNT()] = dataPoint\n        }\n        if (insertables.length) {\n          kb.updater.update([], insertables, function (\n            uri,\n            success,\n            errorBody\n          ) {\n            if (!success) {\n              complainIfBad(success, errorBody)\n            } else {\n              displayTheMatrix()\n            }\n          })\n        } else {\n          // no insertables\n          displayTheMatrix()\n        }\n      }) // @@@@ end of .then\n\n      // If I made this in the first place, allow me to edit it.\n      // @@ optionally -- allows others to if according to original\n      const instanceCreator = kb.any(subject, ns.foaf('maker')) // owner?\n      if (!instanceCreator || instanceCreator.sameTerm(me)) {\n        const editButton = dom.createElement('button')\n        editButton.setAttribute('style', inputStyle)\n        // editButton.textContent = '(Modify the poll)' // noun_344563.svg\n        const editIcon = dom.createElement('img')\n        editIcon.setAttribute('src', UI.icons.iconBase + 'noun_344563.svg')\n        editIcon.setAttribute('style', buttonIconStyle)\n        editButton.appendChild(editIcon)\n        editButton.addEventListener(\n          'click',\n          function (_e) {\n            clearElement(div)\n            showForms()\n          },\n          false\n        )\n        clearElement(naviLeft)\n        naviLeft.appendChild(editButton)\n      }\n\n      // div.appendChild(editButton)\n\n      clearElement(naviRight)\n      naviRight.appendChild(newInstanceButton())\n    } // showResults\n\n    const div = dom.createElement('div')\n    const structure = div.appendChild(dom.createElement('table')) // @@ make responsive style\n    structure.setAttribute(\n      'style',\n      'background-color: white; min-width: 40em; min-height: 13em;'\n    )\n\n    const naviLoginoutTR = structure.appendChild(dom.createElement('tr'))\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n\n    const logInOutButton = null\n    /*\n    const logInOutButton = UI.login.loginStatusBox(dom, setUser)\n    // floating divs lead to a mess\n    // logInOutButton.setAttribute('style', 'float: right') // float the beginning of the end\n    naviLoginout3.appendChild(logInOutButton)\n    logInOutButton.setAttribute('style', 'margin-right: 0em;')\n    */\n\n    const naviTop = structure.appendChild(dom.createElement('tr'))\n    const naviMain = naviTop.appendChild(dom.createElement('td'))\n    naviMain.setAttribute('colspan', '3')\n\n    const naviMenu = structure.appendChild(dom.createElement('tr'))\n    naviMenu.setAttribute('class', 'naviMenu')\n    naviMenu.setAttribute(\n      'style',\n      ' text-align: middle; vertical-align: middle; padding-top: 4em; '\n    )\n    //    naviMenu.setAttribute('style', 'margin-top: 3em;')\n    const naviLeft = naviMenu.appendChild(dom.createElement('td'))\n    const naviCenter = naviMenu.appendChild(dom.createElement('td'))\n    const naviRight = naviMenu.appendChild(dom.createElement('td'))\n\n    getForms()\n\n    return div\n  } // render\n} // property list\n// ends\n"],"mappings":"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,IAAI,GAAGvL,EAAE,CAACuC,GAAG,CAAC+I,GAAG,EAAEpM,EAAE,CAACgD,IAAI,CAAC,MAAM,CAAC,CAAC;UACzC,OAAOqJ,IAAI,GAAGA,IAAI,CAAC9I,GAAG,CAAC+I,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,GAAG,EAAE;QACpD,CAAC,CAAC,CACDC,IAAI,CAAC,GAAG,CAAC,GACZ,WAAW,GACXC,kBAAkB,CAACV,KAAK,GAAG,sBAAsB,CAAC,GAClD,QAAQ,GACRU,kBAAkB,CAChBV,KAAK,GAAG,2BAA2B,GAAGlL,OAAO,GAAG,IAClD,CAAC;QACH;;QAEAmB,OAAO,CAACC,GAAG,CAAC,QAAQ,GAAGiK,MAAM,CAAC;QAC9BQ,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAGV,MAAM;MAC/B,CAAC,EACD,KACF,CAAC;IACH,CAAC,EAAC;;IAEF;IACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IAgBI;;IAEA;IACA,SAASrC,UAAUA,CAAA,EAAI;MACrBpG,OAAO,CAAC4F,gBAAgB,CAAC5C,UAAU,CAACjD,GAAG,EAAE,CAAC1B,EAAE,EAAEC,IAAI,EAAE8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","ignoreList":[]}
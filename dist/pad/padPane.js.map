{"version":3,"file":"padPane.js","names":["_solidUiJss","require","_solidLogicJss","_rdflib","paneDef","icon","icons","iconBase","name","audience","ns","solid","label","subject","context","t","session","store","findTypeURIs","mintClass","pad","mintNew","newPaneOptions","updater","me","uri","Error","newInstance","sym","newBase","newPadDoc","doc","add","rdf","dc","Date","chunk","sioc","Promise","resolve","reject","put","statementsMatching","undefined","uri2","ok","message","render","paneOptions","dom","complainIfBad","div","appendChild","widgets","errorMessageBlock","clearElement","ele","firstChild","removeChild","genACLtext","docURI","aclURI","allWrite","g","graph","auth","Namespace","a","acl","foaf","serialize","setACL","callbackFunction","aclDoc","any","fetcher","aclText","webOperation","data","contentType","then","catch","err","load","newInstanceButton","button","createElement","textContent","addEventListener","showBootstrap","spawnArea","thisInstance","container","noun","appDetails","login","newAppInstance","workspace","initializeNewInstanceInWorkspace","NamedNode","p","baseField","setAttribute","size","autocomplete","_e","value","slice","initializeNewInstanceAtBase","ws","space","split","log","error","appPathSegment","now","getTime","here","base","newIndexDoc","toBeCopied","local","agenda","f","length","item","fun","copyItem","push","newURI","console","setThatACL","shift","webCopy","authn","checkUser","webId","createNewPadDataFile","PAD","padDoc","_uri2","body","innerHTML","showResults","exists","currentUser","title","vcard","solo","window","document","options","padEle","notepad","naviMain","partipationTarget","meeting","manageParticipation","naviMiddle2","setRefreshHandler","reloadAndSync","loadPadData","nowOrWhenFetched","response","status","holds","wf","naviMiddle3","structure","naviLoginoutTR","naviTop","naviMiddle","naviMiddle1","naviStatus","statusArea","naviSpawn","naviMenu","timingArea","_default","exports","default"],"sources":["../../src/pad/padPane.ts"],"sourcesContent":["import { icons, ns, pad, widgets, login } from 'solid-ui-jss'\nimport { authn, AppDetails } from 'solid-logic-jss'\nimport { graph, log, NamedNode, Namespace, sym, serialize, Store } from 'rdflib'\nimport { PaneDefinition } from 'pane-registry'\n/*   pad Pane\n **\n */\n\nconst paneDef: PaneDefinition = {\n  // icon:  (module.__dirname || __dirname) + 'images/ColourOn.png',\n  icon: icons.iconBase + 'noun_79217.svg',\n\n  name: 'pad',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve an pad pane?\n  label: function (subject, context) {\n    const t = (context.session.store as Store).findTypeURIs(subject)\n    if (t['http://www.w3.org/ns/pim/pad#Notepad']) {\n      return 'pad'\n    }\n    return null // No under other circumstances\n  },\n\n  mintClass: ns.pad('Notepad'),\n\n  mintNew: function (context, newPaneOptions: any) {\n    const store = context.session.store as Store\n    const updater = store.updater\n    if (newPaneOptions.me && !newPaneOptions.me.uri) {\n      throw new Error('notepad mintNew:  Invalid userid')\n    }\n\n    const newInstance = (newPaneOptions.newInstance =\n      newPaneOptions.newInstance ||\n      store.sym(newPaneOptions.newBase + 'index.ttl#this'))\n    // const newInstance = kb.sym(newBase + 'pad.ttl#thisPad');\n    const newPadDoc = newInstance.doc()\n\n    store.add(newInstance, ns.rdf('type'), ns.pad('Notepad'), newPadDoc)\n    store.add(newInstance, ns.dc('title'), 'Shared Notes', newPadDoc)\n    store.add(newInstance, ns.dc('created'), new Date() as any, newPadDoc) // @@ TODO Remove casting\n    if (newPaneOptions.me) {\n      store.add(newInstance, ns.dc('author'), newPaneOptions.me, newPadDoc)\n    }\n    // kb.add(newInstance, ns.pad('next'), newInstance, newPadDoc);\n    // linked list empty @@\n    const chunk = store.sym(newInstance.uri + '_line0')\n    store.add(newInstance, ns.pad('next'), chunk, newPadDoc) // Linked list has one entry\n    store.add(chunk, ns.pad('next'), newInstance, newPadDoc)\n    store.add(chunk, ns.dc('author'), newPaneOptions.me, newPadDoc)\n    store.add(chunk, ns.sioc('content'), '', newPadDoc)\n\n    return new Promise(function (resolve, reject) {\n      if (!updater) {\n        reject(new Error('Have no updater'))\n        return\n      }\n      updater.put(\n        newPadDoc,\n        store.statementsMatching(undefined, undefined, undefined, newPadDoc),\n        'text/turtle',\n        function (uri2, ok, message) {\n          if (ok) {\n            resolve(newPaneOptions)\n          } else {\n            reject(\n              new Error('FAILED to save new tool at: ' + uri2 + ' : ' + message)\n            )\n          }\n        }\n      )\n    })\n  },\n  // and follow instructions there\n  // @@ TODO Set better type for paneOptions\n  render: function (subject, context, paneOptions: any) {\n    const dom = context.dom\n    const store = context.session.store as Store\n    // Utility functions\n    const complainIfBad = function (ok: boolean, message: string) {\n      if (!ok) {\n        div.appendChild(widgets.errorMessageBlock(dom, message, 'pink'))\n      }\n    }\n\n    const clearElement = function (ele: HTMLElement) {\n      while (ele.firstChild) {\n        ele.removeChild(ele.firstChild)\n      }\n      return ele\n    }\n\n    // Access control\n\n    // Two constiations of ACL for this app, public read and public read/write\n    // In all cases owner has read write control\n    const genACLtext = function (\n      docURI: string,\n      aclURI: string,\n      allWrite: boolean\n    ) {\n      const g = graph()\n      const auth = Namespace('http://www.w3.org/ns/auth/acl#')\n      let a = g.sym(aclURI + '#a1')\n      const acl = g.sym(aclURI)\n      const doc = g.sym(docURI)\n      g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n      g.add(a, auth('accessTo'), doc, acl)\n      g.add(a, auth('agent'), me, acl)\n      g.add(a, auth('mode'), auth('Read'), acl)\n      g.add(a, auth('mode'), auth('Write'), acl)\n      g.add(a, auth('mode'), auth('Control'), acl)\n\n      a = g.sym(aclURI + '#a2')\n      g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n      g.add(a, auth('accessTo'), doc, acl)\n      g.add(a, auth('agentClass'), ns.foaf('Agent'), acl)\n      g.add(a, auth('mode'), auth('Read'), acl)\n      if (allWrite) {\n        g.add(a, auth('mode'), auth('Write'), acl)\n      }\n      // TODO: Figure out why `serialize` isn't on the type definition according to TypeScript:\n      return serialize(acl, g, aclURI, 'text/turtle')\n    }\n\n    /**\n     * @param docURI\n     * @param allWrite\n     * @param callbackFunction\n     *\n     * @returns {Promise<Response>}\n     */\n    const setACL = function setACL (\n      docURI: string,\n      allWrite: boolean,\n      callbackFunction: Function\n    ) {\n      const aclDoc = store.any(\n        sym(docURI),\n        sym('http://www.iana.org/assignments/link-relations/acl')\n      ) as NamedNode // @@ check that this get set by web.js\n      if (!fetcher) {\n        throw new Error('Have no fetcher')\n      }\n      if (aclDoc) {\n        // Great we already know where it is\n        const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n        return fetcher\n          .webOperation('PUT', aclDoc.uri, {\n            data: aclText,\n            contentType: 'text/turtle'\n          })\n          .then(() => callbackFunction(true))\n          .catch(err => {\n            callbackFunction(false, err.message)\n          })\n      } else {\n        return fetcher\n          .load(docURI)\n          .catch((err: Error) => {\n            callbackFunction(false, 'Getting headers for ACL: ' + err)\n          })\n          .then(() => {\n            const aclDoc = store.any(\n              sym(docURI),\n              sym('http://www.iana.org/assignments/link-relations/acl')\n            ) as NamedNode\n\n            if (!aclDoc) {\n              // complainIfBad(false, \"No Link rel=ACL header for \" + docURI);\n              throw new Error('No Link rel=ACL header for ' + docURI)\n            }\n\n            const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n\n            return fetcher.webOperation('PUT', aclDoc.uri, {\n              data: aclText,\n              contentType: 'text/turtle'\n            })\n          })\n          .then(() => callbackFunction(true))\n          .catch(err => {\n            callbackFunction(false, err.message)\n          })\n      }\n    }\n\n    //  Reproduction: spawn a new instance\n    //\n    // Viral growth path: user of app decides to make another instance\n    const newInstanceButton = function () {\n      const button = div.appendChild(dom.createElement('button'))\n      button.textContent = 'Start another pad'\n      button.addEventListener('click', function () {\n        return showBootstrap(subject, spawnArea, 'pad')\n      })\n      return button\n    }\n\n    // Option of either using the workspace system or just typing in a URI\n    const showBootstrap = function showBootstrap (\n      thisInstance: any,\n      container: HTMLElement,\n      noun: string\n    ) {\n      const div = clearElement(container)\n      const appDetails = { noun: 'notepad' } as AppDetails\n      div.appendChild(\n        login.newAppInstance(dom, appDetails, (workspace: string | null, newBase) => {\n          // FIXME: not sure if this will work at all, just\n          // trying to get the types to match - Michiel.\n          return initializeNewInstanceInWorkspace(new NamedNode(workspace || newBase))\n        })\n      )\n\n      div.appendChild(dom.createElement('hr')) // @@\n\n      const p = div.appendChild(dom.createElement('p'))\n      p.textContent =\n        'Where would you like to store the data for the ' +\n        noun +\n        '?  ' +\n        'Give the URL of the directory where you would like the data stored.'\n      const baseField = div.appendChild(dom.createElement('input'))\n      baseField.setAttribute('type', 'text')\n      baseField.size = 80 // really a string\n      ;(baseField as any).label = 'base URL'\n      baseField.autocomplete = 'on'\n\n      div.appendChild(dom.createElement('br')) // @@\n\n      const button = div.appendChild(dom.createElement('button'))\n      button.textContent = 'Start new ' + noun + ' at this URI'\n      button.addEventListener('click', function (_e) {\n        let newBase = baseField.value\n        if (newBase.slice(-1) !== '/') {\n          newBase += '/'\n        }\n        initializeNewInstanceAtBase(thisInstance, newBase)\n      })\n    }\n\n    //  Create new document files for new instance of app\n    const initializeNewInstanceInWorkspace = function (ws: NamedNode) {\n      // @@ TODO Clean up type for newBase\n      let newBase: any = store.any(ws, ns.space('uriPrefix'))\n      if (!newBase) {\n        newBase = ws.uri.split('#')[0]\n      } else {\n        newBase = newBase.value\n      }\n      if (newBase.slice(-1) !== '/') {\n        log.error(appPathSegment + ': No / at end of uriPrefix ' + newBase) // @@ paramater?\n        newBase = newBase + '/'\n      }\n      const now = new Date()\n      newBase += appPathSegment + '/id' + now.getTime() + '/' // unique id\n\n      initializeNewInstanceAtBase(thisInstance, newBase)\n    }\n\n    const initializeNewInstanceAtBase = function (\n      thisInstance: any,\n      newBase: string\n    ) {\n      const here = sym(thisInstance.uri.split('#')[0])\n      const base = here // @@ ???\n\n      const newPadDoc = store.sym(newBase + 'pad.ttl')\n      const newIndexDoc = store.sym(newBase + 'index.html')\n\n      const toBeCopied = [{ local: 'index.html', contentType: 'text/html' }]\n\n      const newInstance = store.sym(newPadDoc.uri + '#thisPad')\n\n      // log.debug(\"\\n Ready to put \" + kb.statementsMatching(undefined, undefined, undefined, there)); //@@\n\n      const agenda: Function[] = []\n\n      let f //   @@ This needs some form of visible progress bar\n      for (f = 0; f < toBeCopied.length; f++) {\n        const item = toBeCopied[f]\n        const fun = function copyItem (item: any) {\n          agenda.push(function () {\n            const newURI = newBase + item.local\n            console.log('Copying ' + base + item.local + ' to ' + newURI)\n\n            const setThatACL = function () {\n              setACL(newURI, false, function (ok: boolean, message: string) {\n                if (!ok) {\n                  complainIfBad(\n                    ok,\n                    'FAILED to set ACL ' + newURI + ' : ' + message\n                  )\n                  console.log('FAILED to set ACL ' + newURI + ' : ' + message)\n                } else {\n                  agenda.shift()!() // beware too much nesting\n                }\n              })\n            }\n            if (!store.fetcher) {\n              throw new Error('Store has no fetcher')\n            }\n            store.fetcher\n              .webCopy(\n                base + item.local,\n                newBase + item.local,\n                item.contentType\n              )\n              .then(() => authn.checkUser())\n              .then(webId => {\n                me = webId\n\n                setThatACL()\n              })\n              .catch(err => {\n                console.log(\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n                complainIfBad(\n                  false,\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n              })\n          })\n        }\n        fun(item)\n      }\n\n      agenda.push(function createNewPadDataFile () {\n        store.add(newInstance, ns.rdf('type'), PAD('Notepad'), newPadDoc)\n\n        // TODO @@ Remove casting of add\n        store.add(\n          newInstance,\n          ns.dc('created'),\n          new Date() as any, // @@ TODO Remove casting\n          newPadDoc\n        )\n        if (me) {\n          store.add(newInstance, ns.dc('author'), me, newPadDoc)\n        }\n        store.add(newInstance, PAD('next'), newInstance, newPadDoc) // linked list empty\n\n        // Keep a paper trail   @@ Revisit when we have non-public ones @@ Privacy\n        store.add(newInstance, ns.space('inspiration'), thisInstance, padDoc)\n        store.add(newInstance, ns.space('inspiration'), thisInstance, newPadDoc)\n        if (!updater) {\n          throw new Error('Have no updater')\n        }\n        updater.put(\n          newPadDoc,\n          store.statementsMatching(undefined, undefined, undefined, newPadDoc),\n          'text/turtle',\n          function (_uri2, ok, message) {\n            if (ok) {\n              agenda.shift()!()\n            } else {\n              complainIfBad(\n                ok,\n                'FAILED to save new notepad at: ' +\n                  newPadDoc.uri +\n                  ' : ' +\n                  message\n              )\n              console.log(\n                'FAILED to save new notepad at: ' +\n                  newPadDoc.uri +\n                  ' : ' +\n                  message\n              )\n            }\n          }\n        )\n      })\n\n      agenda.push(function () {\n        setACL(newPadDoc.uri, true, function (ok: boolean, body: string) {\n          complainIfBad(\n            ok,\n            'Failed to set Read-Write ACL on pad data file: ' + body\n          )\n          if (ok) agenda.shift()!()\n        })\n      })\n\n      agenda.push(function () {\n        // give the user links to the new app\n\n        const p = div.appendChild(dom.createElement('p'))\n        p.setAttribute('style', 'font-size: 140%;')\n        p.innerHTML =\n          'Your <a href=\\'' +\n          newIndexDoc.uri +\n          '\\'><b>new notepad</b></a> is ready. ' +\n          '<br/><br/><a href=\\'' +\n          newIndexDoc.uri +\n          '\\'>Go to new pad</a>'\n      })\n\n      agenda.shift()!()\n      // Created new data files.\n    }\n\n    //  Update on incoming changes\n    const showResults = function (exists: boolean) {\n      console.log('showResults()')\n\n      me = authn.currentUser()\n\n      authn.checkUser().then((webId: unknown) => {\n        me = webId as string\n      })\n\n      const title =\n        store.any(subject, ns.dc('title')) || store.any(subject, ns.vcard('fn'))\n      if (paneOptions.solo && typeof window !== 'undefined' && title) {\n        window.document.title = title.value\n      }\n      options.exists = exists\n      padEle = pad.notepad(dom, padDoc, subject, me, options)\n      naviMain.appendChild(padEle)\n\n      const partipationTarget =\n        store.any(subject, ns.meeting('parentMeeting')) || subject\n      pad.manageParticipation(\n        dom,\n        naviMiddle2,\n        padDoc,\n        partipationTarget as any,\n        me,\n        options\n      )\n      if (!store.updater) {\n        throw new Error('Store has no updater')\n      }\n\n      store.updater.setRefreshHandler(padDoc, padEle.reloadAndSync) // initiated =\n    }\n\n    // Read or create empty data file\n    const loadPadData = function () {\n      if (!fetcher) {\n        throw new Error('Have no fetcher')\n      }\n      fetcher.nowOrWhenFetched(padDoc.uri, undefined, function (\n        ok: boolean,\n        body: string,\n        response: any\n      ) {\n        if (!ok) {\n          if (response.status === 404) {\n            // /  Check explicitly for 404 error\n            console.log('Initializing results file ' + padDoc)\n            if (!updater) {\n              throw new Error('Have no updater')\n            }\n            updater.put(padDoc, [], 'text/turtle', function (\n              _uri2,\n              ok,\n              message\n            ) {\n              if (ok) {\n                clearElement(naviMain)\n                showResults(false)\n              } else {\n                complainIfBad(\n                  ok,\n                  'FAILED to create results file at: ' +\n                    padDoc.uri +\n                    ' : ' +\n                    message\n                )\n                console.log(\n                  'FAILED to craete results file at: ' +\n                    padDoc.uri +\n                    ' : ' +\n                    message\n                )\n              }\n            })\n          } else {\n            // Other error, not 404 -- do not try to overwite the file\n            complainIfBad(ok, 'FAILED to read results file: ' + body)\n          }\n        } else {\n          // Happy read\n          clearElement(naviMain)\n          if (store.holds(subject, ns.rdf('type'), ns.wf('TemplateInstance'))) {\n            showBootstrap(subject, naviMain, 'pad')\n          }\n          showResults(true)\n          naviMiddle3.appendChild(newInstanceButton())\n        }\n      })\n    }\n\n    //  Body of Pane\n    const appPathSegment = 'app-pad.timbl.com' // how to allocate this string and connect to\n\n    const fetcher = store.fetcher\n    const updater = store.updater\n    let me: any\n\n    const PAD = Namespace('http://www.w3.org/ns/pim/pad#')\n\n    const thisInstance = subject\n    const padDoc = subject.doc()\n\n    let padEle\n\n    const div = dom.createElement('div')\n\n    //  Build the DOM\n    const structure = div.appendChild(dom.createElement('table')) // @@ make responsive style\n    structure.setAttribute(\n      'style',\n      'background-color: white; min-width: 94%; margin-right:3% margin-left: 3%; min-height: 13em;'\n    )\n\n    const naviLoginoutTR = structure.appendChild(dom.createElement('tr'))\n    naviLoginoutTR.appendChild(dom.createElement('td')) // naviLoginout1\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n\n    const naviTop = structure.appendChild(dom.createElement('tr')) // stuff\n    const naviMain = naviTop.appendChild(dom.createElement('td'))\n    naviMain.setAttribute('colspan', '3')\n\n    const naviMiddle = structure.appendChild(dom.createElement('tr')) // controls\n    const naviMiddle1 = naviMiddle.appendChild(dom.createElement('td'))\n    const naviMiddle2 = naviMiddle.appendChild(dom.createElement('td'))\n    const naviMiddle3 = naviMiddle.appendChild(dom.createElement('td'))\n\n    const naviStatus = structure.appendChild(dom.createElement('tr')) // status etc\n    const statusArea = naviStatus.appendChild(dom.createElement('div'))\n\n    const naviSpawn = structure.appendChild(dom.createElement('tr')) // create new\n    const spawnArea = naviSpawn.appendChild(dom.createElement('div'))\n\n    const naviMenu = structure.appendChild(dom.createElement('tr'))\n    naviMenu.setAttribute('class', 'naviMenu')\n    // naviMenu.setAttribute('style', 'margin-top: 3em;');\n    naviMenu.appendChild(dom.createElement('td')) // naviLeft\n    naviMenu.appendChild(dom.createElement('td'))\n    naviMenu.appendChild(dom.createElement('td'))\n\n    const options: any = { statusArea, timingArea: naviMiddle1 }\n\n    loadPadData()\n\n    return div\n  }\n}\n// ends\n\nexport default paneDef\n"],"mappings":"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","ignoreList":[]}
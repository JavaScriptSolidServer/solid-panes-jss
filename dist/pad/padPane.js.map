{"version":3,"file":"padPane.js","names":["icons","ns","pad","widgets","login","authn","graph","log","NamedNode","Namespace","sym","serialize","paneDef","icon","iconBase","name","audience","solid","label","subject","context","t","session","store","findTypeURIs","mintClass","mintNew","newPaneOptions","updater","me","uri","Error","newInstance","newBase","newPadDoc","doc","add","rdf","dc","Date","chunk","sioc","Promise","resolve","reject","put","statementsMatching","undefined","uri2","ok","message","render","paneOptions","dom","complainIfBad","div","appendChild","errorMessageBlock","clearElement","ele","firstChild","removeChild","genACLtext","docURI","aclURI","allWrite","g","auth","a","acl","foaf","setACL","callbackFunction","aclDoc","any","fetcher","aclText","webOperation","data","contentType","then","catch","err","load","newInstanceButton","button","createElement","textContent","addEventListener","showBootstrap","spawnArea","thisInstance","container","noun","appDetails","newAppInstance","workspace","initializeNewInstanceInWorkspace","p","baseField","setAttribute","size","autocomplete","_e","value","slice","initializeNewInstanceAtBase","ws","space","split","error","appPathSegment","now","getTime","here","base","newIndexDoc","toBeCopied","local","agenda","f","length","item","fun","copyItem","push","newURI","console","setThatACL","shift","webCopy","checkUser","webId","createNewPadDataFile","PAD","padDoc","_uri2","body","innerHTML","showResults","exists","currentUser","title","vcard","solo","window","document","options","padEle","notepad","naviMain","partipationTarget","meeting","manageParticipation","naviMiddle2","setRefreshHandler","reloadAndSync","loadPadData","nowOrWhenFetched","response","status","holds","wf","naviMiddle3","structure","naviLoginoutTR","naviTop","naviMiddle","naviMiddle1","naviStatus","statusArea","naviSpawn","naviMenu","timingArea"],"sources":["../../src/pad/padPane.ts"],"sourcesContent":["import { icons, ns, pad, widgets, login } from 'solid-ui-jss'\nimport { authn, AppDetails } from 'solid-logic-jss'\nimport { graph, log, NamedNode, Namespace, sym, serialize, Store } from 'rdflib'\nimport { PaneDefinition } from 'pane-registry'\n/*   pad Pane\n **\n */\n\nconst paneDef: PaneDefinition = {\n  // icon:  (module.__dirname || __dirname) + 'images/ColourOn.png',\n  icon: icons.iconBase + 'noun_79217.svg',\n\n  name: 'pad',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve an pad pane?\n  label: function (subject, context) {\n    const t = (context.session.store as Store).findTypeURIs(subject)\n    if (t['http://www.w3.org/ns/pim/pad#Notepad']) {\n      return 'pad'\n    }\n    return null // No under other circumstances\n  },\n\n  mintClass: ns.pad('Notepad'),\n\n  mintNew: function (context, newPaneOptions: any) {\n    const store = context.session.store as Store\n    const updater = store.updater\n    if (newPaneOptions.me && !newPaneOptions.me.uri) {\n      throw new Error('notepad mintNew:  Invalid userid')\n    }\n\n    const newInstance = (newPaneOptions.newInstance =\n      newPaneOptions.newInstance ||\n      store.sym(newPaneOptions.newBase + 'index.ttl#this'))\n    // const newInstance = kb.sym(newBase + 'pad.ttl#thisPad');\n    const newPadDoc = newInstance.doc()\n\n    store.add(newInstance, ns.rdf('type'), ns.pad('Notepad'), newPadDoc)\n    store.add(newInstance, ns.dc('title'), 'Shared Notes', newPadDoc)\n    store.add(newInstance, ns.dc('created'), new Date() as any, newPadDoc) // @@ TODO Remove casting\n    if (newPaneOptions.me) {\n      store.add(newInstance, ns.dc('author'), newPaneOptions.me, newPadDoc)\n    }\n    // kb.add(newInstance, ns.pad('next'), newInstance, newPadDoc);\n    // linked list empty @@\n    const chunk = store.sym(newInstance.uri + '_line0')\n    store.add(newInstance, ns.pad('next'), chunk, newPadDoc) // Linked list has one entry\n    store.add(chunk, ns.pad('next'), newInstance, newPadDoc)\n    store.add(chunk, ns.dc('author'), newPaneOptions.me, newPadDoc)\n    store.add(chunk, ns.sioc('content'), '', newPadDoc)\n\n    return new Promise(function (resolve, reject) {\n      if (!updater) {\n        reject(new Error('Have no updater'))\n        return\n      }\n      updater.put(\n        newPadDoc,\n        store.statementsMatching(undefined, undefined, undefined, newPadDoc),\n        'text/turtle',\n        function (uri2, ok, message) {\n          if (ok) {\n            resolve(newPaneOptions)\n          } else {\n            reject(\n              new Error('FAILED to save new tool at: ' + uri2 + ' : ' + message)\n            )\n          }\n        }\n      )\n    })\n  },\n  // and follow instructions there\n  // @@ TODO Set better type for paneOptions\n  render: function (subject, context, paneOptions: any) {\n    const dom = context.dom\n    const store = context.session.store as Store\n    // Utility functions\n    const complainIfBad = function (ok: boolean, message: string) {\n      if (!ok) {\n        div.appendChild(widgets.errorMessageBlock(dom, message, 'pink'))\n      }\n    }\n\n    const clearElement = function (ele: HTMLElement) {\n      while (ele.firstChild) {\n        ele.removeChild(ele.firstChild)\n      }\n      return ele\n    }\n\n    // Access control\n\n    // Two constiations of ACL for this app, public read and public read/write\n    // In all cases owner has read write control\n    const genACLtext = function (\n      docURI: string,\n      aclURI: string,\n      allWrite: boolean\n    ) {\n      const g = graph()\n      const auth = Namespace('http://www.w3.org/ns/auth/acl#')\n      let a = g.sym(aclURI + '#a1')\n      const acl = g.sym(aclURI)\n      const doc = g.sym(docURI)\n      g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n      g.add(a, auth('accessTo'), doc, acl)\n      g.add(a, auth('agent'), me, acl)\n      g.add(a, auth('mode'), auth('Read'), acl)\n      g.add(a, auth('mode'), auth('Write'), acl)\n      g.add(a, auth('mode'), auth('Control'), acl)\n\n      a = g.sym(aclURI + '#a2')\n      g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n      g.add(a, auth('accessTo'), doc, acl)\n      g.add(a, auth('agentClass'), ns.foaf('Agent'), acl)\n      g.add(a, auth('mode'), auth('Read'), acl)\n      if (allWrite) {\n        g.add(a, auth('mode'), auth('Write'), acl)\n      }\n      // TODO: Figure out why `serialize` isn't on the type definition according to TypeScript:\n      return serialize(acl, g, aclURI, 'text/turtle')\n    }\n\n    /**\n     * @param docURI\n     * @param allWrite\n     * @param callbackFunction\n     *\n     * @returns {Promise<Response>}\n     */\n    const setACL = function setACL (\n      docURI: string,\n      allWrite: boolean,\n      callbackFunction: Function\n    ) {\n      const aclDoc = store.any(\n        sym(docURI),\n        sym('http://www.iana.org/assignments/link-relations/acl')\n      ) as NamedNode // @@ check that this get set by web.js\n      if (!fetcher) {\n        throw new Error('Have no fetcher')\n      }\n      if (aclDoc) {\n        // Great we already know where it is\n        const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n        return fetcher\n          .webOperation('PUT', aclDoc.uri, {\n            data: aclText,\n            contentType: 'text/turtle'\n          })\n          .then(() => callbackFunction(true))\n          .catch(err => {\n            callbackFunction(false, err.message)\n          })\n      } else {\n        return fetcher\n          .load(docURI)\n          .catch((err: Error) => {\n            callbackFunction(false, 'Getting headers for ACL: ' + err)\n          })\n          .then(() => {\n            const aclDoc = store.any(\n              sym(docURI),\n              sym('http://www.iana.org/assignments/link-relations/acl')\n            ) as NamedNode\n\n            if (!aclDoc) {\n              // complainIfBad(false, \"No Link rel=ACL header for \" + docURI);\n              throw new Error('No Link rel=ACL header for ' + docURI)\n            }\n\n            const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n\n            return fetcher.webOperation('PUT', aclDoc.uri, {\n              data: aclText,\n              contentType: 'text/turtle'\n            })\n          })\n          .then(() => callbackFunction(true))\n          .catch(err => {\n            callbackFunction(false, err.message)\n          })\n      }\n    }\n\n    //  Reproduction: spawn a new instance\n    //\n    // Viral growth path: user of app decides to make another instance\n    const newInstanceButton = function () {\n      const button = div.appendChild(dom.createElement('button'))\n      button.textContent = 'Start another pad'\n      button.addEventListener('click', function () {\n        return showBootstrap(subject, spawnArea, 'pad')\n      })\n      return button\n    }\n\n    // Option of either using the workspace system or just typing in a URI\n    const showBootstrap = function showBootstrap (\n      thisInstance: any,\n      container: HTMLElement,\n      noun: string\n    ) {\n      const div = clearElement(container)\n      const appDetails = { noun: 'notepad' } as AppDetails\n      div.appendChild(\n        login.newAppInstance(dom, appDetails, (workspace: string | null, newBase) => {\n          // FIXME: not sure if this will work at all, just\n          // trying to get the types to match - Michiel.\n          return initializeNewInstanceInWorkspace(new NamedNode(workspace || newBase))\n        })\n      )\n\n      div.appendChild(dom.createElement('hr')) // @@\n\n      const p = div.appendChild(dom.createElement('p'))\n      p.textContent =\n        'Where would you like to store the data for the ' +\n        noun +\n        '?  ' +\n        'Give the URL of the directory where you would like the data stored.'\n      const baseField = div.appendChild(dom.createElement('input'))\n      baseField.setAttribute('type', 'text')\n      baseField.size = 80 // really a string\n      ;(baseField as any).label = 'base URL'\n      baseField.autocomplete = 'on'\n\n      div.appendChild(dom.createElement('br')) // @@\n\n      const button = div.appendChild(dom.createElement('button'))\n      button.textContent = 'Start new ' + noun + ' at this URI'\n      button.addEventListener('click', function (_e) {\n        let newBase = baseField.value\n        if (newBase.slice(-1) !== '/') {\n          newBase += '/'\n        }\n        initializeNewInstanceAtBase(thisInstance, newBase)\n      })\n    }\n\n    //  Create new document files for new instance of app\n    const initializeNewInstanceInWorkspace = function (ws: NamedNode) {\n      // @@ TODO Clean up type for newBase\n      let newBase: any = store.any(ws, ns.space('uriPrefix'))\n      if (!newBase) {\n        newBase = ws.uri.split('#')[0]\n      } else {\n        newBase = newBase.value\n      }\n      if (newBase.slice(-1) !== '/') {\n        log.error(appPathSegment + ': No / at end of uriPrefix ' + newBase) // @@ paramater?\n        newBase = newBase + '/'\n      }\n      const now = new Date()\n      newBase += appPathSegment + '/id' + now.getTime() + '/' // unique id\n\n      initializeNewInstanceAtBase(thisInstance, newBase)\n    }\n\n    const initializeNewInstanceAtBase = function (\n      thisInstance: any,\n      newBase: string\n    ) {\n      const here = sym(thisInstance.uri.split('#')[0])\n      const base = here // @@ ???\n\n      const newPadDoc = store.sym(newBase + 'pad.ttl')\n      const newIndexDoc = store.sym(newBase + 'index.html')\n\n      const toBeCopied = [{ local: 'index.html', contentType: 'text/html' }]\n\n      const newInstance = store.sym(newPadDoc.uri + '#thisPad')\n\n      // log.debug(\"\\n Ready to put \" + kb.statementsMatching(undefined, undefined, undefined, there)); //@@\n\n      const agenda: Function[] = []\n\n      let f //   @@ This needs some form of visible progress bar\n      for (f = 0; f < toBeCopied.length; f++) {\n        const item = toBeCopied[f]\n        const fun = function copyItem (item: any) {\n          agenda.push(function () {\n            const newURI = newBase + item.local\n            console.log('Copying ' + base + item.local + ' to ' + newURI)\n\n            const setThatACL = function () {\n              setACL(newURI, false, function (ok: boolean, message: string) {\n                if (!ok) {\n                  complainIfBad(\n                    ok,\n                    'FAILED to set ACL ' + newURI + ' : ' + message\n                  )\n                  console.log('FAILED to set ACL ' + newURI + ' : ' + message)\n                } else {\n                  agenda.shift()!() // beware too much nesting\n                }\n              })\n            }\n            if (!store.fetcher) {\n              throw new Error('Store has no fetcher')\n            }\n            store.fetcher\n              .webCopy(\n                base + item.local,\n                newBase + item.local,\n                item.contentType\n              )\n              .then(() => authn.checkUser())\n              .then(webId => {\n                me = webId\n\n                setThatACL()\n              })\n              .catch(err => {\n                console.log(\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n                complainIfBad(\n                  false,\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n              })\n          })\n        }\n        fun(item)\n      }\n\n      agenda.push(function createNewPadDataFile () {\n        store.add(newInstance, ns.rdf('type'), PAD('Notepad'), newPadDoc)\n\n        // TODO @@ Remove casting of add\n        store.add(\n          newInstance,\n          ns.dc('created'),\n          new Date() as any, // @@ TODO Remove casting\n          newPadDoc\n        )\n        if (me) {\n          store.add(newInstance, ns.dc('author'), me, newPadDoc)\n        }\n        store.add(newInstance, PAD('next'), newInstance, newPadDoc) // linked list empty\n\n        // Keep a paper trail   @@ Revisit when we have non-public ones @@ Privacy\n        store.add(newInstance, ns.space('inspiration'), thisInstance, padDoc)\n        store.add(newInstance, ns.space('inspiration'), thisInstance, newPadDoc)\n        if (!updater) {\n          throw new Error('Have no updater')\n        }\n        updater.put(\n          newPadDoc,\n          store.statementsMatching(undefined, undefined, undefined, newPadDoc),\n          'text/turtle',\n          function (_uri2, ok, message) {\n            if (ok) {\n              agenda.shift()!()\n            } else {\n              complainIfBad(\n                ok,\n                'FAILED to save new notepad at: ' +\n                  newPadDoc.uri +\n                  ' : ' +\n                  message\n              )\n              console.log(\n                'FAILED to save new notepad at: ' +\n                  newPadDoc.uri +\n                  ' : ' +\n                  message\n              )\n            }\n          }\n        )\n      })\n\n      agenda.push(function () {\n        setACL(newPadDoc.uri, true, function (ok: boolean, body: string) {\n          complainIfBad(\n            ok,\n            'Failed to set Read-Write ACL on pad data file: ' + body\n          )\n          if (ok) agenda.shift()!()\n        })\n      })\n\n      agenda.push(function () {\n        // give the user links to the new app\n\n        const p = div.appendChild(dom.createElement('p'))\n        p.setAttribute('style', 'font-size: 140%;')\n        p.innerHTML =\n          'Your <a href=\\'' +\n          newIndexDoc.uri +\n          '\\'><b>new notepad</b></a> is ready. ' +\n          '<br/><br/><a href=\\'' +\n          newIndexDoc.uri +\n          '\\'>Go to new pad</a>'\n      })\n\n      agenda.shift()!()\n      // Created new data files.\n    }\n\n    //  Update on incoming changes\n    const showResults = function (exists: boolean) {\n      console.log('showResults()')\n\n      me = authn.currentUser()\n\n      authn.checkUser().then((webId: unknown) => {\n        me = webId as string\n      })\n\n      const title =\n        store.any(subject, ns.dc('title')) || store.any(subject, ns.vcard('fn'))\n      if (paneOptions.solo && typeof window !== 'undefined' && title) {\n        window.document.title = title.value\n      }\n      options.exists = exists\n      padEle = pad.notepad(dom, padDoc, subject, me, options)\n      naviMain.appendChild(padEle)\n\n      const partipationTarget =\n        store.any(subject, ns.meeting('parentMeeting')) || subject\n      pad.manageParticipation(\n        dom,\n        naviMiddle2,\n        padDoc,\n        partipationTarget as any,\n        me,\n        options\n      )\n      if (!store.updater) {\n        throw new Error('Store has no updater')\n      }\n\n      store.updater.setRefreshHandler(padDoc, padEle.reloadAndSync) // initiated =\n    }\n\n    // Read or create empty data file\n    const loadPadData = function () {\n      if (!fetcher) {\n        throw new Error('Have no fetcher')\n      }\n      fetcher.nowOrWhenFetched(padDoc.uri, undefined, function (\n        ok: boolean,\n        body: string,\n        response: any\n      ) {\n        if (!ok) {\n          if (response.status === 404) {\n            // /  Check explicitly for 404 error\n            console.log('Initializing results file ' + padDoc)\n            if (!updater) {\n              throw new Error('Have no updater')\n            }\n            updater.put(padDoc, [], 'text/turtle', function (\n              _uri2,\n              ok,\n              message\n            ) {\n              if (ok) {\n                clearElement(naviMain)\n                showResults(false)\n              } else {\n                complainIfBad(\n                  ok,\n                  'FAILED to create results file at: ' +\n                    padDoc.uri +\n                    ' : ' +\n                    message\n                )\n                console.log(\n                  'FAILED to craete results file at: ' +\n                    padDoc.uri +\n                    ' : ' +\n                    message\n                )\n              }\n            })\n          } else {\n            // Other error, not 404 -- do not try to overwite the file\n            complainIfBad(ok, 'FAILED to read results file: ' + body)\n          }\n        } else {\n          // Happy read\n          clearElement(naviMain)\n          if (store.holds(subject, ns.rdf('type'), ns.wf('TemplateInstance'))) {\n            showBootstrap(subject, naviMain, 'pad')\n          }\n          showResults(true)\n          naviMiddle3.appendChild(newInstanceButton())\n        }\n      })\n    }\n\n    //  Body of Pane\n    const appPathSegment = 'app-pad.timbl.com' // how to allocate this string and connect to\n\n    const fetcher = store.fetcher\n    const updater = store.updater\n    let me: any\n\n    const PAD = Namespace('http://www.w3.org/ns/pim/pad#')\n\n    const thisInstance = subject\n    const padDoc = subject.doc()\n\n    let padEle\n\n    const div = dom.createElement('div')\n\n    //  Build the DOM\n    const structure = div.appendChild(dom.createElement('table')) // @@ make responsive style\n    structure.setAttribute(\n      'style',\n      'background-color: white; min-width: 94%; margin-right:3% margin-left: 3%; min-height: 13em;'\n    )\n\n    const naviLoginoutTR = structure.appendChild(dom.createElement('tr'))\n    naviLoginoutTR.appendChild(dom.createElement('td')) // naviLoginout1\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n\n    const naviTop = structure.appendChild(dom.createElement('tr')) // stuff\n    const naviMain = naviTop.appendChild(dom.createElement('td'))\n    naviMain.setAttribute('colspan', '3')\n\n    const naviMiddle = structure.appendChild(dom.createElement('tr')) // controls\n    const naviMiddle1 = naviMiddle.appendChild(dom.createElement('td'))\n    const naviMiddle2 = naviMiddle.appendChild(dom.createElement('td'))\n    const naviMiddle3 = naviMiddle.appendChild(dom.createElement('td'))\n\n    const naviStatus = structure.appendChild(dom.createElement('tr')) // status etc\n    const statusArea = naviStatus.appendChild(dom.createElement('div'))\n\n    const naviSpawn = structure.appendChild(dom.createElement('tr')) // create new\n    const spawnArea = naviSpawn.appendChild(dom.createElement('div'))\n\n    const naviMenu = structure.appendChild(dom.createElement('tr'))\n    naviMenu.setAttribute('class', 'naviMenu')\n    // naviMenu.setAttribute('style', 'margin-top: 3em;');\n    naviMenu.appendChild(dom.createElement('td')) // naviLeft\n    naviMenu.appendChild(dom.createElement('td'))\n    naviMenu.appendChild(dom.createElement('td'))\n\n    const options: any = { statusArea, timingArea: naviMiddle1 }\n\n    loadPadData()\n\n    return div\n  }\n}\n// ends\n\nexport default paneDef\n"],"mappings":"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","ignoreList":[]}
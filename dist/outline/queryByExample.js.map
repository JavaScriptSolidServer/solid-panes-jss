{"version":3,"file":"queryByExample.js","names":["store","UI","$rdf","optionalSubqueriesIndex","predParentOf","node","n","getAttribute","previousSibling","nodeName","console","log","makeQueryRow","q","tr","constraint","inverse","AJAR_inverse","parentVar","level","pat","makeRDFStatement","freeVar","parent","Statement","st","predicate","optionalSubqueryIndex","parentNode","AJAR_statement","setAttribute","AJAR_variable","predLevel","predtr","opt","removeAttribute","optForm","formula","push","length","optional","constraintVar","subject","object","hasParent","isBlank","window","alert","v","variable","utils","newVariableName","vars","label","predicateLabelForXML","pattern","slice","toUpperCase","ConstraintEqualTo","value","describe","varstr","toNT","test","term","sameTerm","constraints","info","AJAR_pattern","debug","statements","saveQuery","selection","qs","Query","i","sel","indexOf","addQuery","resetOutliner","x","viewAndSaveQuery","outline","document","location","listeners","getActiveView","view","drawQuery","updateQueryControls","QuerySource","queries","name","id","removeQuery","addListener","listener","removeListener"],"sources":["../../src/outline/queryByExample.js"],"sourcesContent":["/* istanbul ignore file */\n// The query-by-example functionality in the tabulator\n// was the ability to expore a bit of the web in outline mode,\n// select a ceratain set of fields in the tree,\n// then pres \"find all\" which would then generte a SPARQL query\n// to find all other places which had the same pattern.\n// Fields could be optional by pressing th ewhite optoional button\n\nimport { store } from 'solid-logic-jss'\nimport * as UI from 'solid-ui-jss'\nimport * as $rdf from 'rdflib'\n\nconst optionalSubqueriesIndex = []\n\nfunction predParentOf (node) {\n  let n = node\n  while (true) {\n    if (n.getAttribute('predTR')) {\n      return n\n    } else if (n.previousSibling && n.previousSibling.nodeName === 'TR') {\n      n = n.previousSibling\n    } else {\n      console.log('Could not find predParent')\n      return node\n    }\n  }\n}\n\nexport function makeQueryRow (q, tr, constraint) {\n  // predtr = predParentOf(tr)\n  // var nodes = tr.childNodes\n  // var n = tr.childNodes.length\n  const inverse = tr.AJAR_inverse\n  // var hasVar = 0\n  let parentVar, level, pat\n\n  function makeRDFStatement (freeVar, parent) {\n    if (inverse) {\n      return new $rdf.Statement(freeVar, st.predicate, parent)\n    } else {\n      return new $rdf.Statement(parent, st.predicate, freeVar)\n    }\n  }\n\n  let optionalSubqueryIndex = null\n\n  for (level = tr.parentNode; level; level = level.parentNode) {\n    if (typeof level.AJAR_statement !== 'undefined') {\n      // level.AJAR_statement\n      level.setAttribute('bla', level.AJAR_statement) // @@? -timbl\n      // UI.log.debug(\"Parent TR statement=\"+level.AJAR_statement + \", var=\" + level.AJAR_variable)\n      /* for(let c=0;c<level.parentNode.childNodes.length;c++) //This makes sure the same variable is used for a subject\n      if(level.parentNode.childNodes[c].AJAR_variable)\n        level.AJAR_variable = level.parentNode.childNodes[c].AJAR_variable; */\n      if (!level.AJAR_variable) {\n        makeQueryRow(q, level)\n      }\n      parentVar = level.AJAR_variable\n      const predLevel = predParentOf(level)\n      if (predLevel.getAttribute('optionalSubqueriesIndex')) {\n        optionalSubqueryIndex = predLevel.getAttribute(\n          'optionalSubqueriesIndex'\n        )\n        pat = optionalSubqueriesIndex[optionalSubqueryIndex]\n      }\n      break\n    }\n  }\n\n  if (!pat) {\n    pat = q.pat\n  }\n\n  const predtr = predParentOf(tr)\n  // /////OPTIONAL KLUDGE///////////\n  const opt = predtr.getAttribute('optional')\n  if (!opt) {\n    if (optionalSubqueryIndex) {\n      predtr.setAttribute('optionalSubqueriesIndex', optionalSubqueryIndex)\n    } else {\n      predtr.removeAttribute('optionalSubqueriesIndex')\n    }\n  }\n  if (opt) {\n    const optForm = store.formula()\n    optionalSubqueriesIndex.push(optForm)\n    predtr.setAttribute(\n      'optionalSubqueriesIndex',\n      optionalSubqueriesIndex.length - 1\n    )\n    pat.optional.push(optForm)\n    pat = optForm\n  }\n\n  // //////////////////////////////\n\n  const st = tr.AJAR_statement\n\n  const constraintVar = tr.AJAR_inverse ? st.subject : st.object // this is only used for constraints\n  let hasParent = true\n  if (constraintVar.isBlank && constraint) {\n    window.alert(\n      'You cannot constrain a query with a blank node. No constraint will be added.'\n    )\n  }\n  if (!parentVar) {\n    hasParent = false\n    parentVar = inverse ? st.object : st.subject // if there is no parents, uses the sub/obj\n  }\n  // UI.log.debug('Initial variable: '+tr.AJAR_variable)\n  const v = tr.AJAR_variable\n    ? tr.AJAR_variable\n    : store.variable(UI.utils.newVariableName())\n  q.vars.push(v)\n  v.label = hasParent ? parentVar.label : UI.utils.label(parentVar)\n  v.label += ' ' + UI.utils.predicateLabelForXML(st.predicate, inverse)\n  const pattern = makeRDFStatement(v, parentVar)\n  // alert(pattern)\n  v.label = v.label.slice(0, 1).toUpperCase() + v.label.slice(1) // init cap\n\n  // See ../rdf/sparql.js\n  // This should only work on literals but doesn't.\n  function ConstraintEqualTo (value) {\n    this.describe = function (varstr) {\n      return varstr + ' = ' + value.toNT()\n    }\n    this.test = function (term) {\n      return value.sameTerm(term)\n    }\n    return this\n  }\n\n  if (constraint) {\n    // binds the constrained variable to its selected value\n    pat.constraints[v] = new ConstraintEqualTo(constraintVar)\n  }\n  UI.log.info('Pattern: ' + pattern)\n  pattern.tr = tr\n  tr.AJAR_pattern = pattern // Cross-link UI and query line\n  tr.AJAR_variable = v\n  // UI.log.debug('Final variable: '+tr.AJAR_variable)\n  UI.log.debug('Query pattern: ' + pattern)\n  pat.statements.push(pattern)\n  return v\n} // makeQueryRow\n\nfunction saveQuery (selection, qs) {\n  // var qs = outline.qs // @@\n  const q = new $rdf.Query()\n  const n = selection.length\n  let i, sel, st, tr\n  for (i = 0; i < n; i++) {\n    sel = selection[i]\n    tr = sel.parentNode\n    st = tr.AJAR_statement\n    UI.log.debug('Statement ' + st)\n    if (sel.getAttribute('class').indexOf('pred') >= 0) {\n      UI.log.info('   We have a predicate')\n      makeQueryRow(q, tr)\n    }\n    if (sel.getAttribute('class').indexOf('obj') >= 0) {\n      UI.log.info('   We have an object')\n      makeQueryRow(q, tr, true)\n    }\n  }\n  qs.addQuery(q)\n\n  function resetOutliner (pat) {\n    const n = pat.statements.length\n    let pattern, tr\n    for (let i = 0; i < n; i++) {\n      pattern = pat.statements[i]\n      tr = pattern.tr\n      // UI.log.debug('tr: ' + tr.AJAR_statement);\n      if (typeof tr !== 'undefined') {\n        tr.AJAR_pattern = null // TODO: is this == to whats in current version?\n        tr.AJAR_variable = null\n      }\n    }\n    for (const x in pat.optional) {\n      resetOutliner(pat.optional[x])\n    }\n  }\n  resetOutliner(q.pat)\n  // NextVariable=0;\n  return q\n} // saveQuery\n\n// When the user asks for all list of all matching parts of the data\n//\nexport function viewAndSaveQuery (outline, selection) {\n  const qs = outline.qs\n  UI.log.info('outline.doucment is now ' + outline.document.location)\n  const q = saveQuery(selection, qs)\n  /*\n  if (tabulator.isExtension) {\n    // tabulator.drawInBestView(q)\n  } else\n  */\n\n  for (let i = 0; i < qs.listeners.length; i++) {\n    qs.listeners[i].getActiveView().view.drawQuery(q)\n    qs.listeners[i].updateQueryControls(qs.listeners[i].getActiveView())\n  }\n}\n\n/**\n * The QuerySource object stores a set of listeners and a set of queries.\n * It keeps the listeners aware of those queries that the source currently\n * contains, and it is then up to the listeners to decide what to do with\n * those queries in terms of displays.\n * Not used 2010-08 -- TimBL\n * @class QuerySource\n * @author jambo\n */\n\nexport function QuerySource () {\n  /**\n   * stores all of the queries currently held by this source,\n   * indexed by ID number.\n   */\n  this.queries = []\n  /**\n   * stores the listeners for a query object.\n   * @see TabbedContainer\n   */\n  this.listeners = []\n\n  /**\n   * add a Query object to the query source--It will be given an ID number\n   * and a name, if it doesn't already have one. This subsequently adds the\n   * query to all of the listeners the QuerySource knows about.\n   */\n  this.addQuery = function (q) {\n    let i\n    if (q.name === null || q.name === '') {\n      q.name = 'Query #' + (this.queries.length + 1)\n    }\n    q.id = this.queries.length\n    this.queries.push(q)\n    for (i = 0; i < this.listeners.length; i++) {\n      if (this.listeners[i] !== null) {\n        this.listeners[i].addQuery(q)\n      }\n    }\n  }\n\n  /**\n   * Remove a Query object from the source.  Tells all listeners to also\n   * remove the query.\n   */\n  this.removeQuery = function (q) {\n    let i\n    for (i = 0; i < this.listeners.length; i++) {\n      if (this.listeners[i] !== null) {\n        this.listeners[i].removeQuery(q)\n      }\n    }\n    if (this.queries[q.id] !== null) {\n      delete this.queries[q.id]\n    }\n  }\n\n  /**\n   * adds a \"Listener\" to this QuerySource - that is, an object\n   * which is capable of both adding and removing queries.\n   * Currently, only the TabbedContainer class is added.\n   * also puts all current queries into the listener to be used.\n   */\n  this.addListener = function (listener) {\n    let i\n    this.listeners.push(listener)\n    for (i = 0; i < this.queries.length; i++) {\n      if (this.queries[i] !== null) {\n        listener.addQuery(this.queries[i])\n      }\n    }\n  }\n  /**\n   * removes listener from the array of listeners, if it exists! Also takes\n   * all of the queries from this source out of the listener.\n   */\n  this.removeListener = function (listener) {\n    let i\n    for (i = 0; i < this.queries.length; i++) {\n      if (this.queries[i] !== null) {\n        listener.removeQuery(this.queries[i])\n      }\n    }\n\n    for (i = 0; i < this.listeners.length; i++) {\n      if (this.listeners[i] === listener) {\n        delete this.listeners[i]\n      }\n    }\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASA,KAAK,QAAQ,iBAAiB;AACvC,OAAO,KAAKC,EAAE,MAAM,cAAc;AAClC,OAAO,KAAKC,IAAI,MAAM,QAAQ;AAE9B,MAAMC,uBAAuB,GAAG,EAAE;AAElC,SAASC,YAAYA,CAAEC,IAAI,EAAE;EAC3B,IAAIC,CAAC,GAAGD,IAAI;EACZ,OAAO,IAAI,EAAE;IACX,IAAIC,CAAC,CAACC,YAAY,CAAC,QAAQ,CAAC,EAAE;MAC5B,OAAOD,CAAC;IACV,CAAC,MAAM,IAAIA,CAAC,CAACE,eAAe,IAAIF,CAAC,CAACE,eAAe,CAACC,QAAQ,KAAK,IAAI,EAAE;MACnEH,CAAC,GAAGA,CAAC,CAACE,eAAe;IACvB,CAAC,MAAM;MACLE,OAAO,CAACC,GAAG,CAAC,2BAA2B,CAAC;MACxC,OAAON,IAAI;IACb;EACF;AACF;AAEA,OAAO,SAASO,YAAYA,CAAEC,CAAC,EAAEC,EAAE,EAAEC,UAAU,EAAE;EAC/C;EACA;EACA;EACA,MAAMC,OAAO,GAAGF,EAAE,CAACG,YAAY;EAC/B;EACA,IAAIC,SAAS,EAAEC,KAAK,EAAEC,GAAG;EAEzB,SAASC,gBAAgBA,CAAEC,OAAO,EAAEC,MAAM,EAAE;IAC1C,IAAIP,OAAO,EAAE;MACX,OAAO,IAAId,IAAI,CAACsB,SAAS,CAACF,OAAO,EAAEG,EAAE,CAACC,SAAS,EAAEH,MAAM,CAAC;IAC1D,CAAC,MAAM;MACL,OAAO,IAAIrB,IAAI,CAACsB,SAAS,CAACD,MAAM,EAAEE,EAAE,CAACC,SAAS,EAAEJ,OAAO,CAAC;IAC1D;EACF;EAEA,IAAIK,qBAAqB,GAAG,IAAI;EAEhC,KAAKR,KAAK,GAAGL,EAAE,CAACc,UAAU,EAAET,KAAK,EAAEA,KAAK,GAAGA,KAAK,CAACS,UAAU,EAAE;IAC3D,IAAI,OAAOT,KAAK,CAACU,cAAc,KAAK,WAAW,EAAE;MAC/C;MACAV,KAAK,CAACW,YAAY,CAAC,KAAK,EAAEX,KAAK,CAACU,cAAc,CAAC,EAAC;MAChD;MACA;AACN;AACA;MACM,IAAI,CAACV,KAAK,CAACY,aAAa,EAAE;QACxBnB,YAAY,CAACC,CAAC,EAAEM,KAAK,CAAC;MACxB;MACAD,SAAS,GAAGC,KAAK,CAACY,aAAa;MAC/B,MAAMC,SAAS,GAAG5B,YAAY,CAACe,KAAK,CAAC;MACrC,IAAIa,SAAS,CAACzB,YAAY,CAAC,yBAAyB,CAAC,EAAE;QACrDoB,qBAAqB,GAAGK,SAAS,CAACzB,YAAY,CAC5C,yBACF,CAAC;QACDa,GAAG,GAAGjB,uBAAuB,CAACwB,qBAAqB,CAAC;MACtD;MACA;IACF;EACF;EAEA,IAAI,CAACP,GAAG,EAAE;IACRA,GAAG,GAAGP,CAAC,CAACO,GAAG;EACb;EAEA,MAAMa,MAAM,GAAG7B,YAAY,CAACU,EAAE,CAAC;EAC/B;EACA,MAAMoB,GAAG,GAAGD,MAAM,CAAC1B,YAAY,CAAC,UAAU,CAAC;EAC3C,IAAI,CAAC2B,GAAG,EAAE;IACR,IAAIP,qBAAqB,EAAE;MACzBM,MAAM,CAACH,YAAY,CAAC,yBAAyB,EAAEH,qBAAqB,CAAC;IACvE,CAAC,MAAM;MACLM,MAAM,CAACE,eAAe,CAAC,yBAAyB,CAAC;IACnD;EACF;EACA,IAAID,GAAG,EAAE;IACP,MAAME,OAAO,GAAGpC,KAAK,CAACqC,OAAO,CAAC,CAAC;IAC/BlC,uBAAuB,CAACmC,IAAI,CAACF,OAAO,CAAC;IACrCH,MAAM,CAACH,YAAY,CACjB,yBAAyB,EACzB3B,uBAAuB,CAACoC,MAAM,GAAG,CACnC,CAAC;IACDnB,GAAG,CAACoB,QAAQ,CAACF,IAAI,CAACF,OAAO,CAAC;IAC1BhB,GAAG,GAAGgB,OAAO;EACf;;EAEA;;EAEA,MAAMX,EAAE,GAAGX,EAAE,CAACe,cAAc;EAE5B,MAAMY,aAAa,GAAG3B,EAAE,CAACG,YAAY,GAAGQ,EAAE,CAACiB,OAAO,GAAGjB,EAAE,CAACkB,MAAM,EAAC;EAC/D,IAAIC,SAAS,GAAG,IAAI;EACpB,IAAIH,aAAa,CAACI,OAAO,IAAI9B,UAAU,EAAE;IACvC+B,MAAM,CAACC,KAAK,CACV,8EACF,CAAC;EACH;EACA,IAAI,CAAC7B,SAAS,EAAE;IACd0B,SAAS,GAAG,KAAK;IACjB1B,SAAS,GAAGF,OAAO,GAAGS,EAAE,CAACkB,MAAM,GAAGlB,EAAE,CAACiB,OAAO,EAAC;EAC/C;EACA;EACA,MAAMM,CAAC,GAAGlC,EAAE,CAACiB,aAAa,GACtBjB,EAAE,CAACiB,aAAa,GAChB/B,KAAK,CAACiD,QAAQ,CAAChD,EAAE,CAACiD,KAAK,CAACC,eAAe,CAAC,CAAC,CAAC;EAC9CtC,CAAC,CAACuC,IAAI,CAACd,IAAI,CAACU,CAAC,CAAC;EACdA,CAAC,CAACK,KAAK,GAAGT,SAAS,GAAG1B,SAAS,CAACmC,KAAK,GAAGpD,EAAE,CAACiD,KAAK,CAACG,KAAK,CAACnC,SAAS,CAAC;EACjE8B,CAAC,CAACK,KAAK,IAAI,GAAG,GAAGpD,EAAE,CAACiD,KAAK,CAACI,oBAAoB,CAAC7B,EAAE,CAACC,SAAS,EAAEV,OAAO,CAAC;EACrE,MAAMuC,OAAO,GAAGlC,gBAAgB,CAAC2B,CAAC,EAAE9B,SAAS,CAAC;EAC9C;EACA8B,CAAC,CAACK,KAAK,GAAGL,CAAC,CAACK,KAAK,CAACG,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,GAAGT,CAAC,CAACK,KAAK,CAACG,KAAK,CAAC,CAAC,CAAC,EAAC;;EAE/D;EACA;EACA,SAASE,iBAAiBA,CAAEC,KAAK,EAAE;IACjC,IAAI,CAACC,QAAQ,GAAG,UAAUC,MAAM,EAAE;MAChC,OAAOA,MAAM,GAAG,KAAK,GAAGF,KAAK,CAACG,IAAI,CAAC,CAAC;IACtC,CAAC;IACD,IAAI,CAACC,IAAI,GAAG,UAAUC,IAAI,EAAE;MAC1B,OAAOL,KAAK,CAACM,QAAQ,CAACD,IAAI,CAAC;IAC7B,CAAC;IACD,OAAO,IAAI;EACb;EAEA,IAAIjD,UAAU,EAAE;IACd;IACAK,GAAG,CAAC8C,WAAW,CAAClB,CAAC,CAAC,GAAG,IAAIU,iBAAiB,CAACjB,aAAa,CAAC;EAC3D;EACAxC,EAAE,CAACU,GAAG,CAACwD,IAAI,CAAC,WAAW,GAAGZ,OAAO,CAAC;EAClCA,OAAO,CAACzC,EAAE,GAAGA,EAAE;EACfA,EAAE,CAACsD,YAAY,GAAGb,OAAO,EAAC;EAC1BzC,EAAE,CAACiB,aAAa,GAAGiB,CAAC;EACpB;EACA/C,EAAE,CAACU,GAAG,CAAC0D,KAAK,CAAC,iBAAiB,GAAGd,OAAO,CAAC;EACzCnC,GAAG,CAACkD,UAAU,CAAChC,IAAI,CAACiB,OAAO,CAAC;EAC5B,OAAOP,CAAC;AACV,CAAC,CAAC;;AAEF,SAASuB,SAASA,CAAEC,SAAS,EAAEC,EAAE,EAAE;EACjC;EACA,MAAM5D,CAAC,GAAG,IAAIX,IAAI,CAACwE,KAAK,CAAC,CAAC;EAC1B,MAAMpE,CAAC,GAAGkE,SAAS,CAACjC,MAAM;EAC1B,IAAIoC,CAAC,EAAEC,GAAG,EAAEnD,EAAE,EAAEX,EAAE;EAClB,KAAK6D,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGrE,CAAC,EAAEqE,CAAC,EAAE,EAAE;IACtBC,GAAG,GAAGJ,SAAS,CAACG,CAAC,CAAC;IAClB7D,EAAE,GAAG8D,GAAG,CAAChD,UAAU;IACnBH,EAAE,GAAGX,EAAE,CAACe,cAAc;IACtB5B,EAAE,CAACU,GAAG,CAAC0D,KAAK,CAAC,YAAY,GAAG5C,EAAE,CAAC;IAC/B,IAAImD,GAAG,CAACrE,YAAY,CAAC,OAAO,CAAC,CAACsE,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;MAClD5E,EAAE,CAACU,GAAG,CAACwD,IAAI,CAAC,wBAAwB,CAAC;MACrCvD,YAAY,CAACC,CAAC,EAAEC,EAAE,CAAC;IACrB;IACA,IAAI8D,GAAG,CAACrE,YAAY,CAAC,OAAO,CAAC,CAACsE,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;MACjD5E,EAAE,CAACU,GAAG,CAACwD,IAAI,CAAC,sBAAsB,CAAC;MACnCvD,YAAY,CAACC,CAAC,EAAEC,EAAE,EAAE,IAAI,CAAC;IAC3B;EACF;EACA2D,EAAE,CAACK,QAAQ,CAACjE,CAAC,CAAC;EAEd,SAASkE,aAAaA,CAAE3D,GAAG,EAAE;IAC3B,MAAMd,CAAC,GAAGc,GAAG,CAACkD,UAAU,CAAC/B,MAAM;IAC/B,IAAIgB,OAAO,EAAEzC,EAAE;IACf,KAAK,IAAI6D,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGrE,CAAC,EAAEqE,CAAC,EAAE,EAAE;MAC1BpB,OAAO,GAAGnC,GAAG,CAACkD,UAAU,CAACK,CAAC,CAAC;MAC3B7D,EAAE,GAAGyC,OAAO,CAACzC,EAAE;MACf;MACA,IAAI,OAAOA,EAAE,KAAK,WAAW,EAAE;QAC7BA,EAAE,CAACsD,YAAY,GAAG,IAAI,EAAC;QACvBtD,EAAE,CAACiB,aAAa,GAAG,IAAI;MACzB;IACF;IACA,KAAK,MAAMiD,CAAC,IAAI5D,GAAG,CAACoB,QAAQ,EAAE;MAC5BuC,aAAa,CAAC3D,GAAG,CAACoB,QAAQ,CAACwC,CAAC,CAAC,CAAC;IAChC;EACF;EACAD,aAAa,CAAClE,CAAC,CAACO,GAAG,CAAC;EACpB;EACA,OAAOP,CAAC;AACV,CAAC,CAAC;;AAEF;AACA;AACA,OAAO,SAASoE,gBAAgBA,CAAEC,OAAO,EAAEV,SAAS,EAAE;EACpD,MAAMC,EAAE,GAAGS,OAAO,CAACT,EAAE;EACrBxE,EAAE,CAACU,GAAG,CAACwD,IAAI,CAAC,0BAA0B,GAAGe,OAAO,CAACC,QAAQ,CAACC,QAAQ,CAAC;EACnE,MAAMvE,CAAC,GAAG0D,SAAS,CAACC,SAAS,EAAEC,EAAE,CAAC;EAClC;AACF;AACA;AACA;AACA;;EAEE,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,EAAE,CAACY,SAAS,CAAC9C,MAAM,EAAEoC,CAAC,EAAE,EAAE;IAC5CF,EAAE,CAACY,SAAS,CAACV,CAAC,CAAC,CAACW,aAAa,CAAC,CAAC,CAACC,IAAI,CAACC,SAAS,CAAC3E,CAAC,CAAC;IACjD4D,EAAE,CAACY,SAAS,CAACV,CAAC,CAAC,CAACc,mBAAmB,CAAChB,EAAE,CAACY,SAAS,CAACV,CAAC,CAAC,CAACW,aAAa,CAAC,CAAC,CAAC;EACtE;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,SAASI,WAAWA,CAAA,EAAI;EAC7B;AACF;AACA;AACA;EACE,IAAI,CAACC,OAAO,GAAG,EAAE;EACjB;AACF;AACA;AACA;EACE,IAAI,CAACN,SAAS,GAAG,EAAE;;EAEnB;AACF;AACA;AACA;AACA;EACE,IAAI,CAACP,QAAQ,GAAG,UAAUjE,CAAC,EAAE;IAC3B,IAAI8D,CAAC;IACL,IAAI9D,CAAC,CAAC+E,IAAI,KAAK,IAAI,IAAI/E,CAAC,CAAC+E,IAAI,KAAK,EAAE,EAAE;MACpC/E,CAAC,CAAC+E,IAAI,GAAG,SAAS,IAAI,IAAI,CAACD,OAAO,CAACpD,MAAM,GAAG,CAAC,CAAC;IAChD;IACA1B,CAAC,CAACgF,EAAE,GAAG,IAAI,CAACF,OAAO,CAACpD,MAAM;IAC1B,IAAI,CAACoD,OAAO,CAACrD,IAAI,CAACzB,CAAC,CAAC;IACpB,KAAK8D,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACU,SAAS,CAAC9C,MAAM,EAAEoC,CAAC,EAAE,EAAE;MAC1C,IAAI,IAAI,CAACU,SAAS,CAACV,CAAC,CAAC,KAAK,IAAI,EAAE;QAC9B,IAAI,CAACU,SAAS,CAACV,CAAC,CAAC,CAACG,QAAQ,CAACjE,CAAC,CAAC;MAC/B;IACF;EACF,CAAC;;EAED;AACF;AACA;AACA;EACE,IAAI,CAACiF,WAAW,GAAG,UAAUjF,CAAC,EAAE;IAC9B,IAAI8D,CAAC;IACL,KAAKA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACU,SAAS,CAAC9C,MAAM,EAAEoC,CAAC,EAAE,EAAE;MAC1C,IAAI,IAAI,CAACU,SAAS,CAACV,CAAC,CAAC,KAAK,IAAI,EAAE;QAC9B,IAAI,CAACU,SAAS,CAACV,CAAC,CAAC,CAACmB,WAAW,CAACjF,CAAC,CAAC;MAClC;IACF;IACA,IAAI,IAAI,CAAC8E,OAAO,CAAC9E,CAAC,CAACgF,EAAE,CAAC,KAAK,IAAI,EAAE;MAC/B,OAAO,IAAI,CAACF,OAAO,CAAC9E,CAAC,CAACgF,EAAE,CAAC;IAC3B;EACF,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;EACE,IAAI,CAACE,WAAW,GAAG,UAAUC,QAAQ,EAAE;IACrC,IAAIrB,CAAC;IACL,IAAI,CAACU,SAAS,CAAC/C,IAAI,CAAC0D,QAAQ,CAAC;IAC7B,KAAKrB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACgB,OAAO,CAACpD,MAAM,EAAEoC,CAAC,EAAE,EAAE;MACxC,IAAI,IAAI,CAACgB,OAAO,CAAChB,CAAC,CAAC,KAAK,IAAI,EAAE;QAC5BqB,QAAQ,CAAClB,QAAQ,CAAC,IAAI,CAACa,OAAO,CAAChB,CAAC,CAAC,CAAC;MACpC;IACF;EACF,CAAC;EACD;AACF;AACA;AACA;EACE,IAAI,CAACsB,cAAc,GAAG,UAAUD,QAAQ,EAAE;IACxC,IAAIrB,CAAC;IACL,KAAKA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACgB,OAAO,CAACpD,MAAM,EAAEoC,CAAC,EAAE,EAAE;MACxC,IAAI,IAAI,CAACgB,OAAO,CAAChB,CAAC,CAAC,KAAK,IAAI,EAAE;QAC5BqB,QAAQ,CAACF,WAAW,CAAC,IAAI,CAACH,OAAO,CAAChB,CAAC,CAAC,CAAC;MACvC;IACF;IAEA,KAAKA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACU,SAAS,CAAC9C,MAAM,EAAEoC,CAAC,EAAE,EAAE;MAC1C,IAAI,IAAI,CAACU,SAAS,CAACV,CAAC,CAAC,KAAKqB,QAAQ,EAAE;QAClC,OAAO,IAAI,CAACX,SAAS,CAACV,CAAC,CAAC;MAC1B;IACF;EACF,CAAC;AACH","ignoreList":[]}
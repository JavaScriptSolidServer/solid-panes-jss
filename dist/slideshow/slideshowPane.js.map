{"version":3,"file":"slideshowPane.js","names":["UI","makeBSS","ns","slideshowPane","icon","icons","iconBase","name","audience","solid","label","subject","context","store","session","t","findTypeURIs","ldp","uri","contents","each","count","forEach","file","widgets","isImage","render","dom","styleSheet","addStyleSheet","div","createElement","setAttribute","predicate","images","sort","i","length","figure","appendChild","img","fetcher","_fetch","then","response","blob","myBlob","objectURL","URL","createObjectURL","options","setTimeout"],"sources":["../../src/slideshow/slideshowPane.js"],"sourcesContent":["/*   slideshow Pane\n **\n */\nimport * as UI from 'solid-ui-jss'\n\nimport makeBSS from '@solid/better-simple-slideshow'\nconst ns = UI.ns\n\nexport const slideshowPane = {\n  icon: UI.icons.iconBase + 'noun_138712.svg',\n\n  name: 'slideshow',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve an slideshow pane?\n  label: function (subject, context) {\n    const store = context.session.store\n    const ns = UI.ns\n    const t = store.findTypeURIs(subject)\n    if (t[ns.ldp('Container').uri] || t[ns.ldp('BasicContainer').uri]) {\n      const contents = store.each(subject, ns.ldp('contains'))\n      let count = 0\n      contents.forEach(function (file) {\n        if (UI.widgets.isImage(file)) count++\n      })\n      return count > 0 ? 'Slideshow' : null\n    }\n    return null\n  },\n\n  // See https://github.com/leemark/better-simple-slideshow\n  // and follow instructions there\n  render: function (subject, context) {\n    const dom = context.dom\n    const styleSheet =\n      'https://leemark.github.io/better-simple-slideshow/css/simple-slideshow-styles.css'\n    UI.widgets.addStyleSheet(dom, styleSheet)\n\n    const store = context.session.store\n    const ns = UI.ns\n    const div = dom.createElement('div')\n    div.setAttribute('class', 'bss-slides')\n\n    const t = store.findTypeURIs(subject)\n    let predicate\n    if (t[ns.ldp('BasicContainer').uri] || t[ns.ldp('Container').uri]) {\n      predicate = ns.ldp('contains')\n    }\n    const images = store.each(subject, predicate) // @@ random order?\n    // @@ Ideally: sort by embedded time of image\n    images.sort() // Sort for now by URI\n    for (let i = 0; i < images.length; i++) {\n      if (!UI.widgets.isImage(images[i])) continue\n      const figure = div.appendChild(dom.createElement('figure'))\n      const img = figure.appendChild(dom.createElement('img'))\n\n      // get image with authenticated fetch\n      store.fetcher._fetch(images[i].uri)\n        .then(function (response) {\n          return response.blob()\n        })\n        .then(function (myBlob) {\n          const objectURL = URL.createObjectURL(myBlob)\n          img.setAttribute('src', objectURL) // w640 h480 //\n        })\n      img.setAttribute('width', '100%')\n      figure.appendChild(dom.createElement('figcaption'))\n    }\n    const options = { dom }\n\n    setTimeout(function () {\n      makeBSS('.bss-slides', options)\n    }, 1000) // Must run after the code which called this\n\n    return div\n  }\n}\n\n// ends\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAO,KAAKA,EAAE,MAAM,cAAc;AAElC,OAAOC,OAAO,MAAM,gCAAgC;AACpD,MAAMC,EAAE,GAAGF,EAAE,CAACE,EAAE;AAEhB,OAAO,MAAMC,aAAa,GAAG;EAC3BC,IAAI,EAAEJ,EAAE,CAACK,KAAK,CAACC,QAAQ,GAAG,iBAAiB;EAE3CC,IAAI,EAAE,WAAW;EAEjBC,QAAQ,EAAE,CAACN,EAAE,CAACO,KAAK,CAAC,WAAW,CAAC,CAAC;EAEjC;EACAC,KAAK,EAAE,SAAAA,CAAUC,OAAO,EAAEC,OAAO,EAAE;IACjC,MAAMC,KAAK,GAAGD,OAAO,CAACE,OAAO,CAACD,KAAK;IACnC,MAAMX,EAAE,GAAGF,EAAE,CAACE,EAAE;IAChB,MAAMa,CAAC,GAAGF,KAAK,CAACG,YAAY,CAACL,OAAO,CAAC;IACrC,IAAII,CAAC,CAACb,EAAE,CAACe,GAAG,CAAC,WAAW,CAAC,CAACC,GAAG,CAAC,IAAIH,CAAC,CAACb,EAAE,CAACe,GAAG,CAAC,gBAAgB,CAAC,CAACC,GAAG,CAAC,EAAE;MACjE,MAAMC,QAAQ,GAAGN,KAAK,CAACO,IAAI,CAACT,OAAO,EAAET,EAAE,CAACe,GAAG,CAAC,UAAU,CAAC,CAAC;MACxD,IAAII,KAAK,GAAG,CAAC;MACbF,QAAQ,CAACG,OAAO,CAAC,UAAUC,IAAI,EAAE;QAC/B,IAAIvB,EAAE,CAACwB,OAAO,CAACC,OAAO,CAACF,IAAI,CAAC,EAAEF,KAAK,EAAE;MACvC,CAAC,CAAC;MACF,OAAOA,KAAK,GAAG,CAAC,GAAG,WAAW,GAAG,IAAI;IACvC;IACA,OAAO,IAAI;EACb,CAAC;EAED;EACA;EACAK,MAAM,EAAE,SAAAA,CAAUf,OAAO,EAAEC,OAAO,EAAE;IAClC,MAAMe,GAAG,GAAGf,OAAO,CAACe,GAAG;IACvB,MAAMC,UAAU,GACd,mFAAmF;IACrF5B,EAAE,CAACwB,OAAO,CAACK,aAAa,CAACF,GAAG,EAAEC,UAAU,CAAC;IAEzC,MAAMf,KAAK,GAAGD,OAAO,CAACE,OAAO,CAACD,KAAK;IACnC,MAAMX,EAAE,GAAGF,EAAE,CAACE,EAAE;IAChB,MAAM4B,GAAG,GAAGH,GAAG,CAACI,aAAa,CAAC,KAAK,CAAC;IACpCD,GAAG,CAACE,YAAY,CAAC,OAAO,EAAE,YAAY,CAAC;IAEvC,MAAMjB,CAAC,GAAGF,KAAK,CAACG,YAAY,CAACL,OAAO,CAAC;IACrC,IAAIsB,SAAS;IACb,IAAIlB,CAAC,CAACb,EAAE,CAACe,GAAG,CAAC,gBAAgB,CAAC,CAACC,GAAG,CAAC,IAAIH,CAAC,CAACb,EAAE,CAACe,GAAG,CAAC,WAAW,CAAC,CAACC,GAAG,CAAC,EAAE;MACjEe,SAAS,GAAG/B,EAAE,CAACe,GAAG,CAAC,UAAU,CAAC;IAChC;IACA,MAAMiB,MAAM,GAAGrB,KAAK,CAACO,IAAI,CAACT,OAAO,EAAEsB,SAAS,CAAC,EAAC;IAC9C;IACAC,MAAM,CAACC,IAAI,CAAC,CAAC,EAAC;IACd,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,MAAM,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;MACtC,IAAI,CAACpC,EAAE,CAACwB,OAAO,CAACC,OAAO,CAACS,MAAM,CAACE,CAAC,CAAC,CAAC,EAAE;MACpC,MAAME,MAAM,GAAGR,GAAG,CAACS,WAAW,CAACZ,GAAG,CAACI,aAAa,CAAC,QAAQ,CAAC,CAAC;MAC3D,MAAMS,GAAG,GAAGF,MAAM,CAACC,WAAW,CAACZ,GAAG,CAACI,aAAa,CAAC,KAAK,CAAC,CAAC;;MAExD;MACAlB,KAAK,CAAC4B,OAAO,CAACC,MAAM,CAACR,MAAM,CAACE,CAAC,CAAC,CAAClB,GAAG,CAAC,CAChCyB,IAAI,CAAC,UAAUC,QAAQ,EAAE;QACxB,OAAOA,QAAQ,CAACC,IAAI,CAAC,CAAC;MACxB,CAAC,CAAC,CACDF,IAAI,CAAC,UAAUG,MAAM,EAAE;QACtB,MAAMC,SAAS,GAAGC,GAAG,CAACC,eAAe,CAACH,MAAM,CAAC;QAC7CN,GAAG,CAACR,YAAY,CAAC,KAAK,EAAEe,SAAS,CAAC,EAAC;MACrC,CAAC,CAAC;MACJP,GAAG,CAACR,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC;MACjCM,MAAM,CAACC,WAAW,CAACZ,GAAG,CAACI,aAAa,CAAC,YAAY,CAAC,CAAC;IACrD;IACA,MAAMmB,OAAO,GAAG;MAAEvB;IAAI,CAAC;IAEvBwB,UAAU,CAAC,YAAY;MACrBlD,OAAO,CAAC,aAAa,EAAEiD,OAAO,CAAC;IACjC,CAAC,EAAE,IAAI,CAAC,EAAC;;IAET,OAAOpB,GAAG;EACZ;AACF,CAAC;;AAED","ignoreList":[]}
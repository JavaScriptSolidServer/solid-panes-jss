{"version":3,"file":"pane.js","names":["UI","_interopRequireWildcard","require","$rdf","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ns","_default","exports","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","findTypeURIs","rdfs","uri","ui","render","dom","box","createElement","setAttribute","utils","mention","complain","message","style","pre","appendChild","textContent","complainIfBad","ok","body","docuri","Util","docpart","updater","editable","sym","any","link","widgets","defaultAnnotationStore","pred","wait","fetcher","nowOrWhenFetched","removeChild","displayFormsForRelation","allowCreation","sts","statementsMatching","outliner","getOutliner","length","appendPropertyTRs","form","object","cell","lastChild","newButton","formdef","rdf","editFormButton","why","appendForm"],"sources":["../../src/ui/pane.js"],"sourcesContent":["/*   Form building/editing Pane\n **\n */\n\nimport * as UI from 'solid-ui-jss'\nimport * as $rdf from 'rdflib'\nconst ns = UI.ns\n\nexport default {\n  // noun_170702.svg' builder   noun_122196.svg form\n  icon: UI.icons.iconBase + 'noun_170702.svg',\n\n  name: 'ui',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve this pane?\n  label: function (subject, context) {\n    const ns = UI.ns\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    if (t[ns.rdfs('Class').uri]) return 'creation forms'\n    // if (t[ns.rdf('Property').uri]) return \"user interface\";\n    if (t[ns.ui('Form').uri]) return 'edit form'\n\n    return null // No under other circumstances (while testing at least!)\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const ns = UI.ns\n\n    const box = dom.createElement('div')\n    box.setAttribute('class', 'formPane') // Share styles\n    const label = UI.utils.label(subject)\n\n    const mention = function complain (message, style) {\n      const pre = dom.createElement('p')\n      pre.setAttribute('style', style || 'color: grey; background-color: white')\n      box.appendChild(pre).textContent = message\n      return pre\n    }\n\n    const complain = function complain (message, style) {\n      mention(message, 'style', style || 'color: grey; background-color: #fdd')\n    }\n\n    const complainIfBad = function (ok, body) {\n      if (ok) {\n        // setModifiedDate(store, kb, store);\n        // rerender(box);   // Deleted forms at the moment\n      } else complain('Sorry, failed to save your change:\\n' + body)\n    }\n\n    // //////////////////////////////////////////////////////////////////////////////\n\n    const t = kb.findTypeURIs(subject)\n\n    let store = null\n    let docuri\n    if (subject.uri) {\n      docuri = $rdf.Util.uri.docpart(subject.uri)\n      if (subject.uri !== docuri && kb.updater.editable(docuri)) {\n        store = kb.sym($rdf.Util.uri.docpart(subject.uri))\n      } // an editable ontology with hash\n    }\n    if (!store) store = kb.any(kb.sym(docuri), ns.link('annotationStore'))\n    if (!store) store = UI.widgets.defaultAnnotationStore(subject)\n\n    if (!store) {\n      store = kb.sym(\n        'https://formsregistry.solid.community/public/formRegistry/'\n      ) // fallback\n    }\n    // if (!store) store = kb.sym('http://tabulator.org/wiki/ontologyAnnotation/common') // fallback\n\n    // A fallback which gives a different store page for each ontology would be good @@\n\n    let pred\n    if (t[ns.rdfs('Class').uri]) {\n      // Stuff we can do before we load the store\n    }\n\n    const wait = mention('(Loading data from: ' + store + ')')\n\n    kb.fetcher.nowOrWhenFetched(store.uri, subject, function (ok, body) {\n      if (!ok) {\n        complain('Cannot load store ' + store + ' :' + body)\n        return\n      }\n      box.removeChild(wait)\n\n      //              Render a Class -- the forms associated with it\n\n      if (t[ns.rdfs('Class').uri]) {\n        // For each creation form, allow one to create a new object with it, and also to edit the form.\n        const displayFormsForRelation = function displayFormsForRelation (\n          pred,\n          allowCreation\n        ) {\n          const sts = kb.statementsMatching(subject, pred)\n          const outliner = context.getOutliner(dom)\n          if (sts.length) {\n            for (let i = 0; i < sts.length; i++) {\n              outliner.appendPropertyTRs(box, [sts[i]])\n              const form = sts[i].object\n              const cell = dom.createElement('td')\n              box.lastChild.appendChild(cell)\n              if (allowCreation) {\n                cell.appendChild(\n                  UI.widgets.newButton(\n                    dom,\n                    kb,\n                    null,\n                    null,\n                    subject,\n                    form,\n                    store,\n                    function (ok, body) {\n                      if (ok) {\n                        // dom.outlineManager.GotoSubject(newThing@@, true, undefined, true, undefined);\n                        // rerender(box);   // Deleted forms at the moment\n                      } else {\n                        complain('Sorry, failed to save your change:\\n' + body)\n                      }\n                    }\n                  )\n                )\n              }\n              let formdef = kb.statementsMatching(form, ns.rdf('type'))\n              if (!formdef.length) formdef = kb.statementsMatching(form)\n              if (!formdef.length) complain('No data about form')\n              else {\n                UI.widgets.editFormButton(\n                  dom,\n                  box,\n                  form,\n                  formdef[0].why,\n                  complainIfBad\n                )\n              }\n            }\n            box.appendChild(dom.createElement('hr'))\n          } else {\n            mention(\n              'There are currently no known forms to make a ' + label + '.'\n            )\n          }\n        }\n\n        pred = ns.ui('creationForm')\n        box.appendChild(dom.createElement('h2')).textContent = UI.utils.label(\n          pred\n        )\n        mention(\n          'Creation forms allow you to add information about a new thing,' +\n            ' in this case a new ' +\n            label +\n            '.'\n        )\n        displayFormsForRelation(pred, true)\n        box.appendChild(dom.createElement('hr'))\n        mention('You can make a new creation form:')\n        box.appendChild(\n          UI.widgets.newButton(\n            dom,\n            kb,\n            subject,\n            pred,\n            ns.ui('Form'),\n            null,\n            store,\n            complainIfBad\n          )\n        )\n\n        box.appendChild(dom.createElement('hr'))\n\n        pred = ns.ui('annotationForm')\n        box.appendChild(dom.createElement('h2')).textContent = UI.utils.label(\n          pred\n        )\n        mention(\n          'Annotaion forms allow you to add extra information about a ,' +\n            label +\n            ' we already know about.'\n        )\n        displayFormsForRelation(pred, false)\n        box.appendChild(dom.createElement('hr'))\n        mention('You can make a new annotation form:')\n        box.appendChild(\n          UI.widgets.newButton(\n            dom,\n            kb,\n            subject,\n            pred,\n            ns.ui('Form'),\n            null,\n            store,\n            complainIfBad\n          )\n        )\n\n        mention('(Storing new forms in: ' + store + ')')\n\n        // Render a Form\n      } else if (t[ns.ui('Form').uri]) {\n        UI.widgets.appendForm(\n          dom,\n          box,\n          kb,\n          subject,\n          ns.ui('FormForm'),\n          store,\n          complainIfBad\n        )\n      } else {\n        complain('ui/pane internal error -- Eh?')\n      }\n    }) // end: when store loded\n\n    return box\n  }\n}\n// ends\n"],"mappings":"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","ignoreList":[]}
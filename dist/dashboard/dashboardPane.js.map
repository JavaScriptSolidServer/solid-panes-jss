{"version":3,"file":"dashboardPane.js","names":["icons","authn","authSession","store","generateHomepage","dashboardPane","icon","iconBase","name","label","subject","console","log","uri","site","render","context","dom","container","createElement","runBuildPage","innerHTML","buildPage","currentUser","events","on","webId","URL","window","location","href","searchParams","get","buildDashboard","buildHomePage","outliner","getOutliner","getDashboard","then","dashboard","appendChild","wrapper","document","shadow","attachShadow","mode","link","rel","fetcher","homepage"],"sources":["../../src/dashboard/dashboardPane.ts"],"sourcesContent":["import { icons } from 'solid-ui-jss'\nimport { authn, authSession, store } from 'solid-logic-jss'\nimport { Fetcher, NamedNode } from 'rdflib'\nimport { generateHomepage } from './homepage'\nimport { DataBrowserContext, PaneDefinition } from 'pane-registry'\n\nexport const dashboardPane: PaneDefinition = {\n  icon: icons.iconBase + 'noun_547570.svg',\n  name: 'dashboard',\n  label: subject => {\n    console.log()\n    if (subject.uri === subject.site().uri) {\n      return 'Dashboard'\n    }\n    return null\n  },\n  render: (subject, context) => {\n    console.log('Dashboard Pane Render')\n    const dom = context.dom\n    const container = dom.createElement('div')\n    const runBuildPage = () => {\n      container.innerHTML = ''\n      buildPage(\n        container,\n        authn.currentUser() || null,\n        context,\n        subject\n      )\n    }\n\n    authSession.events.on('login', () => {\n      // console.log('On Login')\n      runBuildPage()\n    })\n    authSession.events.on('sessionRestore', () => {\n      // console.log('On Session Restore')\n      runBuildPage()\n    })\n    // console.log('Initial Load')\n    runBuildPage()\n\n    return container\n  }\n}\n\nfunction buildPage (\n  container: HTMLElement,\n  webId: NamedNode | null,\n  context: DataBrowserContext,\n  subject: NamedNode\n) {\n  // if uri then SolidOS is a browse.html web app\n  const uri = (new URL(window.location.href)).searchParams.get('uri')\n  if (webId && (uri || webId.site().uri === subject.site().uri)) {\n    return buildDashboard(container, context)\n  }\n  return buildHomePage(container, subject)\n}\n\nfunction buildDashboard (container: HTMLElement, context: DataBrowserContext) {\n  // console.log('build dashboard')\n  // @@ TODO get a proper type\n  const outliner: any = context.getOutliner(context.dom)\n  outliner\n    .getDashboard()\n    .then((dashboard: HTMLElement) => container.appendChild(dashboard))\n}\n\nfunction buildHomePage (container: HTMLElement, subject: NamedNode) {\n  // console.log('build home page')\n  const wrapper = document.createElement('div')\n  container.appendChild(wrapper)\n  const shadow = wrapper.attachShadow({ mode: 'open' })\n  const link = document.createElement('link')\n  link.rel = 'stylesheet'\n  link.href = '/common/css/bootstrap.min.css'\n  shadow.appendChild(link)\n  generateHomepage(subject, store, store.fetcher as Fetcher).then(homepage =>\n    shadow.appendChild(homepage)\n  )\n}\n\nexport default dashboardPane\n"],"mappings":"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","ignoreList":[]}
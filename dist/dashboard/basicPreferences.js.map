{"version":3,"file":"basicPreferences.js","names":["_rdflib","require","_solidUiJss","ontologyData","preferencesFormText","basicPreferencesPane","exports","icon","icons","iconBase","name","label","_subject","render","subject","context","dom","store","session","complainIfBad","ok","mess","container","appendChild","widgets","errorMessageBlock","createElement","formArea","setupUserTypesSection","loadData","doc","turtle","holds","undefined","parse","uri","preferencesForm","sym","ontologyExtra","doRender","renderContext","login","ensureLoadedPreferences","div","preferencesFile","console","log","preferencesFileError","appendedForm","appendForm","me","style","borderStyle","trustedApplicationsView","paneRegistry","byName","addDeleteSection","formContainer","createSection","description","innerText","userTypesLink","href","_default","default","profile","section","podServerNodes","each","ns","space","podServers","map","node","value","list","forEach","server","deletionLink","generateDeletionLink","listItem","podServer","link","textContent","deletionUrl","getDeletionUrlForServer","singleUserUrl","URL","multiUserUrl","pathname","hostnameParts","hostname","split","slice","join","multiUserNssResponse","fetch","method","singleUserNssResponse","title","border","borderRadius","padding","marginTop","titleElement"],"sources":["../../src/dashboard/basicPreferences.ts"],"sourcesContent":["import { PaneDefinition } from 'pane-registry'\nimport { IndexedFormula, NamedNode, parse, Store } from 'rdflib'\nimport { icons, login, ns, widgets } from 'solid-ui-jss'\nimport ontologyData from './ontologyData.ttl'\nimport preferencesFormText from './preferencesFormText.ttl'\n\nexport const basicPreferencesPane: PaneDefinition = {\n  icon: icons.iconBase + 'noun_Sliders_341315_000000.svg',\n  name: 'basicPreferences',\n  label: _subject => {\n    return null\n  },\n\n  // Render the pane\n  // The subject should be the logged in user.\n  render: (subject, context) => {\n    const dom = context.dom\n    const store = context.session.store as Store\n\n    function complainIfBad (ok: Boolean, mess: any) {\n      if (ok) return\n      container.appendChild(widgets.errorMessageBlock(dom, mess, '#fee'))\n    }\n\n    const container = dom.createElement('div')\n\n    const formArea = setupUserTypesSection(container, dom)\n\n    function loadData (doc: NamedNode, turtle: String) {\n      doc = doc.doc() // remove # from URI if nec\n      if (!store.holds(undefined, undefined, undefined, doc)) {\n        // If not loaded already\n        ;(parse as any)(turtle, store, doc.uri, 'text/turtle', null) // Load form directly\n      }\n    }\n\n    const preferencesForm = store.sym(\n      'urn:uuid:93774ba1-d3b6-41f2-85b6-4ae27ffd2597#this'\n    )\n    loadData(preferencesForm, preferencesFormText)\n\n    const ontologyExtra = store.sym(\n      'urn:uuid:93774ba1-d3b6-41f2-85b6-4ae27ffd2597-ONT'\n    )\n    loadData(ontologyExtra, ontologyData)\n\n    async function doRender () {\n      const renderContext = await login.ensureLoadedPreferences({\n        dom,\n        div: container\n      })\n      if (!renderContext.preferencesFile) {\n        // Could be CORS\n        console.log(\n          'Not doing private class preferences as no access to preferences file. ' +\n          renderContext.preferencesFileError\n        )\n        return\n      }\n      const appendedForm = widgets.appendForm(\n        dom,\n        formArea,\n        {},\n        renderContext.me,\n        preferencesForm,\n        renderContext.preferencesFile,\n        complainIfBad\n      )\n      appendedForm.style.borderStyle = 'none'\n\n      const trustedApplicationsView = context.session.paneRegistry.byName('trustedApplications')\n      if (trustedApplicationsView) {\n        container.appendChild(trustedApplicationsView.render(null, context))\n      }\n\n      // @@ TODO Remove need for casting as any and bang (!) syntax\n      addDeleteSection(container, store, renderContext.me!, dom)\n    }\n\n    doRender()\n\n    return container\n  }\n}\n\nfunction setupUserTypesSection (\n  container: Element,\n  dom: HTMLDocument\n): Element {\n  const formContainer = createSection(container, dom, 'User types')\n\n  const description = formContainer.appendChild(dom.createElement('p'))\n  description.innerText = 'Here you can self-assign user types to help the data browser know which views you would like to access.'\n\n  const userTypesLink = formContainer.appendChild(dom.createElement('a'))\n  userTypesLink.href = 'https://github.com/solidos/userguide/#role'\n  userTypesLink.innerText = 'Read more'\n\n  const formArea = formContainer.appendChild(dom.createElement('div'))\n\n  return formArea\n}\n\nexport default basicPreferencesPane\n\n// ends\n\nfunction addDeleteSection (\n  container: HTMLElement,\n  store: IndexedFormula,\n  profile: NamedNode,\n  dom: HTMLDocument\n): void {\n  const section = createSection(container, dom, 'Delete account')\n\n  const podServerNodes = store.each(profile, ns.space('storage'), null, profile.doc())\n  const podServers = podServerNodes.map(node => node.value)\n\n  const list = section.appendChild(dom.createElement('ul'))\n\n  podServers.forEach(async server => {\n    const deletionLink = await generateDeletionLink(server, dom)\n    if (deletionLink) {\n      const listItem = list.appendChild(dom.createElement('li'))\n      listItem.appendChild(deletionLink)\n    }\n  })\n}\n\nasync function generateDeletionLink (\n  podServer: string,\n  dom: HTMLDocument\n): Promise<HTMLElement | null> {\n  const link = dom.createElement('a')\n  link.textContent = `Delete your account at ${podServer}`\n  const deletionUrl = await getDeletionUrlForServer(podServer)\n  if (typeof deletionUrl !== 'string') {\n    return null\n  }\n  link.href = deletionUrl\n  return link\n}\n\n/**\n * Hacky way to get the deletion link to a Pod\n *\n * This function infers the deletion link by assuming the URL structure of Node Solid server.\n * In the future, Solid will hopefully provide a standardised way of discovering the deletion link:\n * https://github.com/solidos/data-interoperability-panel/issues/18\n *\n * If NSS is in multi-user mode (the case on inrupt.net and solid.community), the deletion URL for\n * vincent.dev.inrupt.net would be at dev.inrupt.net/account/delete. In single-user mode, the\n * deletion URL would be at vincent.dev.inrupt.net/account/delete.\n *\n * @param server Pod server containing the user's account.\n * @returns URL of the page that Node Solid Server would offer to delete the account, or null if\n *          the URLs we tried give invalid responses.\n */\nasync function getDeletionUrlForServer (\n  server: string\n): Promise<string | null> {\n  const singleUserUrl = new URL(server)\n  const multiUserUrl = new URL(server)\n  multiUserUrl.pathname = singleUserUrl.pathname = '/account/delete'\n\n  const hostnameParts = multiUserUrl.hostname.split('.')\n  // Remove `vincent.` from `vincent.dev.inrupt.net`, for example:\n  multiUserUrl.hostname = hostnameParts.slice(1).join('.')\n\n  const multiUserNssResponse = await fetch(multiUserUrl.href, {\n    method: 'HEAD'\n  })\n  if (multiUserNssResponse.ok) {\n    return multiUserUrl.href\n  }\n\n  const singleUserNssResponse = await fetch(singleUserUrl.href, {\n    method: 'HEAD'\n  })\n  if (singleUserNssResponse.ok) {\n    return singleUserUrl.href\n  }\n  return null\n}\n\nfunction createSection (\n  container: Element,\n  dom: HTMLDocument,\n  title: string\n): Element {\n  const section = container.appendChild(dom.createElement('div'))\n  section.style.border = '0.3em solid #418d99'\n  section.style.borderRadius = '0.5em'\n  section.style.padding = '0.7em'\n  section.style.marginTop = '0.7em'\n\n  const titleElement = section.appendChild(dom.createElement('h3'))\n  titleElement.innerText = title\n\n  return section\n}\n"],"mappings":"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","ignoreList":[]}
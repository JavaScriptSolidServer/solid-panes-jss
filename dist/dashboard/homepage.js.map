{"version":3,"file":"homepage.js","names":["sym","ns","generateHomepage","subject","store","fetcher","ownersProfile","loadProfile","name","getName","wrapper","document","createElement","classList","add","appendChild","createTitle","uri","createDataSection","dataSection","title","innerText","listGroup","publicDataLink","href","window","location","profileLink","profileLinkPost","pod","site","webId","load","anyValue","vcard","doc","foaf","URL","host","split"],"sources":["../../src/dashboard/homepage.ts"],"sourcesContent":["import { Fetcher, IndexedFormula, NamedNode, sym } from 'rdflib'\nimport { ns } from 'solid-ui-jss'\n\nexport async function generateHomepage (\n  subject: NamedNode,\n  store: IndexedFormula,\n  fetcher: Fetcher\n): Promise<HTMLElement> {\n  const ownersProfile = await loadProfile(subject, fetcher)\n  const name = getName(store, ownersProfile)\n\n  const wrapper = document.createElement('div')\n  wrapper.classList.add('container')\n  wrapper.appendChild(createTitle(ownersProfile.uri, name))\n  wrapper.appendChild(createDataSection(name))\n\n  return wrapper\n}\n\nfunction createDataSection (name: string): HTMLElement {\n  const dataSection = document.createElement('section')\n\n  const title = document.createElement('h2')\n  title.innerText = 'Data'\n  dataSection.appendChild(title)\n\n  const listGroup = document.createElement('div')\n  listGroup.classList.add('list-group')\n  dataSection.appendChild(listGroup)\n\n  const publicDataLink = document.createElement('a')\n  publicDataLink.classList.add('list-group-item')\n  publicDataLink.href = window.document.location.href + 'public/'\n  publicDataLink.innerText = `View ${name}'s files`\n  listGroup.appendChild(publicDataLink)\n\n  return dataSection\n}\n\nfunction createTitle (uri: string, name: string): HTMLElement {\n  const profileLink = document.createElement('a')\n  profileLink.href = uri\n  profileLink.innerText = name\n\n  const profileLinkPost = document.createElement('span')\n  profileLinkPost.innerText = '\\'s Pod'\n\n  const title = document.createElement('h1')\n  title.appendChild(profileLink)\n  title.appendChild(profileLinkPost)\n\n  return title\n}\n\nasync function loadProfile (\n  subject: NamedNode,\n  fetcher: Fetcher\n): Promise<NamedNode> {\n  const pod = subject.site().uri\n  // TODO: This is a hack - we cannot assume that the profile is at this document, but we will live with it for now\n  const webId = sym(`${pod}profile/card#me`)\n  await fetcher.load(webId)\n  return webId\n}\n\nfunction getName (store: IndexedFormula, ownersProfile: NamedNode): string {\n  return (\n    store.anyValue(ownersProfile, ns.vcard('fn'), null, ownersProfile.doc()) ||\n    store.anyValue(ownersProfile, ns.foaf('name'), null, ownersProfile.doc()) ||\n    new URL(ownersProfile.uri).host.split('.')[0]\n  )\n}\n"],"mappings":"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","ignoreList":[]}